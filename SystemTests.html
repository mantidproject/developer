<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>System Tests</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.12.20180412.1313',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Files for Testing" href="DataFilesForTesting.html" />
    <link rel="prev" title="Writing Performance Tests" href="WritingPerformanceTests.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body role="document">





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="system-tests">
<span id="systemtests"></span><h1>System Tests<a class="headerlink" href="#system-tests" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#writing-a-test" id="id3">Writing a Test</a><ul>
<li><a class="reference internal" href="#specifying-validation" id="id4">Specifying Validation</a></li>
<li><a class="reference internal" href="#no-workspace-validation" id="id5">No Workspace Validation</a></li>
<li><a class="reference internal" href="#skipping-tests" id="id6">Skipping tests</a><ul>
<li><a class="reference internal" href="#target-platform-based-on-free-memory" id="id7">Target Platform Based on Free Memory</a></li>
<li><a class="reference internal" href="#id1" id="id8">Target Platform Based on Free Memory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-the-tolerance" id="id9">Set the Tolerance</a></li>
<li><a class="reference internal" href="#disable-some-checks" id="id10">Disable Some Checks</a></li>
<li><a class="reference internal" href="#assertions" id="id11">Assertions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-tests-locally" id="id12">Running Tests Locally</a><ul>
<li><a class="reference internal" href="#visual-studio-xcode" id="id13">Visual Studio/Xcode</a></li>
<li><a class="reference internal" href="#makefile-like-generators" id="id14">Makefile-like Generators</a></li>
<li><a class="reference internal" href="#selecting-tests-to-run" id="id15">Selecting Tests To Run</a></li>
<li><a class="reference internal" href="#adding-new-data-references-files" id="id16">Adding New Data &amp; References Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practice" id="id17">Best Practice</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>System tests are high-level tests, which check that Mantid is able to
reproduce accepted, standardised results as part of its calculations,
when executing user stories. The system test suite is written against
Mantid&#8217;s Python API.</p>
<p>As part of our nightly-build and nightly-test procedure, Mantid&#8217;s system
tests are run as acceptance tests. The nightly-test jobs deploy a
packaged version of Mantid to the target OS, before executing the system
tests scripts on that environment.</p>
</div>
<div class="section" id="writing-a-test">
<h2><a class="toc-backref" href="#id3">Writing a Test</a><a class="headerlink" href="#writing-a-test" title="Permalink to this headline">¶</a></h2>
<p>The (python) code for the system tests can be found in the git
repository at
<a class="reference external" href="http://github.com/mantidproject/mantid">mantidproject/mantid</a>, under
the <code class="docutils literal"><span class="pre">Testing/SystemTests</span></code> directory.</p>
<p>Like their &#8216;stress&#8217; equivalents (<a class="reference external" href="Stress_Tests">stress testing</a>),
system tests inherit from the stresstesting.MantidStressTest class. The
methods that need to be overridden are <code class="docutils literal"><span class="pre">runTest(self)</span></code>, where the
python code that runs the test should be placed, and <code class="docutils literal"><span class="pre">validate(self)</span></code>,
which should simply return a pair of strings: the name of the final
workspace that results from the <code class="docutils literal"><span class="pre">runTest</span></code> method and the name of a
nexus file that should be saved in the ReferenceResults sub-directory in
the repository. The test code itself is likely to be the output of a
<em>Save History</em> command, though it can be any python code. In the
unlikely case of files being used during a system test, implement the
method <code class="docutils literal"><span class="pre">requiredFiles</span></code> which should return a list of filenames without
paths. The file to validate against should be included as well. If any
of those files are missing the test will be marked as skipped.</p>
<p>The tests should be added to the <code class="docutils literal"><span class="pre">Testing/SystemTests/tests/analysis</span></code>,
with the template result going in the <code class="docutils literal"><span class="pre">reference</span></code> sub-folder. It will
then be included in the suite of tests from the following night.</p>
<div class="section" id="specifying-validation">
<h3><a class="toc-backref" href="#id4">Specifying Validation</a><a class="headerlink" href="#specifying-validation" title="Permalink to this headline">¶</a></h3>
<p>You may need to inform the System Test Suite about the format of that
the benchmark workspace you wish to validate against. By default, the
system tests assume that the second argument returned by the validate
tuple is the name of a nexus file to validate against. However you can
override the validateMethod on a test with any one of three options.</p>
<ul class="simple">
<li>WorkspaceToNexus (Benchmark workspace is stored as a Nexus file)
(default)</li>
<li>WorkspaceToWorkspace (Benchmark workspace is stored as a workspace)</li>
<li>ValidateAscii (Benchmark workspace is stored as an ascii file)</li>
</ul>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validateMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;WorkspaceToNeXus&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="no-workspace-validation">
<h3><a class="toc-backref" href="#id5">No Workspace Validation</a><a class="headerlink" href="#no-workspace-validation" title="Permalink to this headline">¶</a></h3>
<p>If the system test does not need comparison/validation against a
standard workpace, then this step can be skipped. Simply omitting the</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
<p>method from the system test is sufficient.</p>
</div>
<div class="section" id="skipping-tests">
<h3><a class="toc-backref" href="#id6">Skipping tests</a><a class="headerlink" href="#skipping-tests" title="Permalink to this headline">¶</a></h3>
<p>Tests can be skipped based on arbitrary criteria by implementing the
<code class="docutils literal"><span class="pre">skipTests</span></code> method and returning True if your criteria are met, and
False otherwise. Examples are the availability of a data file or of
certain python modules (e.g. for the XML validation tests).</p>
<div class="section" id="target-platform-based-on-free-memory">
<h4><a class="toc-backref" href="#id7">Target Platform Based on Free Memory</a><a class="headerlink" href="#target-platform-based-on-free-memory" title="Permalink to this headline">¶</a></h4>
<p>Some tests consume a large amount memory resources, and are therefore
best executed on hardware where enough memory is available. You can set
a minimum RAM specification by overriding requiredMemoryMB:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">requiredMemoryMB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2000</span>
</pre></div>
</div>
<p>The above function limits the test to run on a machine where there is at
least 2GB of free memory.</p>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id8">Target Platform Based on Free Memory</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Some tests require very large files that cannot be placed in the shared
repository. The <code class="docutils literal"><span class="pre">requiredFiles()</span></code> method returns a list of these files
so that they test can check that they are all available. If all files
are not available then the tests are skipped.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">requiredFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;a.nxs&#39;</span><span class="p">,</span> <span class="s1">&#39;b.nxs&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The above function limits the test to run on a machine that can find the
files &#8216;a.nxs&#8217; &amp; &#8216;b.nxs&#8217;</p>
</div>
</div>
<div class="section" id="set-the-tolerance">
<h3><a class="toc-backref" href="#id9">Set the Tolerance</a><a class="headerlink" href="#set-the-tolerance" title="Permalink to this headline">¶</a></h3>
<p>You may specialise the tolerance used by <code class="docutils literal"><span class="pre">CompareWorkspace</span></code> in your
system test.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.00000001</span>
</pre></div>
</div>
</div>
<div class="section" id="disable-some-checks">
<h3><a class="toc-backref" href="#id10">Disable Some Checks</a><a class="headerlink" href="#disable-some-checks" title="Permalink to this headline">¶</a></h3>
<p>You may disable some checks performed by the <code class="docutils literal"><span class="pre">CompareWorkspaces</span></code>
algorithm by appending them to the disableChecking list, which, by
default, is empty.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># A list of things not to check when validating</span>
<span class="bp">self</span><span class="o">.</span><span class="n">disableChecking</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
<div class="section" id="assertions">
<h3><a class="toc-backref" href="#id11">Assertions</a><a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h3>
<p>Additional assertions can be used as the basis for your own comparison
tests. The following assertions are already implemented in the base
class.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">assertDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">assertLessThan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">assertGreaterThan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-tests-locally">
<h2><a class="toc-backref" href="#id12">Running Tests Locally</a><a class="headerlink" href="#running-tests-locally" title="Permalink to this headline">¶</a></h2>
<p>CMake configures a script file called <code class="docutils literal"><span class="pre">systemtest</span></code> (<code class="docutils literal"><span class="pre">systemtest.bat</span></code>
on Windows) in the root of the build directory. This file is the driver
script to execute the system tests that runs the lower-level
<code class="docutils literal"><span class="pre">Testing/SystemTests/scripts/runSystemTests.py</span></code> script but ensures
that the environment is set up correctly for that particular build and
that the required test data has been updated. The script accepts a
<code class="docutils literal"><span class="pre">-h</span></code> option to print out the standard usage information.</p>
<p>Usage differs depending on whether you are using a single-configuration
generator with CMake, for example Makefiles/Ninja, or a
multi-configuration generator such as Visual Studio or Xcode.</p>
<div class="section" id="visual-studio-xcode">
<h3><a class="toc-backref" href="#id13">Visual Studio/Xcode</a><a class="headerlink" href="#visual-studio-xcode" title="Permalink to this headline">¶</a></h3>
<p>The user must first open command-prompt from, the build directory. The
script requires the developer to select the configuration that will be
used to execute the tests, one of: <em>Release</em>, <em>Debug</em>, <em>RelWithDebInfo</em>
or &#8216;MinSizeRelease&#8217;&#8216;. Note that the script does not build the code so
the chosen configuration must have already been built. An example to
execute all of the tests for the release configuration would be (in the
command-prompt):</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span>&gt; systemtest -C Release
</pre></div>
</div>
</div>
<div class="section" id="makefile-like-generators">
<h3><a class="toc-backref" href="#id14">Makefile-like Generators</a><a class="headerlink" href="#makefile-like-generators" title="Permalink to this headline">¶</a></h3>
<p>The script requires no additional arguments as the configuration is
fixed when running CMake, e.g.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="nb">cd</span> build
systemtest
</pre></div>
</div>
</div>
<div class="section" id="selecting-tests-to-run">
<h3><a class="toc-backref" href="#id15">Selecting Tests To Run</a><a class="headerlink" href="#selecting-tests-to-run" title="Permalink to this headline">¶</a></h3>
<p>The most important option on the script is the <code class="docutils literal"><span class="pre">-R</span></code> option. This
restricts the tests that will run to those that match the given regex,
e.g.</p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="nb">cd</span> build
systemtest -R SNS
<span class="c1"># or for msvc/xcode</span>
systemtest -C &lt;cfg&gt; -R SNS
</pre></div>
</div>
<p>would run all of the tests whose name contains SNS.</p>
</div>
<div class="section" id="adding-new-data-references-files">
<h3><a class="toc-backref" href="#id16">Adding New Data &amp; References Files</a><a class="headerlink" href="#adding-new-data-references-files" title="Permalink to this headline">¶</a></h3>
<p>The data is managed by CMake&#8217;s external data system that is described by
<a class="reference external" href="Data_Files_in_Mantid">Data_Files_in_Mantid</a>. Please see <a class="reference external" href="Data_Files_in_Mantid#Adding_A_New_File">Adding a
new file</a> for how to add new
files.</p>
</div>
</div>
<div class="section" id="best-practice">
<h2><a class="toc-backref" href="#id17">Best Practice</a><a class="headerlink" href="#best-practice" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Always check your test works locally before making it public.</li>
<li>User stories should come from the users themselves where possible.</li>
<li>Take care to set the tolerance to an acceptable level.</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="WritingPerformanceTests.html" title="Previous Chapter: Writing Performance Tests"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Writing Perfo...</span>
    </a>
  </li>
  <li>
    <a href="DataFilesForTesting.html" title="Next Chapter: Data Files for Testing"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Data Files fo... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>