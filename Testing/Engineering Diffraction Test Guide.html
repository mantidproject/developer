<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Engineering Diffraction Testing</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Error Reporter Testing" href="ErrorReporter-ProjectRecovery/ErrorReporterTesting.html" />
    <link rel="prev" title="Indirect Inelastic Testing" href="IndirectInelastic/IndirectInelasticAcceptanceTests.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="engineering-diffraction-testing">
<span id="engineering-diffraction-testguide-ref"></span><h1>Engineering Diffraction Testing<a class="headerlink" href="#engineering-diffraction-testing" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#preamble" id="id4">Preamble</a></li>
<li><a class="reference internal" href="#overview" id="id5">Overview</a></li>
<li><a class="reference internal" href="#calibration" id="id6">Calibration</a><ul>
<li><a class="reference internal" href="#negative-testing-ideas" id="id7">Negative Testing Ideas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#focus" id="id8">Focus</a><ul>
<li><a class="reference internal" href="#id1" id="id9">Negative Testing Ideas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pre-processing" id="id10">Pre-processing</a></li>
<li><a class="reference internal" href="#fitting" id="id11">Fitting</a><ul>
<li><a class="reference internal" href="#id2" id="id12">Negative Testing Ideas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gsas-fitting" id="id13">GSAS Fitting</a><ul>
<li><a class="reference internal" href="#id3" id="id14">Negative Testing Ideas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#settings" id="id15">Settings</a></li>
</ul>
</div>
<div class="section" id="preamble">
<h2><a class="toc-backref" href="#id4">Preamble</a><a class="headerlink" href="#preamble" title="Permalink to this headline">¶</a></h2>
<p>This document is tailored towards developers intending to test the Engineering Diffraction
interface.</p>
<p>The files used in the following examples are found within System test files within
<cite>&lt;MantidBuildDir&gt;/ExternalData/Testing/Data/SystemTest</cite> after building the <em>SystemTestData</em> target.
Runs can also be loaded from the archive, however different run numbers will be needed as older runs may
be deleted.</p>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id5">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The Engineering Diffraction interface allows scientists using the EnginX instrument to interactively
process their data. There are 5 tabs from which are ordered according to the main steps performed.
These are:</p>
<ul class="simple">
<li>Calibration - This is where a vanadium and cerium run are entered to calibrate the subsequent data.</li>
<li>Focus - Where are the data across multiple spectra are summed into a single spectrum for later steps.</li>
<li>Pre-processing - Event workspaces have to be converted into histogram data before
focusing which can be completed here.</li>
<li>Fitting - The user uses their focused data here to interactively pick peaks for subsequent fitting.</li>
<li>Settings - This holds additional settings which may be of use during testing.</li>
</ul>
</div>
<div class="section" id="calibration">
<span id="calibration-engineering-diffraction-test-ref"></span><h2><a class="toc-backref" href="#id6">Calibration</a><a class="headerlink" href="#calibration" title="Permalink to this headline">¶</a></h2>
<p>The first time the interface is opened it will be disabled except for the RB number entry box
and a pop up box which should prompt for a RB number. For testing purposes this can be anything.</p>
<p>If a vanadium calibration has never been run the <cite>Current calibration</cite> will be empty. Once
a calibration has been run these fields will retain their values for future runs of the program.
The following files can be used for the calibration run.</p>
<ul class="simple">
<li><em>Vanadium#</em>: ENGINX00236516.nxs / 307521 for archive</li>
<li><em>Calibration#</em>: ENGINX00241391.nxs / 305738 for archive</li>
</ul>
<p>Once the calibration has completed if the calibration was successful plotting the spectra of the
newly created workspaces will produce images similar to below:</p>
<a class="reference internal image-reference" href="../_images/EnggDiffExpectedVanCurve.png"><img alt="../_images/EnggDiffExpectedVanCurve.png" src="../_images/EnggDiffExpectedVanCurve.png" style="width: 300px;" /></a>
<a class="reference internal image-reference" href="../_images/EnggDiffExpectedLinear.png"><img alt="../_images/EnggDiffExpectedLinear.png" src="../_images/EnggDiffExpectedLinear.png" style="width: 300px;" /></a>
<p>If the plot is incorrect check you haven’t swapped the run numbers and they are both correct.</p>
<p>If <cite>Current calibration</cite> is populated the algorithm will attempt to use a cached calculation instead
of recalculating the calibration. To force it to recalculate every time for testing purposes the
option can be set under the Engineering Diffraction Settings.</p>
<p>A cropped calibration can be used to limit the spectra considered during calibration. This can
be useful if a subset of detectors are going to be used.</p>
<div class="section" id="negative-testing-ideas">
<h3><a class="toc-backref" href="#id7">Negative Testing Ideas</a><a class="headerlink" href="#negative-testing-ideas" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the RB number (or remove it) and try immediately using controls such as close</li>
<li>Running calibrate with various fields left blank</li>
<li>Using files which aren’t calibration files - Mantid shouldn’t crash</li>
</ul>
</div>
</div>
<div class="section" id="focus">
<span id="focus-engineering-diffraction-test-ref"></span><h2><a class="toc-backref" href="#id8">Focus</a><a class="headerlink" href="#focus" title="Permalink to this headline">¶</a></h2>
<p>Focusing takes a workspace with histogram data and sums the spectra into a single spectrum.
If the data is captured in event mode (i.e.. Event workspaces) it will first
need <a class="reference internal" href="#preprocessing-engineering-diffraction-test-ref"><span class="std std-ref">Pre-processing</span></a> .</p>
<p>A .nxs file containing histogram data needs to be selected for example <em>ENGINX00193749.nxs</em>
/ 305761 on archive. This can have all banks summed, specific spectra and list or use a
detector grouping to create a texture.</p>
<p>Once the focus run has finished it will save a focused .nxs file in</p>
<p><cite>C:\EnginX_Mantid\User\&lt;RB Number&gt;</cite> or <cite>~/EnginX_Mantid/User/&lt;RB Number&gt;</cite></p>
<p>and store a copy in <cite>C:\EnginX_Mantid\Focus</cite> or <cite>~/EnginX_Mantid/Focus</cite>.</p>
<p>The saved focused .nxs filename will be of the format
<cite>&lt;INST&gt;_&lt;Run number&gt;_focused_bank_&lt;bank number&gt;.nxs</cite></p>
<p>Plotting the focused workspace should look similar to the image below:</p>
<a class="reference internal image-reference" href="../_images/EnggDiffExampleFocusOutput.png"><img alt="../_images/EnggDiffExampleFocusOutput.png" src="../_images/EnggDiffExampleFocusOutput.png" style="width: 300px;" /></a>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id9">Negative Testing Ideas</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Using a .nxs file which doesn’t have expected data - Mantid shouldn’t crash</li>
<li>Running focus with no banks selected</li>
<li>Using Cropped/Texture with bad inputs</li>
<li>Whilst the data is being focused only <cite>Plot Data Representation</cite> should be changeable</li>
</ul>
</div>
</div>
<div class="section" id="pre-processing">
<span id="preprocessing-engineering-diffraction-test-ref"></span><h2><a class="toc-backref" href="#id10">Pre-processing</a><a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<p>Pre-processing is used to convert event data into histogram data which can be subsequently
focused. The optimal parameters for pre-processing are dependent on how the instrument was
configured during the capture of the data.</p>
<p><cite>Regular time binning</cite> requires the bin width to be specified and will produce a histogram #
workspace with TOF as the X axis.</p>
<p>If the multi-period data with pulse times is captured <cite>Multi-period data</cite> should be used instead
with the delta in time on every step of the X axis entered.</p>
<p>For testing purposes with regular time binning testing should be done using 305761 on archive,
multi-period data should instead use a run from 285643-285701 which are event workspaces.</p>
</div>
<div class="section" id="fitting">
<h2><a class="toc-backref" href="#id11">Fitting</a><a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h2>
<p>Fitting allows a user to plot the peaks from their focused nexus file obtained from
<a class="reference internal" href="#focus-engineering-diffraction-test-ref"><span class="std std-ref">Focus</span></a> . The focused run can be entered by value
<cite>193749</cite>, a range of runs <cite>19000-19100</cite> or by browsing for the focused file.</p>
<p>After the fitting has run if it managed to fit any peaks it should look similar to below
if there are no peaks and the display looks “corrupted” check the calibration was completed
correctly:</p>
<a class="reference internal image-reference" href="../_images/EnggDiffExampleFitOutput.png"><img alt="../_images/EnggDiffExampleFitOutput.png" src="../_images/EnggDiffExampleFitOutput.png" style="width: 500px;" /></a>
<p>The banks available to plot are selected with the <cite>Plot Bank</cite> selector and then fit is clicked.
Mantid will plot the peaks in the peak picker window, expected peaks can also be selected
to help the fitting process. Zoom in by dragging with the LMB and out by clicking the RMB.
Peaks are selected by holding <cite>Shift</cite> whilst clicking the LMB on a peak similar to the fit interface.</p>
<p>Once peaks are selected fit can be re-run with the expected peak list specified to attempt to
create a better fitting.</p>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id12">Negative Testing Ideas</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Using an unfocused .nxs file - Mantid shouldn’t crash</li>
<li>Enter an unusual file name combinations such as <cite>ENGINX_1000-2000</cite> which combines a filename and
multi run number</li>
<li>Enter bad input to expected peaks</li>
<li>Change any unlocked dialog boxes whilst <cite>Fit</cite> runs</li>
</ul>
</div>
</div>
<div class="section" id="gsas-fitting">
<span id="gsas-fitting-engineering-diffraction-test-ref"></span><h2><a class="toc-backref" href="#id13">GSAS Fitting</a><a class="headerlink" href="#gsas-fitting" title="Permalink to this headline">¶</a></h2>
<p>GSAS-style fitting allows the user to plot peaks from their focused
NeXuS file (obtained from
<a class="reference internal" href="#focus-engineering-diffraction-test-ref"><span class="std std-ref">Focus</span></a>).</p>
<p>After a fit has run, the plot should look something like below:</p>
<img alt="../_images/EnggDiffExampleGSASOutput.png" src="../_images/EnggDiffExampleGSASOutput.png" />
<p>If that fit output (the red line) is flat, or just follows the
background of the data, the fit was not unsuccessful. Make sure you’re
using the right <code class="docutils literal notranslate"><span class="pre">.cif</span></code> and <code class="docutils literal notranslate"><span class="pre">.prm</span></code> files for your run. You can find
an example of files which work nicely together on most PRs related to
the GSAS tab or GSASIIRefineFitPeaks, or have a look <a class="reference external" href="https://github.com/mantidproject/mantid/files/1739753/GSASIIRefineFitPeaks.zip">here</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">At the moment, you will also just get background if you
try to do a Pawley refinement, as this is still under
development, possibly requiring input from ENGINX
scientists or GSAS-II developers (probably both)</p>
</div>
<p>You can navigate around the plot in the same way as the Fitting tab.</p>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id14">Negative Testing Ideas</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Using an unfocused .nxs file - Mantid shouldn’t crash</li>
<li>Enter bad input into the text entries - this should be handled
elegantly</li>
<li>Change any unlocked dialogs and click any unlocked buttons while
refinement is running</li>
<li>Cancel the algorithm before exiting the GUI, and vice verse</li>
</ul>
</div>
</div>
<div class="section" id="settings">
<span id="settings-engineering-diffraction-test-ref"></span><h2><a class="toc-backref" href="#id15">Settings</a><a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="first docutils">
<dt><cite>Input directories/folders</cite></dt>
<dd><p class="first last">Used as additional search locations when only a run number
is specified such as <cite>193749</cite>. These do not need to be set for the browse (full paths) to work.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>Pixel Calibration</cite></dt>
<dd><p class="first last">Is used for a full calibration run. Before each run they perform a quick
calibration which is accounted for in the <a class="reference internal" href="#calibration-engineering-diffraction-test-ref"><span class="std std-ref">Calibration</span></a> tab.
Every couple of years they perform a long calibration which is then processed and used as a baseline
which is set here.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>Force recalculate</cite></dt>
<dd><p class="first last">Useful whilst troubleshooting calibrations if you think a cached calibration
is incorrect or you are testing the calibration algorithm. However this incurs a significant speed
penalty as calibration is run every time instead of just reusing the results.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><cite>Focusing settings</cite></dt>
<dd><p class="first last">Allows the user to specify the output directory of their own focused runs
it defaults to <cite>C:\EnginX_Mantid\Focus</cite> or <cite>~/EnginX_Mantid/Focus</cite> but can be changed to
suit the users needs.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IndirectInelastic/IndirectInelasticAcceptanceTests.html" title="Previous Chapter: Indirect Inelastic Testing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Indirect Inel...</span>
    </a>
  </li>
  <li>
    <a href="ErrorReporter-ProjectRecovery/ErrorReporterTesting.html" title="Next Chapter: Error Reporter Testing"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Error Reporte... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>