<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SliceViewer Testing</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=77160d70" />
    <script src="../../_static/documentation_options.js?v=30d551ce"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Muon Analysis Test Guides" href="../MuonAnalysis_test_guides/index.html" />
    <link rel="prev" title="MSlice Testing" href="../Direct/MSliceTestGuide.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../../index.html">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
<div class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &#187;</li>
    
    <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Testing</a> &#187;</li>
    
    
    
    
    <li class="nav-item nav-item-this"><a href="">SliceViewer Testing</a></li>
    
    
  </ul>
</div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="sliceviewer-testing">
<span id="id1"></span><h1>SliceViewer Testing<a class="headerlink" href="#sliceviewer-testing" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#basic-usage" id="id3">Basic Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#matrixworkspace" id="id4">MatrixWorkspace</a></p></li>
<li><p><a class="reference internal" href="#md-workspaces" id="id5">MD Workspaces</a></p>
<ul>
<li><p><a class="reference internal" href="#mdworkspace-with-events" id="id6">MDWorkspace (with events)</a></p></li>
<li><p><a class="reference internal" href="#mdhistoworkspace" id="id7">MDHistoWorkspace</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#cutviewer-tool" id="id8">CutViewer Tool</a></p></li>
<li><p><a class="reference internal" href="#specific-tests" id="id9">Specific Tests</a></p>
<ul>
<li><p><a class="reference internal" href="#representation-of-integrated-peaks" id="id10">1. Representation of integrated peaks</a></p></li>
<li><p><a class="reference internal" href="#ads-observer-for-peak-overlay" id="id11">2. ADS observer for peak overlay</a></p></li>
<li><p><a class="reference internal" href="#ads-observer-for-workspace" id="id12">3. ADS observer for workspace</a></p></li>
<li><p><a class="reference internal" href="#ads-observer-for-support-for-nonorthogonal-view" id="id13">4. ADS observer for support for nonorthogonal view</a></p></li>
<li><p><a class="reference internal" href="#check-binmd-called-with-normalizebasisvectors-false-for-hkl-data" id="id14">5. Check BinMD called with NormalizeBasisVectors=False for HKL data</a></p></li>
<li><p><a class="reference internal" href="#check-gets-the-correct-basis-vectors-for-mdhisto-workspaces" id="id15">6. Check gets the correct basis vectors for MDHisto workspaces</a></p></li>
<li><p><a class="reference internal" href="#check-non-orthogonal-view-is-disabled-for-non-q-axes" id="id16">7. Check non-orthogonal view is disabled for non-Q axes</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>The Sliceviewer in Workbench has the joint functionality of the SpectrumViewer and SliceViewer from MantidPlot. So while the advanced use cases for multi-dimensional diffraction data are important to test, it is also worth checking more basic uses, for example opening a Workspace2D and examining the subplots and dynamic cursor data.</p>
<p>See here for a brief overview of the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer" title="(in MantidProject v6.8)"><span>Sliceviewer</span></a>.</p>
</section>
<section id="basic-usage">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Basic Usage</a><a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h2>
<section id="matrixworkspace">
<span id="toolbar-checklist"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink">MatrixWorkspace</a><a class="headerlink" href="#matrixworkspace" title="Link to this heading">¶</a></h3>
<p>Do the following tests with an EventWorkspace (e.g. <code class="docutils literal notranslate"><span class="pre">CNCS_7860_event.nxs</span></code>) and a Workspace2D (e.g. <code class="docutils literal notranslate"><span class="pre">MAR11060.raw</span></code>) from the <a class="reference external" href="https://download.mantidproject.org/">TrainingCourseData</a>.</p>
<ol class="arabic">
<li><p>Load the workspace and open in sliceviewer (right-click on the workspace in the ADS &gt; Show Slice Viewer).</p></li>
<li><p>Confirm that for MatrixWorkspaces the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-roi" title="(in MantidProject v6.8)"><span class="xref std std-ref">Peak overlay</span></a>, <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-nonortho" title="(in MantidProject v6.8)"><span class="xref std std-ref">Nonorthogonal view</span></a> and <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-nonaxiscuts" title="(in MantidProject v6.8)"><span class="xref std std-ref">Non-axis aligned cutting tool</span></a> buttons should be disabled (greyed out).</p></li>
<li><p>Check the other toolbar buttons.</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>Pan and Zoom (use mouse scroll and magnifying glass tool) and Home</p>
<blockquote>
<div><ul class="simple">
<li><p>As you zoom check the color scale changes if autoscale checked in checkbox below colorbar).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Toggle grid lines on/off</p></li>
<li><p>Enable line plots</p>
<blockquote>
<div><ul class="simple">
<li><p>Confirm the curves update with the cursor position correctly</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Export cuts to workspaces in ADS using keys <cite>x</cite>, <cite>y</cite>, <cite>c</cite></p>
<blockquote>
<div><ul class="simple">
<li><p>This should produce workspaces in the ADS with suffix <cite>_cut_x</cite> and <cite>_cut_y</cite></p></li>
<li><p>Plot these in workbench check they agree with sliceviewer plots</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Disable line plots and Enable <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-roi" title="(in MantidProject v6.8)"><span class="xref std std-ref">ROI tool</span></a></p>
<blockquote>
<div><figure class="align-center">
<a class="screenshot reference internal image-reference" href="../../_images/wb-sliceviewer51-roibutton.png"><img alt="../../_images/wb-sliceviewer51-roibutton.png" class="screenshot" src="../../_images/wb-sliceviewer51-roibutton.png" style="width: 50%;" /></a>
</figure>
<ul class="simple">
<li><p>The line plot button should be automatically enabled</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Draw, move and resize the rectangle</p>
<blockquote>
<div><ul>
<li><p>Move it off the axes (it should just clip itself to be contained within the axes).</p></li>
<li><p>Export the cuts with keys <cite>x</cite>, <cite>y</cite>, <cite>c</cite></p></li>
<li><p>In addition the ROI can be exported by pressing <cite>r</cite></p>
<blockquote>
<div><ul class="simple">
<li><p>This should produce another workspace with suffix <cite>_roi</cite></p></li>
<li><p>Open it in sliceviewer and check the data and limits agree with the ROI drawn.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Disable the ROI tool</p>
<ul class="simple">
<li><p>The line plot tool should remain enabled.</p></li>
</ul>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Try saving the figure (with and without ROI/lineplots).</p></li>
<li><p>Test the colorbar and colorscale</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>Change normalisation</p>
<blockquote>
<div><ul class="simple">
<li><p>The color limits should only change if autoscale is enabled.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Change the scale type to e.g. Log</p>
<blockquote>
<div><ul class="simple">
<li><p>In Log scale bins with 0 counts should appear white</p></li>
<li><p>When you zoom in to a region comprising only of bins with 0 counts it will set the color axis limits to (0.1,1) and force the scale to be linear</p></li>
<li><p>Zoom in to a region outside the extent of the data, check the Log colorscale option is disabled.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Change colormap</p></li>
<li><p>Reverse colormap</p></li>
<li><p>Change auto-scale option from default <cite>Min/Max</cite>  to another e.g. <cite>3-sigma</cite></p></li>
</ol>
</div></blockquote>
</li>
<li><p>Test transposing axes: click the Y button to the right of the Time-of-flight label (top left corner) - the image should be transposed and the axes labels updated.</p></li>
<li><p>Test the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-cursor" title="(in MantidProject v6.8)"><span class="xref std std-ref">Cursor Information Widget</span></a> (table at top of sliceviewer window with TOF, spectrum, DetID etc.)</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Confirm it tracks with the cursor when Track Cursor is checked</p></li>
<li><p>Uncheck the track cursor and confirm it updates when the cursor is clicked.</p></li>
<li><p>Transpose the axes (as in step 6) and confirm the cursor position displayed is still correct.</p></li>
</ol>
</div></blockquote>
</li>
<li><p>Resize the sliceviewer window, check the widgets, buttons etc. are still visible and clear for reasonable aspect ratios.</p></li>
</ol>
</section>
<section id="md-workspaces">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">MD Workspaces</a><a class="headerlink" href="#md-workspaces" title="Link to this heading">¶</a></h3>
<p>MD workspaces hold multi-dimensional data (typically 2-4D) and come in two forms: <a class="reference external" href="https://docs.mantidproject.org/nightly/concepts/MDWorkspace.html#mdworkspace" title="(in MantidProject v6.8)"><span class="xref std std-ref">MDEventWorkspace</span></a>, <a class="reference external" href="https://docs.mantidproject.org/nightly/concepts/MDHistoWorkspace.html#mdhistoworkspace" title="(in MantidProject v6.8)"><span class="xref std std-ref">MDHistoWorkspace</span></a>.
In terms of sliceviewer functionality, the key difference is that MDHistoWorkspace have binned the events onto a regular grid and cannot be dynamically rebinned unless the original MDWorkspace
(that holds the events) exists in the ADS (and the MDHistoWorkspace has not been altered by a binary operation e.g. <code class="docutils literal notranslate"><span class="pre">MinusMD</span></code>).</p>
<section id="mdworkspace-with-events">
<span id="md-event-tests"></span><h4><a class="toc-backref" href="#id6" role="doc-backlink">MDWorkspace (with events)</a><a class="headerlink" href="#mdworkspace-with-events" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Create a 3D and 4D MDWorkspaces with some data - repeat the following tests with both <code class="docutils literal notranslate"><span class="pre">md_4D</span></code> and <code class="docutils literal notranslate"><span class="pre">md_3D</span></code>. Note this will throw a warning relating to the <code class="docutils literal notranslate"><span class="pre">SlicingAlgorithm</span></code>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">md_4D</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">],</span> <span class="n">Names</span><span class="o">=</span><span class="s2">&quot;H,K,L,E&quot;</span><span class="p">,</span> <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;HKL,HKL,HKL,General Frame&#39;</span><span class="p">,</span><span class="n">Units</span><span class="o">=</span><span class="s1">&#39;r.l.u.,r.l.u.,r.l.u.,meV&#39;</span><span class="p">)</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">md_4D</span><span class="p">,</span> <span class="n">UniformParams</span><span class="o">=</span><span class="s1">&#39;5e5&#39;</span><span class="p">)</span> <span class="c1"># 4D data</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">md_4D</span><span class="p">,</span> <span class="n">UniformParams</span><span class="o">=</span><span class="s1">&#39;1e5,0.5,1.5,-0.5,0.5,-0.75,0.75,-0.1,0.1&#39;</span><span class="p">)</span> <span class="c1"># 4D data</span>

<span class="c1"># Add a non-orthogonal UB</span>
<span class="n">expt_info</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="n">md_4D</span><span class="o">.</span><span class="n">addExperimentInfo</span><span class="p">(</span><span class="n">expt_info</span><span class="p">)</span>
<span class="n">SetUB</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;md_4D&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="c1"># make a 3D MDEvent workspace by integrating over all E</span>
<span class="n">md_3D</span> <span class="o">=</span> <span class="n">SliceMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_4D&#39;</span><span class="p">,</span> <span class="n">AlignedDim0</span><span class="o">=</span><span class="s1">&#39;H,0,2,100&#39;</span><span class="p">,</span> <span class="n">AlignedDim1</span><span class="o">=</span><span class="s1">&#39;K,-1,1,100&#39;</span><span class="p">,</span> <span class="n">AlignedDim2</span><span class="o">=</span><span class="s1">&#39;L,-1.5,1.5,100&#39;</span><span class="p">)</span>

<span class="c1"># Create a peaks workspace and fake data in 3D MD</span>
<span class="n">CreatePeaksWorkspace</span><span class="p">(</span><span class="n">InstrumentWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3D&#39;</span><span class="p">,</span> <span class="n">NumberOfPeaks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">)</span>
<span class="n">CopySample</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3D&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">CopyName</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">CopyMaterial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">CopyEnvironment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">CopyShape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">AddPeakHKL</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">HKL</span><span class="o">=</span><span class="s1">&#39;1,0,1&#39;</span><span class="p">)</span>
<span class="n">AddPeakHKL</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">HKL</span><span class="o">=</span><span class="s1">&#39;1,0,0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Test the toolbar buttons pan, zoom, line plots, ROI as in step 3 of the <a class="reference internal" href="#toolbar-checklist"><span class="std std-ref">MatrixWorkspace</span></a> instructions.</p>
<blockquote>
<div><ul class="simple">
<li><p>This workspace should be dynamically rebinned - i.e. the number of bins within the view limits along each axis should be preserved when zooming.</p></li>
<li><p>The cursor info table should also display the HKL of the cursor</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Change the number of bins along one of the viewing axes (easier to pick a small number e.g. 2)</p></li>
<li><p>Change the integration-width/slice-thickness (spinbox to the left of the word <cite>thick</cite>) along the non-viewed axes.</p>
<blockquote>
<div><ul class="simple">
<li><p>Increasing the width should improve the stats on the uniform background and the color limit should increase (event counts are summed not averaged).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Change the slicepoint along one of the non-viewed axes</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Confirm the slider moves when the spinbox value is updated.</p></li>
<li><p>Confirm moving the slider updates the spinbox.</p></li>
<li><p>Check the slicepoint is updated in the cursor info table.</p></li>
</ol>
</div></blockquote>
</li>
</ol>
<p>Test the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-nonortho" title="(in MantidProject v6.8)"><span class="xref std std-ref">Nonorthogonal view</span></a></p>
<figure class="align-center">
<img alt="../../_images/wb-sliceviewer51-nonorthobutton.png" class="screenshot" src="../../_images/wb-sliceviewer51-nonorthobutton.png" />
</figure>
<ol class="arabic">
<li><p>Click the nonorthogonal view button in the toolbar</p>
<blockquote>
<div><ul class="simple">
<li><p>This should disable ROI and lineplot buttons in the toolbar</p></li>
<li><p>This should automatically turn on gridlines</p></li>
<li><p>When H and K are the viewing axes the gridlines should not be perpendicular to each other</p></li>
<li><p>The features in the data should align with the grid lines</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Zoom and pan</p>
<blockquote>
<div><ul class="simple">
<li><p>Confirm the autoscaling of the colorbar works in non-orthogonal view</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Change one of the viewing axes to be <cite>L</cite> (e.g. click <cite>X</cite> button next to L in top left of window)</p>
<blockquote>
<div><ul class="simple">
<li><p>Gridlines should now appear to be orthogonal</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">md_4D</span></code> only change one of the viewing axes to be <cite>E</cite> (e.g. click <cite>Y</cite> button next to <cite>E</cite> in top left of window)</p>
<blockquote>
<div><ul>
<li><p>Nonorthogonal view should be disabled (only enabled for momentum axes)</p></li>
<li><p>Line plots and ROI should be enabled</p></li>
<li><p>Change the viewing axis presently selected as <cite>E</cite> to be a momentum axis (e.g. <cite>H</cite>)</p>
<blockquote>
<div><ul class="simple">
<li><p>The nonorthogonal view should be automatically re-enabled.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Test the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-peaks-overlay" title="(in MantidProject v6.8)"><span class="xref std std-ref">Peak Overlay</span></a></p>
<figure class="align-center">
<img alt="../../_images/wb-sliceviewer51-peaksbutton.png" class="screenshot" src="../../_images/wb-sliceviewer51-peaksbutton.png" />
</figure>
<ol class="arabic">
<li><p>Click to peak overlay button in the toolbar</p></li>
<li><p>Check the <cite>Overlay?</cite> box next to <code class="docutils literal notranslate"><span class="pre">peaks</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>This should open a table (peak viewer) on the RHS of the sliceviewer window - it should have two rows corresponding to peaks at HKL = (1,0,1) and (1,0,0).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Double click a row</p>
<blockquote>
<div><ul class="simple">
<li><p>It should change the slicepoint along the integrated momentum axis and zoom into the peak - e.g. in (X,Y) = (H,K) then the slicepoint along L will be set to 1 and there will be a cross at (0,0).</p></li>
<li><p>Note for <code class="docutils literal notranslate"><span class="pre">md_4D</span></code> a peak will not be plotted if a non-Q axis is viewed, if both axes are Q-dimensions then the cross should be plotted at all E (obviously a Bragg peak will only be on the elastic line but the peak object has no elastic/inelastic logic and the sliceviewer only knows that <cite>E</cite> is not a momentum axis, it could be temperature etc.).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Click Add Peaks in the Peak Actions section at the top of the peak viewer (note for 4D workspaces the peak overlay won’t work for non_Q dimensions).</p></li>
<li><p>Click somewhere in the colorfill plot</p>
<blockquote>
<div><ul class="simple">
<li><p>Confirm a peak has been added to the table at the position you clicked</p></li>
<li><p>Note that peaks need to have H &gt; 0 to be valid due to the assumed beam direction (otherwise you will get an error in the log <code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">Peak::setQLabFrame():</span> <span class="pre">Wavelength</span> <span class="pre">found</span> <span class="pre">was</span> <span class="pre">negative</span></code>)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Click Remove Peaks</p></li>
<li><p>Click on the cross corresponding to the peak you just added</p>
<blockquote>
<div><ul class="simple">
<li><p>Confirm the correct row has been removed from the table</p></li>
<li><p>The cross should be removed from the plot</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Repeat the above steps 1-7 in non-orthogonal view.</p></li>
<li><p>Check the <code class="docutils literal notranslate"><span class="pre">Concise</span> <span class="pre">View</span></code> checkbox above one of the peak tables on the right hand side - this should hide some columns.</p></li>
</ol>
</section>
<section id="mdhistoworkspace">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">MDHistoWorkspace</a><a class="headerlink" href="#mdhistoworkspace" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Make a 3D MDHistoWorkspace</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">md_3D_histo</span> <span class="o">=</span> <span class="n">BinMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_4D&#39;</span><span class="p">,</span> <span class="n">AlignedDim0</span><span class="o">=</span><span class="s1">&#39;H,-2,2,100&#39;</span><span class="p">,</span> <span class="n">AlignedDim1</span><span class="o">=</span><span class="s1">&#39;K,-1,1,100&#39;</span><span class="p">,</span> <span class="n">AlignedDim2</span><span class="o">=</span><span class="s1">&#39;L,-1.5,1.5,100&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">md_3D_histo</span></code> in sliceviewer it should not support dynamic rebinning (can’t change number of bins).</p></li>
<li><p>Test the toolbar buttons pan, zoom, line plots, ROI as in step 3 of the <a class="reference internal" href="#toolbar-checklist"><span class="std std-ref">MatrixWorkspace</span></a> instructions.</p></li>
<li><p>Test changing/swapping viewing axes</p></li>
<li><p>Test the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-nonortho" title="(in MantidProject v6.8)"><span class="xref std std-ref">Nonorthogonal view</span></a> as above</p></li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">md_4D_svrebinned</span></code> in sliceviewer (should be in the ADS after preceding tests).</p>
<blockquote>
<div><ul class="simple">
<li><p>It should support dynamic rebinning (i.e. will be able to change number of bins along each axis).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>With <code class="docutils literal notranslate"><span class="pre">md_4D_svrebinned</span></code> open in the sliceviewer, delete <code class="docutils literal notranslate"><span class="pre">md_4D</span></code> in the ADS.</p>
<blockquote>
<div><ul class="simple">
<li><p>It should close sliceviewer because the support for dynamic rebinning has changed</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">md_4D_svrebinned</span></code> in sliceviewer again</p>
<blockquote>
<div><ul class="simple">
<li><p>It should no longer support dynamic rebinning</p></li>
<li><p>Confirm transposing axes works</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
</section>
</section>
<section id="cutviewer-tool">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">CutViewer Tool</a><a class="headerlink" href="#cutviewer-tool" title="Link to this heading">¶</a></h2>
<p>1. Check the <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html#sliceviewer-nonaxiscuts" title="(in MantidProject v6.8)"><span class="xref std std-ref">Non-axis aligned cutting tool</span></a> button is only enabled for 3D MD workspaces where all dimensions are Q by opening the following workspaces in sliceviewer.
It should only be enabled for the <cite>ws_3D</cite> and <cite>ws_3D_QLab</cite> workspaces (see comment for details) - the first 3 column headers for the vectors should be a*,b*,c* and Qx,Qy,Qz for the two workspaces respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;CNCS_7860_event.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;CNCS_7860_event&#39;</span><span class="p">)</span>  <span class="c1"># disabled (MatrixWorkspace)</span>

<span class="n">ws_2D</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-5,5,-4,4&#39;</span><span class="p">,</span> <span class="n">Names</span><span class="o">=</span><span class="s1">&#39;H,K&#39;</span><span class="p">,</span>
                          <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;r.l.u.,r.l.u.&#39;</span><span class="p">,</span> <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;HKL,HKL&#39;</span><span class="p">,</span>
                          <span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">)</span>  <span class="c1">#  disabled (2D MD)</span>

<span class="n">ws_3D</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-5,5,-4,4,-3,3&#39;</span><span class="p">,</span>
                          <span class="n">Names</span><span class="o">=</span><span class="s1">&#39;H,K,L&#39;</span><span class="p">,</span> <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;r.l.u.,r.l.u.,r.l.u.&#39;</span><span class="p">,</span>
                          <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;HKL,HKL,HKL&#39;</span><span class="p">,</span> <span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">)</span>  <span class="c1"># enabled!</span>

<span class="n">ws_3D_nonQdim</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                          <span class="n">Names</span><span class="o">=</span><span class="s2">&quot;E,H,K&quot;</span><span class="p">,</span> <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;General Frame,HKL,HKL&#39;</span><span class="p">,</span>
                          <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;meV,r.l.u.,r.l.u.&#39;</span><span class="p">)</span>  <span class="c1"># disabled (3D but 1 non-Q)</span>

<span class="n">ws_4D</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                          <span class="n">Names</span><span class="o">=</span><span class="s2">&quot;E,H,K,L&quot;</span><span class="p">,</span> <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;General Frame,HKL,HKL,HKL&#39;</span><span class="p">,</span>
                          <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;meV,r.l.u.,r.l.u.,r.l.u.&#39;</span><span class="p">)</span>  <span class="c1"># disabled (4D - one non-Q)</span>

<span class="n">ws_3D_QLab</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-5,5,-4,4,-3,3&#39;</span><span class="p">,</span>
                               <span class="n">Names</span><span class="o">=</span><span class="s1">&#39;Q_lab_x,Q_lab_y,Q_lab_z&#39;</span><span class="p">,</span> <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;U,U,U&#39;</span><span class="p">,</span>
                               <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;QLab,QLab,QLab&#39;</span><span class="p">,</span> <span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">)</span>  <span class="c1"># enabled!</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Close any sliceviewer windows and clear the workspaces in the ADS</p></li>
<li><p>Run the following and open <cite>ws</cite> in sliceviewer.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-5,5,-4,4,-3,3&#39;</span><span class="p">,</span>
                          <span class="n">Names</span><span class="o">=</span><span class="s1">&#39;H,K,L&#39;</span><span class="p">,</span> <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;r.l.u.,r.l.u.,r.l.u.&#39;</span><span class="p">,</span>
                          <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;HKL,HKL,HKL&#39;</span><span class="p">,</span> <span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">)</span>
<span class="n">expt_info</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="n">SetUB</span><span class="p">(</span><span class="n">expt_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">addExperimentInfo</span><span class="p">(</span><span class="n">expt_info</span><span class="p">)</span>
<span class="c1"># make some fake data</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">UniformParams</span><span class="o">=</span><span class="s1">&#39;1e5&#39;</span><span class="p">,</span> <span class="n">PeakParams</span><span class="o">=</span><span class="s1">&#39;1e+05,0,0,1,0.3&#39;</span><span class="p">,</span> <span class="n">RandomSeed</span><span class="o">=</span><span class="s1">&#39;3873875&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic" start="4">
<li><p>Open the cut tool and check that:</p>
<blockquote>
<div><ul class="simple">
<li><p>Disabled ROI tool</p></li>
<li><p>Disabled line plots</p></li>
<li><p>Sliceviewer should look like</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<figure class="align-center">
<img alt="../../_images/CutViewer_HKplane.png" class="screenshot" src="../../_images/CutViewer_HKplane.png" />
</figure>
<ol class="arabic simple" start="6">
<li><p>Check that transposing the axes (X &lt;-&gt; Y) will swap the u1 and u2 vectors in the table</p></li>
<li><p>Set the axes to (X,Y) = (L, K) - check u1 = [0,0,1] and u2 = [0,1,0]</p></li>
<li><p>Change the slice point of H to be 0 - it should look like this</p></li>
</ol>
<figure class="align-center">
<img alt="../../_images/CutViewer_KLplane.png" class="screenshot" src="../../_images/CutViewer_KLplane.png" />
</figure>
<ol class="arabic simple" start="9">
<li><p>In the table double the step along u1 (i.e. set step to 0.12) - this should change nbins = 25 along u1</p></li>
<li><p>Set the nbins = 50 along u1 - the step should go back to it’s original value (0.06)</p></li>
<li><p>Set the stop for u1 to 0 and check that</p>
<ul class="simple">
<li><p>step size = 0.03</p></li>
<li><p>the cut representation line on the colorfill plot has the correct start/stop</p></li>
<li><p>the 1D plot in the cut viewer pane has the correct axes limits</p></li>
</ul>
</li>
<li><p>Set step of u1 to be 2 (i.e. greater than the extent of the cut) - this should set nbins=1 and step = 1.5 and put the cut along u2 with nbins = 50.</p></li>
<li><p>Transpose the axes so now (X,Y) = (K,L) - the cut should have 50 bins along K (default value)</p></li>
<li><p>Change the nbins of u2 to 50 (it should set nbins=1 for u1 and change the step=4). Check the white line of the cut representation on the colorfill plot is now vertical.</p></li>
<li><p>Try to change the a* column of the u1 to 1 (this would take u1 out of the plane of the slice, i.e. not orthogonal to u3) - it should reset to 0 - i.e. u1 = [0,1,0].</p></li>
<li><p>Click and hold down on one of the red markers with white face on the colorfill plot and drag, release at ~K=1.</p>
<ul class="simple">
<li><p>This should reset the vectors in the table such that the cut is along u1 = [0,0,1] - i.e. u1 and u2 are swapped</p></li>
<li><p>The thickness along u2 should be adjusted to ~2</p></li>
</ul>
</li>
<li><p>Set the step of u2 = 2 in the table, check that it sets (start,stop) = (-1,1)</p></li>
<li><p>Drag the top white marker of the cut representation up to L~2</p>
<ul class="simple">
<li><p>u1 ~ [0,0,1]  and u2 ~ [0,1,0]</p></li>
<li><p>There should be a peak in the 1D plot at x~1</p></li>
</ul>
</li>
<li><p>For u1 set b*=0 and c* = -1 and start=-2 - check that u2 = [0,-1,0] and there is a peak at x~-1</p></li>
<li><p>To change the centre of the cut move the central white marker of the cut representation to (K,L) ~ (2,0),</p>
<ul class="simple">
<li><p>The entire cut representation should move</p></li>
<li><p>The axes label of the 1D plot should be similar to <code class="docutils literal notranslate"><span class="pre">(0.0,</span> <span class="pre">2.0,0.0-1.0x)</span> <span class="pre">in</span> <span class="pre">3.14</span> <span class="pre">Ang^-1</span></code></p></li>
<li><p>There should be no peak on the 1D plot</p></li>
</ul>
</li>
<li><p>Increase the thickness by dragging the left red marker of the cut representation to encompass the peak in the data - check the peak appears in the 1D plot at the right thickness.</p></li>
<li><p>Play around with the direction of the cut by dragging the white markers at the end points of the white line - the vectors u1 and u3 should be orthogonal unit vectors.</p></li>
<li><p>Reset the cut by transposing the axes so (X,Y) = (L,K)</p></li>
<li><p>Double the slice thickness along H from 0.1 -&gt; 0.2 (the counts of the peak in the 1D plot should double from ~2000 -&gt; ~4000)</p></li>
<li><p>Change c* of u1 from 1 -&gt; -1</p>
<ul class="simple">
<li><p>The peak in the 1D plot should move from x= 1 -&gt; -1</p></li>
<li><p>Check u2 = [0,-1,0]</p></li>
</ul>
</li>
<li><p>Turn on non-orthogonal view and play around with the cut tool representation</p>
<ul class="simple">
<li><p>Check that the table values are updated correctly (use the HKL in the cursor info table to help determine this)</p></li>
</ul>
</li>
<li><p>Produce a non-axis aligned cut where the peak is not in the center of the x-range. Take the x-value at the peak maximum and plug it into the axis label - it should produce the HKL of the peak (0,0,1).</p></li>
</ol>
</section>
<section id="specific-tests">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Specific Tests</a><a class="headerlink" href="#specific-tests" title="Link to this heading">¶</a></h2>
<section id="representation-of-integrated-peaks">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">1. Representation of integrated peaks</a><a class="headerlink" href="#representation-of-integrated-peaks" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Run the code below to generate fake data and integrate peaks in the 3D MDWorkspace <code class="docutils literal notranslate"><span class="pre">md_3D</span></code> from <a class="reference internal" href="#md-event-tests"><span class="std std-ref">MDWorkspace (with events)</span></a></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fake data in 3D MD and integrate</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">md_3D</span><span class="p">,</span> <span class="n">EllipsoidParams</span><span class="o">=</span><span class="s1">&#39;1e4,1,0,1,1,0,0,0,1,0,0,0,1,0.005,0.005,0.015,0&#39;</span><span class="p">,</span> <span class="n">RandomSeed</span><span class="o">=</span><span class="s1">&#39;3873875&#39;</span><span class="p">)</span> <span class="c1"># ellipsoid</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">md_3D</span><span class="p">,</span> <span class="n">EllipsoidParams</span><span class="o">=</span><span class="s1">&#39;1e4,1,0,0,1,0,0,0,1,0,0,0,1,0.005,0.005,0.005,0&#39;</span><span class="p">,</span> <span class="n">RandomSeed</span><span class="o">=</span><span class="s1">&#39;3873875&#39;</span><span class="p">)</span>  <span class="c1"># spherical</span>
<span class="n">IntegratePeaksMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3D&#39;</span><span class="p">,</span> <span class="n">PeakRadius</span><span class="o">=</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span> <span class="n">BackgroundInnerRadius</span><span class="o">=</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span> <span class="n">BackgroundOuterRadius</span><span class="o">=</span><span class="s1">&#39;0.32&#39;</span><span class="p">,</span> <span class="n">PeaksWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks_int_ellip&#39;</span><span class="p">,</span> <span class="n">IntegrateIfOnEdge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Ellipsoid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">UseOnePercentBackgroundCorrection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">IntegratePeaksMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3D&#39;</span><span class="p">,</span> <span class="n">PeakRadius</span><span class="o">=</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span> <span class="n">BackgroundInnerRadius</span><span class="o">=</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span> <span class="n">BackgroundOuterRadius</span><span class="o">=</span><span class="s1">&#39;0.32&#39;</span><span class="p">,</span> <span class="n">PeaksWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks_int_sphere&#39;</span><span class="p">,</span> <span class="n">IntegrateIfOnEdge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Ellipsoid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">UseOnePercentBackgroundCorrection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">IntegratePeaksMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3D&#39;</span><span class="p">,</span> <span class="n">PeakRadius</span><span class="o">=</span><span class="s1">&#39;0.25&#39;</span><span class="p">,</span> <span class="n">BackgroundInnerRadius</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">BackgroundOuterRadius</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">PeaksWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks_int_no_bg&#39;</span><span class="p">,</span> <span class="n">IntegrateIfOnEdge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Ellipsoid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">UseOnePercentBackgroundCorrection</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># IntegratePeaksMD will throw an error</span>
<span class="c1">#   Error in execution of algorithm MaskBTP:...</span>
<span class="c1"># This is because the simulated ws don&#39;t have a real instrument but the integration will be executed</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">md_3D</span></code> in sliceviewer</p></li>
<li><p>Click the peak overlay button in the toolbar</p></li>
<li><p>Overlay <code class="docutils literal notranslate"><span class="pre">peaks_int_ellip</span></code> and <code class="docutils literal notranslate"><span class="pre">peaks_int_sphere</span></code></p></li>
<li><p>Click the first row in the first table</p>
<blockquote>
<div><ul class="simple">
<li><p>It should zoom to a peak.</p></li>
<li><p>There should be an ellipse and a circle drawn with dashed lines with different colors (the color should match the color of the workspace name in the peak viewer table).</p></li>
<li><p>There should be a transparent shell indicating the background for each peak.</p></li>
<li><p>The ellipse should be smaller than the circle.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Alter the slice point by moving the slider along the integrated dimension</p>
<blockquote>
<div><ul class="simple">
<li><p>The circle and ellipse should shrink</p></li>
<li><p>There should be no gap between the background shell and the dashed line.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Click on the second row on the second table.</p>
<blockquote>
<div><ul class="simple">
<li><p>It should zoom in on a different peak.</p></li>
<li><p>The ellipse and circle should be very similar (not quite same as the covariance matrix was evaluated numerically for randomly generated data).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Click the nonorthogonal view button</p></li>
<li><p>The ellipse and circle should still agree with each other and the shape of the generated data.</p></li>
<li><p>Click the Peak overlay button in the toolbar</p></li>
<li><p>Overlay the <code class="docutils literal notranslate"><span class="pre">peaks_int_no_bg</span></code> workspace and remove <code class="docutils literal notranslate"><span class="pre">peaks_int_sphere</span></code></p></li>
<li><p>Zoom in on a peak (click a row in the table)</p>
<ul class="simple">
<li><p>There should be a dashed line but no background shell for peaks in <code class="docutils literal notranslate"><span class="pre">peaks_int_no_bg</span></code></p></li>
</ul>
</li>
</ol>
<p>Keep the three peak workspaces overlain for the next test.</p>
</section>
<section id="ads-observer-for-peak-overlay">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">2. ADS observer for peak overlay</a><a class="headerlink" href="#ads-observer-for-peak-overlay" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Rename <code class="docutils literal notranslate"><span class="pre">peaks_int_ellip</span></code> in the ADS to e.g. <code class="docutils literal notranslate"><span class="pre">peaks_int_ellipse</span></code></p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Confirm the name changes in the peak viewer table</p></li>
<li><p>Click on a peak, the ellipse should still be drawn on the colofill plot</p></li>
</ol>
</div></blockquote>
</li>
<li><p>Remove a row from <code class="docutils literal notranslate"><span class="pre">peaks_int_no_bg</span></code> table (open table from ADS &gt; Right-click on a row &gt; Delete)</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>Confirm the correct row is removed from the corresponding row in the peak viewer table</p></li>
<li><p>Click on the peak in the <code class="docutils literal notranslate"><span class="pre">peaks_int_ellipse</span></code> table that has been removed from <code class="docutils literal notranslate"><span class="pre">peaks_int_no_bg</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Only the ellipse should be plotted.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Delete <code class="docutils literal notranslate"><span class="pre">peaks_int_no_bg</span></code> from the ADS</p>
<blockquote>
<div><ul class="simple">
<li><p>The table should be removed from the peaks viewer</p></li>
<li><p>Confirm the Peak actions combo box is updated to only contain <code class="docutils literal notranslate"><span class="pre">peaks_int_ellipse</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Delete <code class="docutils literal notranslate"><span class="pre">peaks_int_ellipse</span></code> from the ADS</p>
<blockquote>
<div><ul class="simple">
<li><p>The peak overlay should be turned off and the table hidden</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="ads-observer-for-workspace">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">3. ADS observer for workspace</a><a class="headerlink" href="#ads-observer-for-workspace" title="Link to this heading">¶</a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">md_3D</span></code> open in sliceviewer</p>
<ol class="arabic">
<li><p>Rename <code class="docutils literal notranslate"><span class="pre">md_3D</span></code> to e.g. <code class="docutils literal notranslate"><span class="pre">md_3Dim</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>The workspace name in the  title of the sliceviewer window should have updated</p></li>
<li><p>Zoom to check dynamic rebinning still works</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Ensure colorbar autoscale is checked.</p></li>
<li><p>Take a note of the colorbar limits and execute this command in the ipython terminal</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;md_3Dim&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The colorbar max should be doubled.</p></li>
<li><p>Zoom to check dynamic rebinning still works</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Clone the workspace for future tests</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CloneWorkspace</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3Dim&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;md_3D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic" start="5">
<li><p>Delete <code class="docutils literal notranslate"><span class="pre">md_3Dim</span></code> in the ADS</p>
<blockquote>
<div><ul class="simple">
<li><p>The sliceviewer window should close</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="ads-observer-for-support-for-nonorthogonal-view">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">4. ADS observer for support for nonorthogonal view</a><a class="headerlink" href="#ads-observer-for-support-for-nonorthogonal-view" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">md_3D</span></code> in sliceviewer</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">ClearUB</span></code> algorithm on <code class="docutils literal notranslate"><span class="pre">md_3D</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Sliceviewer window should close with message <code class="docutils literal notranslate"><span class="pre">Closing</span> <span class="pre">Sliceviewer</span> <span class="pre">as</span> <span class="pre">the</span> <span class="pre">underlying</span> <span class="pre">workspace</span> <span class="pre">was</span> <span class="pre">changed:</span> <span class="pre">The</span> <span class="pre">property</span> <span class="pre">supports_nonorthogonal_axes</span> <span class="pre">is</span> <span class="pre">different</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">new</span> <span class="pre">workspace.</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="check-binmd-called-with-normalizebasisvectors-false-for-hkl-data">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">5. Check BinMD called with NormalizeBasisVectors=False for HKL data</a><a class="headerlink" href="#check-binmd-called-with-normalizebasisvectors-false-for-hkl-data" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Create a workspace with peaks at integer HKL and take a non axis-aligned cut</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-3,3,-3,3,-3,3&#39;</span><span class="p">,</span>
                       <span class="n">Names</span><span class="o">=</span><span class="s1">&#39;H,K,L&#39;</span><span class="p">,</span> <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;r.l.u.,r.l.u.,r.l.u.&#39;</span><span class="p">,</span>
                       <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;HKL,HKL,HKL&#39;</span><span class="p">,</span>
                       <span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>

<span class="c1"># add fake Bragg peaks for primitive lattice in data</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">hkl</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]])</span>
            <span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">PeakParams</span><span class="o">=</span><span class="s1">&#39;1e+02,&#39;</span> <span class="o">+</span> <span class="n">hkl</span> <span class="o">+</span> <span class="s1">&#39;,0.02&#39;</span><span class="p">,</span> <span class="n">RandomSeed</span><span class="o">=</span><span class="s1">&#39;3873875&#39;</span><span class="p">)</span>

<span class="n">BinMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">AxisAligned</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">BasisVector0</span><span class="o">=</span><span class="s1">&#39;[00L],U,0,0,1&#39;</span><span class="p">,</span>
    <span class="n">BasisVector1</span><span class="o">=</span><span class="s1">&#39;[HH0],U,1,1,0&#39;</span><span class="p">,</span>
    <span class="n">BasisVector2</span><span class="o">=</span><span class="s1">&#39;[-HH0],U,-1,1,0&#39;</span><span class="p">,</span>
    <span class="n">OutputExtents</span><span class="o">=</span><span class="s1">&#39;-4,4,-4,4,-0.25,0.25&#39;</span><span class="p">,</span>
    <span class="n">OutputBins</span><span class="o">=</span><span class="s1">&#39;101,101,1&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;BinMD_out&#39;</span><span class="p">,</span> <span class="n">NormalizeBasisVectors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">BinMD_out</span></code> in sliceviewer.</p>
<blockquote>
<div><ul class="simple">
<li><p>There should be peaks at integer HKL</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Zoom in (so that the data are rebinned)</p>
<blockquote>
<div><ul class="simple">
<li><p>The peaks should still be at integer HKL (rather than multiples of <span class="math notranslate nohighlight">\(\sqrt{2}\)</span>)</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="check-gets-the-correct-basis-vectors-for-mdhisto-workspaces">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">6. Check gets the correct basis vectors for MDHisto workspaces</a><a class="headerlink" href="#check-gets-the-correct-basis-vectors-for-mdhisto-workspaces" title="Link to this heading">¶</a></h3>
<p>This tests that the sliceviewer gets the correct basis vectors for an <code class="docutils literal notranslate"><span class="pre">MDHisto</span></code> object from a non-axis aligned cut.</p>
<ol class="arabic simple">
<li><p>Create the workspace</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-3,3,-3,3,-3,3&#39;</span><span class="p">,</span>
                   <span class="n">Names</span><span class="o">=</span><span class="s1">&#39;H,K,L&#39;</span><span class="p">,</span> <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;r.l.u.,r.l.u.,r.l.u.&#39;</span><span class="p">,</span>
                   <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;HKL,HKL,HKL&#39;</span><span class="p">,</span>
                   <span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>
<span class="n">expt_info</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="n">ws</span><span class="o">.</span><span class="n">addExperimentInfo</span><span class="p">(</span><span class="n">expt_info</span><span class="p">)</span>
<span class="n">SetUB</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
<span class="n">BinMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">AxisAligned</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">BasisVector0</span><span class="o">=</span><span class="s1">&#39;[00L],r.l.u.,0,0,1&#39;</span><span class="p">,</span>
    <span class="n">BasisVector1</span><span class="o">=</span><span class="s1">&#39;[HH0],r.l.u.,1,1,0&#39;</span><span class="p">,</span>
    <span class="n">BasisVector2</span><span class="o">=</span><span class="s1">&#39;[-HH0],r.l.u.,-1,1,0&#39;</span><span class="p">,</span>
    <span class="n">OutputExtents</span><span class="o">=</span><span class="s1">&#39;-4,4,-4,4,-0.25,0.25&#39;</span><span class="p">,</span>
    <span class="n">OutputBins</span><span class="o">=</span><span class="s1">&#39;101,101,1&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws_slice&#39;</span><span class="p">,</span> <span class="n">NormalizeBasisVectors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">ws_slice</span></code> in the sliceviewer.</p>
<blockquote>
<div><ul class="simple">
<li><p>The non-orthogonal view should be enabled (not greyed out).</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Click the non-orthogonal view button</p>
<blockquote>
<div><ul class="simple">
<li><p>Rectangular gridlines should appear (as in this case 110 is orthogonal to 001).</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="check-non-orthogonal-view-is-disabled-for-non-q-axes">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">7. Check non-orthogonal view is disabled for non-Q axes</a><a class="headerlink" href="#check-non-orthogonal-view-is-disabled-for-non-q-axes" title="Link to this heading">¶</a></h3>
<p>Check that the non-orthogonal view is disabled for non-Q axes such as energy</p>
<ol class="arabic simple">
<li><p>Create a workspace with energy as the first axis.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws_4D</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Names</span><span class="o">=</span><span class="s2">&quot;E,H,K,L&quot;</span><span class="p">,</span>
                              <span class="n">Frames</span><span class="o">=</span><span class="s1">&#39;General Frame,HKL,HKL,HKL&#39;</span><span class="p">,</span> <span class="n">Units</span><span class="o">=</span><span class="s1">&#39;meV,r.l.u.,r.l.u.,r.l.u.&#39;</span><span class="p">)</span>
<span class="n">expt_info_4D</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="n">ws_4D</span><span class="o">.</span><span class="n">addExperimentInfo</span><span class="p">(</span><span class="n">expt_info_4D</span><span class="p">)</span>
<span class="n">SetUB</span><span class="p">(</span><span class="n">ws_4D</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">ws_4D</span></code> in sliceviewer.</p></li>
<li><p>Confirm that when the Energy axis is viewed (as X or Y) the non-orthogonal view is disabled.</p></li>
<li><p>The button should be re-enabled when you view two Q-axes e.g. H and K.</p></li>
</ol>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="../Direct/MSliceTestGuide.html" title="Previous Chapter: MSlice Testing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MSlice Testing</span>
    </a>
  </li>
  <li>
    <a href="../MuonAnalysis_test_guides/index.html" title="Next Chapter: Muon Analysis Test Guides"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Muon Analysis... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>