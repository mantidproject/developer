<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Engineering Diffraction Testing</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Error Reporter Testing" href="../ErrorReporter-ProjectRecovery/ErrorReporterTesting.html" />
    <link rel="prev" title="Indirect Inelastic Testing" href="../IndirectInelastic/IndirectInelasticAcceptanceTests.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../../index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
<div class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &#187;</li>
    
    <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Testing</a> &#187;</li>
    
    
    
    
    <li class="nav-item nav-item-this"><a href="">Engineering Diffraction Testing</a></li>
    
    
  </ul>
</div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="engineering-diffraction-testing">
<span id="engineering-diffraction-testguide-ref"></span><h1>Engineering Diffraction Testing<a class="headerlink" href="#engineering-diffraction-testing" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#preamble" id="id1">Preamble</a></p></li>
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#test-1" id="id3">Test 1</a></p>
<ul>
<li><p><a class="reference internal" href="#calibration" id="id4">Calibration</a></p></li>
<li><p><a class="reference internal" href="#focus" id="id5">Focus</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#test-2" id="id6">Test 2</a></p></li>
<li><p><a class="reference internal" href="#test-3" id="id7">Test 3</a></p></li>
<li><p><a class="reference internal" href="#test-4" id="id8">Test 4</a></p></li>
<li><p><a class="reference internal" href="#test-5" id="id9">Test 5</a></p></li>
<li><p><a class="reference internal" href="#test-6" id="id10">Test 6</a></p></li>
<li><p><a class="reference internal" href="#test-7" id="id11">Test 7</a></p></li>
<li><p><a class="reference internal" href="#test-8" id="id12">Test 8</a></p></li>
<li><p><a class="reference internal" href="#test-9" id="id13">Test 9</a></p></li>
</ul>
</nav>
<section id="preamble">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Preamble</a><a class="headerlink" href="#preamble" title="Permalink to this heading">¶</a></h2>
<p>This document is tailored towards developers intending to test the Engineering Diffraction
interface.</p>
<p>Runs can be loaded from the archive, however it is possible that different run numbers
will be needed as older runs may be deleted.</p>
</section>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The Engineering Diffraction interface allows scientists using the EnginX instrument to interactively
process their data. There are 4 tabs in total but only the first 3 need testing (the GSAS II tab is being evaluated by the users and is in an extended beta testing phase).
These are:</p>
<ul class="simple">
<li><p>Calibration - This is where a cerium oxide run is entered to calibrate the subsequent data.</p></li>
<li><p>Focus - Where are the data across multiple spectra are normalised and summed into a single spectrum for later steps.</p></li>
<li><p>Fitting - Where peaks can be fitted on focused data</p></li>
</ul>
<p>The tests are designed to be run from a starting point where no settings relating to the Engineering Diffraction Gui
have been saved in the Mantid Workbench ini file. This file is in <code class="docutils literal notranslate"><span class="pre">C:\Users\&lt;fed</span> <span class="pre">id&gt;\AppData\Roaming\mantidproject</span></code> on
Windows and <code class="docutils literal notranslate"><span class="pre">~/.config/mantidproject/</span></code> on linux. To ensure there are no saved settings open up the file mantidworkbench.ini
and delete the settings with names starting with EngineeringDiffraction2 from the CustomInterfaces section</p>
</section>
<section id="test-1">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Test 1</a><a class="headerlink" href="#test-1" title="Permalink to this heading">¶</a></h2>
<p>This test follows the simple steps for calibrating and focusing in the Engineering Diffraction Gui.</p>
<section id="calibration">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Calibration</a><a class="headerlink" href="#calibration" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Ensure you are able to access the ISIS data archive.</p></li>
<li><p>Open the Engineering Diffraction gui: <code class="docutils literal notranslate"><span class="pre">Interfaces</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Diffraction</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Engineering</span> <span class="pre">Diffraction</span></code></p></li>
<li><p>On opening the gui the <cite>Create New Calibration</cite> option should be selected.</p></li>
<li><p>Open the settings dialog from the cog in the bottom left of the gui.</p></li>
<li><p>Set the <cite>Save Location</cite> to a directory of your choice.</p></li>
<li><p>Check that the <cite>Full Calibration</cite> setting has a default path to a .nxs file (currently ENGINX_full_instrument_calibration_193749.nxs)</p></li>
<li><p>Close the settings window</p></li>
<li><p>For the <cite>Calibration Sample #</cite> enter 305738.</p></li>
<li><p>Tick the <cite>Plot Calibrated Workspace</cite> option.</p></li>
<li><p>Click <cite>Calibrate</cite>, after completing calibration it should produce the following plot.</p></li>
</ol>
<a class="reference internal image-reference" href="../../_images/EnggDiffExpectedLinear.png"><img alt="../../_images/EnggDiffExpectedLinear.png" src="../../_images/EnggDiffExpectedLinear.png" style="width: 900px;" /></a>
<ol class="arabic simple" start="11">
<li><p>Check that in your save location there is a Calibration folder containing three .prm files
<cite>ENGINX_305738</cite> with the suffixes <cite>_all_banks</cite>, <cite>_bank_1</cite>, <cite>_bank_2</cite>.</p></li>
<li><p>Close down the Engineering Diffraction gui and reopen it. The <cite>Load Existing Calibration</cite> radio
button should be checked on the Calibration tab and the path should be populated with the
<cite>_all_banks.prm</cite> file generated earlier in this test.</p></li>
<li><p>In the <cite>Load Existing Calibration</cite> box browse to the <cite>_bank_2.prm</cite> file and click the <cite>Load</cite> button.</p></li>
</ol>
</section>
<section id="focus">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Focus</a><a class="headerlink" href="#focus" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Change to the Focus tab.</p></li>
<li><p>For the <cite>Sample Run #</cite> use 305761 and for the <cite>Vanadium #</cite> enter 307521.</p></li>
<li><p>Tick the <cite>Plot Focused Workspace</cite> option and click <cite>Focus</cite>. It should produce a plot of a single spectrum for bank 2.</p></li>
<li><p>Go back to the Calibration tab and load in an existing calibration for both banks e.g. <cite>ENGINX_305738_all_banks.prm</cite></p></li>
<li><p>Go back to the Focus tab and click <cite>Focus</cite>, after completing calibration it should produce a plot.</p></li>
</ol>
<a class="reference internal image-reference" href="../../_images/EnggDiffExampleFocusOutput.png"><img alt="../../_images/EnggDiffExampleFocusOutput.png" src="../../_images/EnggDiffExampleFocusOutput.png" style="width: 900px;" /></a>
<ol class="arabic simple" start="6">
<li><p>Check that in your save location there is a Focus folder containing the following files:
- <cite>ENGINX_305761_307521_bank_1_dSpacing.nxs</cite>, <cite>ENGINX_305761_307521_bank_2_dSpacing.nxs</cite>, <cite>ENGINX_305761_307521_bank_1_TOF.nxs</cite> and <cite>ENGINX_305761_307521_bank_2_TOF.nxs</cite> (i.e. two files, for the xunits TOF and d-Spacing, per spectrum)
- <cite>ENGINX_305761_307521_all_banks.gss</cite> and <cite>ENGINX_305761_307521_all_banks.abc</cite> (i.e. two ASCII files per run - each file contains all the spectra for a focused run).</p></li>
</ol>
</section>
</section>
<section id="test-2">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Test 2</a><a class="headerlink" href="#test-2" title="Permalink to this heading">¶</a></h2>
<p>This test covers the RB number.</p>
<ol class="arabic simple">
<li><p>Enter a string into the <cite>RB Number</cite> box.</p></li>
</ol>
<p>2. Follow the steps of Test 1, any output files (for non-texture ROI) should now be located in both
[Save location]/user/[RB number] and [Save location] (for texture ROI the files will be saved in the first location
if an RB number is specified, otherwise they will be saved in the latter - this is to reduce the number of files being written).</p>
</section>
<section id="test-3">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Test 3</a><a class="headerlink" href="#test-3" title="Permalink to this heading">¶</a></h2>
<p>This test covers the Cropping functionality in the Calibration tab.</p>
<ol class="arabic simple">
<li><p>Change the RB Number to <cite>North</cite>, this is purely to separate the cropped output files into their own space.</p></li>
<li><p>Go to the Calibration tab, select <cite>Create New Calibration</cite> and tick the Crop Calibration option. In the drop down <cite>Region of Interest</cite> select <cite>1 (North)</cite>.</p></li>
<li><p>Check the <cite>Plot Calibrated Workspace</cite> checkbox and click calibrate.</p></li>
<li><p>The generated figure should show a plot of TOF vs d-spacing and plot showing residuals of the quadratic fit</p></li>
<li><p>Check that only one .prm and one .nxs output file was generated.</p></li>
<li><p>Go to focus tab and click <cite>Focus</cite>.</p></li>
<li><p>Change the RB number to <cite>Custom</cite>.</p></li>
<li><p>Repeat steps 2-5 this time setting <cite>Region Of Interest</cite> to <cite>Crop to Spectra</cite> and using <cite>Custom Spectra</cite> <cite>1200-1400</cite> (these spectrum number correspond to the South Bank). Please note that some custom spectra values may
cause the algorithms to fail.</p></li>
<li><p>Repeat steps 2-5 with <cite>Region of Interest</cite> set to <cite>Texture (20 spec)</cite> - there should be 20 spectra per run.</p></li>
</ol>
</section>
<section id="test-4">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Test 4</a><a class="headerlink" href="#test-4" title="Permalink to this heading">¶</a></h2>
<p>This test covers the loading and plotting focused data in the fitting tab. It is advisable to have at least two focused datasets for the subsequent tests: this could be the two banks of run 305761 already generated, but a better test would be to use focussed data for runs 305793-305795 which have different stress and strain log values.</p>
<ol class="arabic simple">
<li><p>Navigate to one or more focused TOF .nxs files in the <cite>Load Focused Data</cite> section. If this test is run immediately after the previous one, the path to the focused files should be auto populated</p></li>
<li><p>Click the <cite>Load</cite> button. A row should be added to the UI table for each focused run.There should be a grouped workspace with the suffix <cite>_logs</cite> in the ADS with tables    corresponding to each log value specified in the settings (to open the settings use the cog in the bottom left corner of the UI). Each row in these tables should correspond to the equivalent row in the UI table. There should be an additional table called <cite>run_info</cite> that provides some of the metadata for each run.</p></li>
<li><p>The log values that are averaged can be selected in the settings (cog button in the bottom left corner of the UI). Change them and close the UI. Open a new instance of the UI to check these settings have been remembered. note that any change to the selected logs won’t take effect in the current session.</p></li>
<li><p>Repeat steps 1-2 above but this time try checking the <cite>Add To Plot</cite> checkbox, when loading the run(s) the data should now be plotted and the checkbox in the <cite>Plot</cite> column of the UI table should be checked.</p></li>
<li><p>Repeat steps 1-2 again but load the d-spacing .nxs file(s) instead</p></li>
<li><p>Plot some data and un-dock the plot in the UI by dragging or double-clicking the bar at the top of the plot labelled <cite>Fit Plot</cite>. The plot can now be re-sized.</p></li>
<li><p>To dock it double click the <cite>Fit Plot</cite> bar (or drag to the bottom of the toolbar). You may want to un-dock it again for subsequent tests.</p></li>
</ol>
</section>
<section id="test-5">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Test 5</a><a class="headerlink" href="#test-5" title="Permalink to this heading">¶</a></h2>
<p>This tests the removal of focused runs from the fitting tab.</p>
<ol class="arabic simple">
<li><p>Load multiple runs using the <cite>Browse</cite> button. This should take you to a folder called “Focus” containing .nxs files that have been previously generated from the Focus tab. Select multiple files and click on <cite>Open</cite></p></li>
<li><p>Having loaded multiple runs, select a row in the UI table and then click the <cite>Remove Selected</cite> button below the table. The row should be removed, if the run was plotted it will disappear from the plot and there should be one less row in each of the table workspaces inside the “_logs” workspace group with each row corresponding to the run in the same row of the UI table. The workspaces called “ENGINX_…._TOF” and “ENGINX_…._TOG_bgsub” will be deleted from the ADS</p></li>
<li><p>Try clicking the <cite>Remove All</cite> button, the UI table should be empty and the workspace group with name ending “_logs” should no longer be present.</p></li>
<li><p>Try loading in a run again, the UI should still be able to access the workspace and remember the log values - check there are no calls to <code class="docutils literal notranslate"><span class="pre">AverageLogData</span></code> in the log (should be visible at notice level).</p></li>
<li><p>Try removing a workspace by deleting it in the ADS, the corresponding row in the log tables and the UI table should have been removed.</p></li>
</ol>
</section>
<section id="test-6">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Test 6</a><a class="headerlink" href="#test-6" title="Permalink to this heading">¶</a></h2>
<p>This tests that the background subtraction works.</p>
<ol class="arabic simple">
<li><p>Load in a run - the <cite>Subtract BG</cite> box should be checked in the UI table by default. This should generate a workspace with suffix <cite>_bg</cite> and the data should look like the background is flat and roughly zero on the plot using the default parameters (other columns in the UI table).</p></li>
<li><p>Select the row in the table and check the <cite>Inspect Background</cite> button should now be enabled regardless of whether the <cite>Subtract BG</cite> box is checked.</p></li>
<li><p>Click  <cite>Inspect Background</cite> to open a new figure which shows the raw data, the background and the subtracted data. Changing the values of Niter, BG, XWindow and SG (input to <code class="docutils literal notranslate"><span class="pre">EnggEstimateFocussedBackground</span></code>, hover over a cell in the table to see a tool tip for explanation) should produce a change in the background on the external plot and in the UI plot.</p></li>
</ol>
</section>
<section id="test-7">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Test 7</a><a class="headerlink" href="#test-7" title="Permalink to this heading">¶</a></h2>
<p>This tests the operation of the fit browser.</p>
<ol class="arabic simple">
<li><p>Check that when no data are plotted the <cite>Fit</cite> button on the toolbar does nothing.</p></li>
<li><p>Plot more than one focused run with xunit of TOF and click the <cite>Fit</cite> button. A simplified version of the standard mantid fit browser should now be visible.</p></li>
<li><p>You should be able to select runs in the Settings &gt; Workspace combo box. If you remove a run the combobox should update. Try adding some peaks (for testing purposes add different types) and a background by right-clicking on the plot. If BackToBackExponential peaks are used then the A,B parameters should be fixed automatically for ENGIN-X data.</p></li>
<li><p>Perform a fit by clicking Fit&gt;Fit in the fit browser. On completion of the fit, a group workspace with suffix <cite>_fits</cite> should have appeared in the ADS. In this group of workspaces there should be a matrix workspace for each parameter fitted (named by convention FunctionName_ParameterName), to view this right-click on the ADS and <cite>Show Data</cite>. For any runs not fit there should be a NaN value in the Y and E fields. In addition there is a workspace that has converted any peak centres from TOF in d-spacing (suffix <cite>_d</cite>). There should be an additional table called <cite>model</cite> that summarises the chisq value and the function string including the best-fit parameters.</p></li>
<li><p>The function string including the best-fit parameters should also have been automatically saved as a custom setup in the fit browser (Setup &gt; Custom Setup). To inspect the fit for a given run, select a custom setup and the values in the fit property browser should update, now click Fit &gt; Evaluate Function.</p></li>
</ol>
</section>
<section id="test-8">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Test 8</a><a class="headerlink" href="#test-8" title="Permalink to this heading">¶</a></h2>
<p>This tests the sequential fitting capability of the UI (where the result of a fit to one workspace is used as the initial guess for the next).</p>
<ol class="arabic simple">
<li><p>Load in several focused runs (preferably some that differ by a log value, e.g. 305793-305795).</p></li>
<li><p>Plot a single run, open the fit browser and input a valid fit function (either manually or from Setup &gt; Custom Setup).</p></li>
<li><p>The <cite>Sequential Fit</cite> button should now be enabled. Click it and the  group of fit workspaces should appear in the ADS, each with a row for each of the runs in the table. All the runs should have been fitted.</p></li>
<li><p>The order of the runs in the sequential fit should be obtainable from the log at notice level - check that this corresponds to the order of the average value of the primary log (which can be selected in the settings, cog in the bottom left corner of the UI).</p></li>
<li><p>Try changing the primary log and the order (ascending/descending) in the settings (note that leaving the primary log blank will make the Sequential fit use the order of the runs in the UI table). Repeat the steps above to check that the sequential fit is operating in the expected order.</p></li>
<li><p>Close the UI and open a new instance, it should remember the primary log and the order.</p></li>
</ol>
</section>
<section id="test-9">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Test 9</a><a class="headerlink" href="#test-9" title="Permalink to this heading">¶</a></h2>
<p>This tests the serial fitting capability of the UI (where all loaded workspaces are fitted from the same starting parameters).</p>
<ol class="arabic simple">
<li><p>Repeat steps 1-2 in the previous test (Test 8).</p></li>
<li><p>The <cite>Serial Fit</cite> button should now be enabled. Click it and the  group of fit workspaces should appear in the ADS, each with a row for each of the runs in the table. All the runs should have been fitted.</p></li>
<li><p>The order of the runs in the serial fit should be obtainable from the log at notice level - check that this corresponds to the order of the runs in the table.</p></li>
</ol>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="../IndirectInelastic/IndirectInelasticAcceptanceTests.html" title="Previous Chapter: Indirect Inelastic Testing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Indirect Inel...</span>
    </a>
  </li>
  <li>
    <a href="../ErrorReporter-ProjectRecovery/ErrorReporterTesting.html" title="Next Chapter: Error Reporter Testing"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Error Reporte... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>