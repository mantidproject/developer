<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ISIS SANS Reduction Back-end</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.12.20180622.2012',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="index.html" />
    <link rel="next" title="Load Algorithm Hook" href="LoadAlgorithmHook.html" />
    <link rel="prev" title="Instrument Viewer Widget" href="InstrumentViewer.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="isis-sans-reduction-back-end">
<span id="isissansreductionbackend"></span><h1>ISIS SANS Reduction Back-end<a class="headerlink" href="#isis-sans-reduction-back-end" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-is-calculated-in-a-sans-reduction" id="id1">What is calculated in a SANS reduction?</a></li>
<li><a class="reference internal" href="#general" id="id2">General</a><ul>
<li><a class="reference internal" href="#introduction-and-motivation" id="id3">Introduction and Motivation</a></li>
<li><a class="reference internal" href="#overview" id="id4">Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sansstate" id="id5"><em>SANSState</em></a><ul>
<li><a class="reference internal" href="#motivation" id="id6">Motivation</a></li>
<li><a class="reference internal" href="#components" id="id7">Components</a><ul>
<li><a class="reference internal" href="#state-base-py" id="id8"><em>state_base.py</em></a></li>
<li><a class="reference internal" href="#individual-states" id="id9">Individual states</a><ul>
<li><a class="reference internal" href="#state-py" id="id10"><em>state.py</em></a></li>
<li><a class="reference internal" href="#data-py" id="id11"><em>data.py</em></a></li>
<li><a class="reference internal" href="#move-py" id="id12"><em>move.py</em></a></li>
<li><a class="reference internal" href="#reduction-mode-py" id="id13"><em>reduction_mode.py</em></a></li>
<li><a class="reference internal" href="#slice-py" id="id14"><em>slice.py</em></a></li>
<li><a class="reference internal" href="#mask-py" id="id15"><em>mask.py</em></a></li>
<li><a class="reference internal" href="#wavelength-py" id="id16"><em>wavelength.py</em></a></li>
<li><a class="reference internal" href="#save-py" id="id17"><em>save.py</em></a></li>
<li><a class="reference internal" href="#scale-py" id="id18"><em>scale.py</em></a></li>
<li><a class="reference internal" href="#adjustment-py" id="id19"><em>adjustment.py</em></a></li>
<li><a class="reference internal" href="#convert-to-q-py" id="id20"><em>convert_to_q.py</em></a></li>
<li><a class="reference internal" href="#compatibility-py" id="id21"><em>compatibility.py</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#state-generation" id="id22">State Generation</a><ul>
<li><a class="reference internal" href="#user-input-dictionary" id="id23">User input dictionary</a></li>
<li><a class="reference internal" href="#builders" id="id24">Builders</a><ul>
<li><a class="reference internal" href="#selection-of-the-builders" id="id25">Selection of the builders</a></li>
</ul>
</li>
<li><a class="reference internal" href="#directors" id="id26">Directors</a><ul>
<li><a class="reference internal" href="#state-director-py" id="id27"><em>state_director.py</em></a></li>
<li><a class="reference internal" href="#user-file-input" id="id28">User file input</a></li>
<li><a class="reference internal" href="#director-for-isiscommandinterface-cli" id="id29">Director for <em>ISISCommandInterface</em> (CLI)</a></li>
<li><a class="reference internal" href="#usage-via-gui" id="id30">Usage via GUI</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-useful-information" id="id31">Other useful information</a><ul>
<li><a class="reference internal" href="#enum-py" id="id32"><em>enum.py</em></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#work-flow-algorithms-for-individual-reduction-steps" id="id33">Work-flow algorithms for individual reduction steps</a><ul>
<li><a class="reference internal" href="#sanscalculatetransmission" id="id34"><em>SANSCalculateTransmission</em></a></li>
<li><a class="reference internal" href="#sansconverttoq" id="id35"><em>SANSConvertToQ</em></a></li>
<li><a class="reference internal" href="#sansconverttowavelength" id="id36"><em>SANSConvertToWavelength</em></a></li>
<li><a class="reference internal" href="#sansconverttowavelengthandrebin" id="id37"><em>SANSConvertToWavelengthAndRebin</em></a></li>
<li><a class="reference internal" href="#sanscreatewavelengthandpixeladjustment" id="id38"><em>SANSCreateWavelengthAndPixelAdjustment</em></a></li>
<li><a class="reference internal" href="#sanscrop" id="id39"><em>SANSCrop</em></a></li>
<li><a class="reference internal" href="#sansload" id="id40"><em>SANSLoad</em></a></li>
<li><a class="reference internal" href="#sansmaskworkspace" id="id41"><em>SANSMaskWorkspace</em></a></li>
<li><a class="reference internal" href="#sansmove" id="id42"><em>SANSMove</em></a></li>
<li><a class="reference internal" href="#sansnormalizetomonitor" id="id43"><em>SANSNormalizeToMonitor</em></a></li>
<li><a class="reference internal" href="#sanssave" id="id44"><em>SANSSave</em></a></li>
<li><a class="reference internal" href="#sansscale" id="id45"><em>SANSScale</em></a></li>
<li><a class="reference internal" href="#sanssliceevent" id="id46"><em>SANSSliceEvent</em></a></li>
</ul>
</li>
<li><a class="reference internal" href="#work-flow-algorithm-orchestration" id="id47">Work-flow algorithm orchestration</a><ul>
<li><a class="reference internal" href="#sansbatchreduction" id="id48"><em>SANSBatchReduction</em></a></li>
<li><a class="reference internal" href="#sanssinglereduction" id="id49"><em>SANSSingleReduction</em></a></li>
<li><a class="reference internal" href="#sansreductioncore" id="id50"><em>SANSReductionCore</em></a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-is-calculated-in-a-sans-reduction">
<h2><a class="toc-backref" href="#id1">What is calculated in a SANS reduction?</a><a class="headerlink" href="#what-is-calculated-in-a-sans-reduction" title="Permalink to this headline">¶</a></h2>
<p>This section gives a summary of what is calculated during the ISIS SANS reduction
without going into implementation details. This is done in some sections below.</p>
<p>The starting point is equation 5 in the article by
Richard Heenan et al, <em>J. Appl. Cryst.</em> (1997), pages 1140-1147. The coherent
macroscopic cross-section is calculated at ISIS using :</p>
<div class="math">
<p><img src="_images/math/38d3b7ba3238985aa6ae43ff68a03491a20803bc.png" alt="\frac{\partial \Sigma}{\partial \Omega} (Q) = \frac{Scale}{V_{SAM}} \frac{\sum_{R,\lambda \subset Q}C(R,\lambda)}{\sum_{R,\lambda \subset Q}M(\lambda)T(\lambda)D(\lambda)F(R)\Omega (R) Cor(R,\lambda)}"/></p>
</div><p>This equation is aiming to do the best job at returning from the measured SANS
data the quantity of interest, the cross-section, <img class="math" src="_images/math/2e46ff746452745210ea0b4d8542ff6c6b8b232e.png" alt="\frac{\partial \Sigma}{\partial \Omega}" style="vertical-align: -7px"/>,
which is an absolute scattering probability, in units of <img class="math" src="_images/math/44e715cdb19c3faa0cf8a3fac108d451e78d4d60.png" alt="cm_{-1}" style="vertical-align: -4px"/>. The <img class="math" src="_images/math/0bc72fbc0159c72d2c8a85780badff1ed5edae8d.png" alt="Scale" style="vertical-align: 0px"/>
factor in the equation above fine tunes the cross-section to give the correct
value (usually based on a fit to scattering from a standard polymer sample).
The value of <img class="math" src="_images/math/0bc72fbc0159c72d2c8a85780badff1ed5edae8d.png" alt="Scale" style="vertical-align: 0px"/>  varies with the instrument set up, and with how the
units and normalisation for the other terms are chosen. <img class="math" src="_images/math/b9595c20abedd22b611e975ef333f8ad81ff1b63.png" alt="C(R,\lambda)" style="vertical-align: -4px"/>
are the observed counts at radius vector <img class="math" src="_images/math/80ea11cbf3510e6208511b42c16940439a65a7e2.png" alt="R" style="vertical-align: 0px"/> from the diffractometer axis
and wavelength <img class="math" src="_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>. <img class="math" src="_images/math/89c6409c839e87e4f0dada70fef4b638402cf2a3.png" alt="V_{SAM}" style="vertical-align: -3px"/> is the volume of the sample.
<img class="math" src="_images/math/6b777c3a3ad16dc29347012a81e27be1df478697.png" alt="M(\lambda)" style="vertical-align: -4px"/> is an incident monitor spectrum. <img class="math" src="_images/math/b6ced05267fc0141162508fb18f42561f3ec6b42.png" alt="D(\lambda)" style="vertical-align: -4px"/> contains
the relative efficiency of the main detector compared to the incident monitor.
<img class="math" src="_images/math/b6ced05267fc0141162508fb18f42561f3ec6b42.png" alt="D(\lambda)" style="vertical-align: -4px"/> is initially determined experimentally, but later subjected
to empirical adjustments. In reality the detector efficiencies implied in
<img class="math" src="_images/math/b6ced05267fc0141162508fb18f42561f3ec6b42.png" alt="D(\lambda)" style="vertical-align: -4px"/> are also pixel dependent. This variation is in part
accounted for by <img class="math" src="_images/math/b9854e5499edc05810ce08f380d086d5f5df315b.png" alt="F(R)" style="vertical-align: -4px"/>, which is called the flat cell or flood source
calibration file. <img class="math" src="_images/math/b9854e5499edc05810ce08f380d086d5f5df315b.png" alt="F(R)" style="vertical-align: -4px"/> is also determined experimentally, and aims to
contain information about the relative efficiency of individual detector pixels.
It is normalised to values close to 1 in order not to change the overall scaling
of the equation. The experimental flood source data are divided by detector pixel
solid angles at their measurement set up to give <img class="math" src="_images/math/b9854e5499edc05810ce08f380d086d5f5df315b.png" alt="F(R)" style="vertical-align: -4px"/>.
Detector pixel solid angles are calculated for the instrument geometry at the
time of the SANS experiment. <img class="math" src="_images/math/0d0412717b0c50e5f1fc2af31657d05c39da1589.png" alt="Cor(R,\lambda)" style="vertical-align: -4px"/> optionally takes into account
any corrections that cannot be described as only pixel dependent or only
wavelength dependent. One such example is for the angle dependence of
transmissions, <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSWideAngleCorrection-v1.html#algm-sanswideanglecorrection" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSWideAngleCorrection</em></a>. <img class="math" src="_images/math/8f3aa6ddc83ded7044f70c59380f9d21be6ef5d5.png" alt="T(\lambda)" style="vertical-align: -4px"/>
is the transmission, which measures the ratio of neutron counts after the sample,
divided by the neutron counts before the sample. <img class="math" src="_images/math/8f3aa6ddc83ded7044f70c59380f9d21be6ef5d5.png" alt="T(\lambda)" style="vertical-align: -4px"/> is calculated
from a “transmission run” and a “direct run”. There are at least three ways to
measure transmission: using a monitor that drops in after the sample position,
a monitor on the main beam stop or by attenuating the beam, removing the beam stop,
and using the main detector itself. In all cases counts on the “transmission detector”
with a sample in the beam are divided by those for an empty (or “direct”) beam.
In order to allow for different exposures or changes in moderator spectrum,
each transmission spectrum is also first normalised to an incident beam monitor spectrum.
The sample transmission and direct beam transmissions must of course be acquired
with the same beam line set up, and ideally around the same time in case of any
electronic or performance drift.</p>
<p>Also, note that a SANS experiment frequently involves measurements of the sample (<em>Sample</em>)
material of interest contained inside a can (<em>Can</em>) or dissolved in a solvent inside a
cell. Separate SANS and transmission measurements must be made for the can or for
the pure solvent in a cell. For convenience this is always referred to as the
<em>Can</em> run. (Though for say a solid sample with no can, the <em>Can</em> run may actually
be simply an empty beam run.) The full data reduction is performed separately for
<em>Sample</em> and then the <em>Can</em>, before subtracting the <em>Can</em> cross-section from the <em>Sample</em>
plus <em>Can</em> cross-section, to obtain the cross-section for the <em>Sample</em> alone.
(In practise there can be some excluded volume and other annoying effects where
hydrogenous solvents are involved.)</p>
</div>
<div class="section" id="general">
<h2><a class="toc-backref" href="#id2">General</a><a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction-and-motivation">
<h3><a class="toc-backref" href="#id3">Introduction and Motivation</a><a class="headerlink" href="#introduction-and-motivation" title="Permalink to this headline">¶</a></h3>
<p>The ISIS SANS v2 reduction back-end is a more modern and updated version of the
original ISIS SANS reduction back-end which has been in use for almost 10 years.</p>
<p>Users who sets up a SANS reduction work-flow have control over a vast number of
settings (&gt;50) in addition to settings which are extracted from the provided
workspaces and instrument specific settings. The total number of settings which
define a SANS data reduction can be close to 100.</p>
<p>The previous implementation of the SANS data reduction stored the settings
non-centrally and allowed the overall state to be mutable.
This made it extremely hard to reason about the overall state of a data
reduction and lead to unnecessary data reloads, degrading the overall
performance. Also, the direct coupling of the state to the algorithms does not allow
for extending them to other facilities.</p>
<p>The new implementation of the SANS data reduction aims to avoid these pitfalls
and focusses on robustness, maintainability and performance. The main way to
achieve this is to use a simple state object which stores the reduction-relevant
information centrally.</p>
</div>
<div class="section" id="overview">
<h3><a class="toc-backref" href="#id4">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The reduction back-end consists of three components:</p>
<ul class="simple">
<li>the <em>SANSState</em> approach to centrally store the state of the reduction</li>
<li>a set of work-flow algorithms which perform the individual reduction steps</li>
<li>algorithms which orchestrate the work-flow algorithms.</li>
</ul>
</div>
</div>
<div class="section" id="sansstate">
<h2><a class="toc-backref" href="#id5"><em>SANSState</em></a><a class="headerlink" href="#sansstate" title="Permalink to this headline">¶</a></h2>
<div class="section" id="motivation">
<h3><a class="toc-backref" href="#id6">Motivation</a><a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, the amount of parameters that can be set by the user makes
the SANS reduction one of the more complex ones in the Mantid ecosystem. Previous
implementations stored the settings non-centrally which led to many difficult-to-find
bugs and a lot of uncertainty about the current settings of the reduction as they
were changed during the reduction.</p>
<p>This has been the main bottleneck of the previous reduction framework. To overcome
this, the new implementation of the SANS data reduction uses a simple state object
which stores the reduction-relevant information centrally.
This <em>SANSState</em> approach is the corner stone of the new design.</p>
<p>The <em>SANSState</em> is:</p>
<ul>
<li><p class="first">self-validating</p>
</li>
<li><dl class="first docutils">
<dt>immutable (currently this is not enforced on the object itself, but should be added in the future.</dt>
<dd><p class="first last">The reduction code is written however such that it does not make sense to mutate the state
while a reduction is running.)</p>
</dd>
</dl>
</li>
<li><p class="first">typed</p>
</li>
<li><p class="first">serializable</p>
</li>
<li><p class="first">easy to reason about</p>
</li>
<li><p class="first">modular (sub-states for units of work)</p>
</li>
</ul>
<p>This approach allows us to identify issues with the settings before a lengthy
data reduction has been started.</p>
</div>
<div class="section" id="components">
<h3><a class="toc-backref" href="#id7">Components</a><a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h3>
<p>This section describes the essential components of the state mechanism.
These include the states themselves, the parameters in a state and
the state construction.</p>
<div class="section" id="state-base-py">
<h4><a class="toc-backref" href="#id8"><em>state_base.py</em></a><a class="headerlink" href="#state-base-py" title="Permalink to this headline">¶</a></h4>
<p>The <em>state_base.py</em> module contains the essential ingredients for defining a
state object. These are the <em>StateBase</em> class which allows for serialization
and a set of <em>TypedParameter</em>.</p>
<p>The <em>StateBase</em>&#8216;s <em>property_manager</em> property is responsible for serialization.
Due to the nature of the <em>PropertyManagerProperty</em> of algorithms it serializes
the state object to a Python dictionary and receives a Mantid <em>PropertyManager</em>
object. This asymmetry is unfortunate, but mirrors the asymmetry of the
algorithm inputs.</p>
<p>States which want to fulfill the <em>StateBase</em> contract must override the
<em>validate</em> method. This method is used to ensure internal consistency
of the <em>TypedParameters</em> on the state. It is important to have comprehensive
and tight checks here.</p>
<p>The entries on the state objects are all descriptors of type <em>TypedParameter</em> which allows
for type checking, ensuring consistency early on. It is easy to
build custom types. The current list of types are:</p>
<ul class="simple">
<li><em>StringParameter</em></li>
<li><em>BoolParameter</em></li>
<li><em>FloatParameter</em></li>
<li><em>PositiveFloatParameter</em></li>
<li><em>PositiveIntegerParameter</em></li>
<li><em>DictParameter</em></li>
<li><em>ClassTypeParameter</em></li>
<li><em>FloatWithNoneParameter</em></li>
<li><em>StringWithNoneParameter</em></li>
<li><em>PositiveFloatWithNoneParameter</em></li>
<li><em>FloatListParameter</em></li>
<li><em>StringListParameter</em></li>
<li><em>PositiveIntegerListParameter</em></li>
<li><em>ClassTypeListParameter</em></li>
</ul>
<p>Most of the  typed parameters are self-descriptive. The <em>ClassTypeParameter</em>
refers to the enum-like class definitions in <em>enum.py</em>. Note that if a parameter
is not set by the state builder, then it will return <em>None</em> when it is queried.
If it is a mandatory parameter on a state object, then this needs to be enforced
in the <em>validate</em> method of the state.</p>
</div>
<div class="section" id="individual-states">
<h4><a class="toc-backref" href="#id9">Individual states</a><a class="headerlink" href="#individual-states" title="Permalink to this headline">¶</a></h4>
<p>The overall state object is made of sub-state objects which carry all required
information for a single reduction step or other unit of work.
This ensures that all the sub-states are independent of each other carry all
required information. Note that this also means that some data is stored
redundantly, for example the binning for the wavelength conversion is stored
in the state object used for monitor normalization and in the state object
for the transmission calculation.</p>
<p>In the following sections we list the different parameters on the currently
implemented states.</p>
<div class="section" id="state-py">
<h5><a class="toc-backref" href="#id10"><em>state.py</em></a><a class="headerlink" href="#state-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>State</em> class is the overarching state which contains sub-states where each
sub-state has a different responsibility (see below).</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="61%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">State type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>data</td>
<td>info about runs to use (most important state)</td>
<td><em>StateData</em></td>
</tr>
<tr class="row-odd"><td>move</td>
<td>info about the instrument component positions</td>
<td><em>StateMove</em></td>
</tr>
<tr class="row-even"><td>reduction</td>
<td>general reduction info</td>
<td><em>StateReductionMode</em></td>
</tr>
<tr class="row-odd"><td>slice</td>
<td>info about event slicing (when applicable)</td>
<td><em>StateSliceEvent</em></td>
</tr>
<tr class="row-even"><td>mask</td>
<td>info about masking</td>
<td><em>StateMask</em></td>
</tr>
<tr class="row-odd"><td>wavelength</td>
<td>info about wavelength conversion of the scatter data</td>
<td><em>StateWavelength</em></td>
</tr>
<tr class="row-even"><td>save</td>
<td>info about the save settings</td>
<td><em>StateSave</em></td>
</tr>
<tr class="row-odd"><td>scale</td>
<td>info about the absolute scale and the sample volume</td>
<td><em>StateScale</em></td>
</tr>
<tr class="row-even"><td>adjustment</td>
<td>info about adjustment workspaces</td>
<td><em>StateAdjustment</em></td>
</tr>
<tr class="row-odd"><td>convert_to_q</td>
<td>info about momentum transfer conversion</td>
<td><em>StateConvertToQ</em></td>
</tr>
<tr class="row-even"><td>compatibility</td>
<td>used when reducing in compatibility mode</td>
<td><em>StateCompatibility</em></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="data-py">
<h5><a class="toc-backref" href="#id11"><em>data.py</em></a><a class="headerlink" href="#data-py" title="Permalink to this headline">¶</a></h5>
<p>This is the most important state. Since the reduction framework has a data-driven
approach it is not possible to build up most of the reduction without knowing what
the actual data for the reduction will be.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="33%" />
<col width="27%" />
<col width="7%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>sample_scatter</td>
<td>The sample scatter file path</td>
<td><em>StringParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>sample_scatter_period</td>
<td>The period to use for the sample scatter</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>sample_transmission</td>
<td>The sample transmission file path</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>sample_transmission_period</td>
<td>The period to use for the sample transmission</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>sample_direct</td>
<td>The sample direct file path</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>sample_direct_period</td>
<td>The period to use for the sample direct</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>can_scatter</td>
<td>The can scatter file path</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>can_scatter_period</td>
<td>The period to use for the can scatter</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>can_transmission</td>
<td>The can transmission file path</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>can_transmission_period</td>
<td>The period to use for the can transmission</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>can_direct</td>
<td>The can direct file path</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>can_direct_period</td>
<td>The period to use for the can direct</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>calibration</td>
<td>The path to the calibration file</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>sample_scatter_run_number</td>
<td>Run number of the sample scatter file</td>
<td><em>PositiveIntegerParameter</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>sample_scatter_is_multi_period</td>
<td>If the sample scatter is multi-period</td>
<td><em>BoolParameter</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>instrument</td>
<td>Enum for the SANS instrument</td>
<td><em>ClassTypeParameter(SANSInstrument)</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>idf_file_path</td>
<td>Path to the IDF file</td>
<td><em>StringParameter</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>ipf_file_path</td>
<td>Path to the IPF file</td>
<td><em>StringParameter</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
</tr>
</tbody>
</table>
<p>Note that while some parameters are optional they might become mandatory if other
optional parameters have been specified. Also note that some of the parameters
on the state are auto-generated by the builder classes.</p>
</div>
<div class="section" id="move-py">
<h5><a class="toc-backref" href="#id12"><em>move.py</em></a><a class="headerlink" href="#move-py" title="Permalink to this headline">¶</a></h5>
<p>The move state defines how instruments are moved. This is highly individual to
the different instruments. Therefore there is most likely going to be one state
per instrument, sometimes even more when there should be different behaviour for
different run numbers.</p>
<p>The fundamental class is <em>StateMove</em> which has the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="7%" />
<col width="26%" />
<col width="9%" />
<col width="15%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>x_translation_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>y_translation_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>z_translation_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>rotation_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>side_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>radius_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>x_tilt_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>y_tilt_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>z_tilt_correction</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>sample_centre_pos1</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>sample_centre_pos2</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-odd"><td>detector_name</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>StringWithNoneParameter</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>detector_name_short</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>StringWithNoneParameter</em></td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>Y</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If nothing is specified, then the detector positions and movements are assumed to be 0.
Note that each instrument contains additional parameters on their individual state classes. When adding
a new instrument, this will be most likely one of the main areas to add new code.</p>
</div>
<div class="section" id="reduction-mode-py">
<h5><a class="toc-backref" href="#id13"><em>reduction_mode.py</em></a><a class="headerlink" href="#reduction-mode-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateReductionMode</em> class contains general settings about the reduction, e.g. if we are dealing with a merged
reduction. It contains the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="27%" />
<col width="23%" />
<col width="5%" />
<col width="8%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>reduction_mode</td>
<td>The type of reduction, i.e. LAB, HAB, merged or both</td>
<td><em>ClassTypeParameter(ReductionMode)</em></td>
<td>N</td>
<td>N</td>
<td><em>ISISReductionMode.LAB</em> enum value</td>
</tr>
<tr class="row-odd"><td>reduction_dimensionality</td>
<td>If 1D or 2D reduction</td>
<td><em>ClassTypeParameter(ReductionDimensionality)</em></td>
<td>N</td>
<td>N</td>
<td><em>ReductionDimensionality.OneDim</em> enum value</td>
</tr>
<tr class="row-even"><td>merge_fit_mode</td>
<td>The fit mode for merging</td>
<td><em>ClassTypeParameter(FitModeForMerge)</em></td>
<td>Y</td>
<td>N</td>
<td><em>FitModeForMerge.NoFit</em> enum value</td>
</tr>
<tr class="row-odd"><td>merge_shift</td>
<td>The shift value for merging</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>merge_scale</td>
<td>The scale value for merging</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>1.0</td>
</tr>
<tr class="row-odd"><td>merge_range_min</td>
<td>The min q value for merging</td>
<td><em>FloatWithNoneParameter</em></td>
<td>Y</td>
<td>N</td>
<td><em>None</em></td>
</tr>
<tr class="row-even"><td>merge_range_max</td>
<td>The max q value for merging</td>
<td><em>FloatWithNoneParameter</em></td>
<td>Y</td>
<td>N</td>
<td><em>None</em></td>
</tr>
<tr class="row-odd"><td>detector_names</td>
<td>A dict from detector type to detector name</td>
<td><em>DictParameter</em></td>
<td>N</td>
<td>Y</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="slice-py">
<h5><a class="toc-backref" href="#id14"><em>slice.py</em></a><a class="headerlink" href="#slice-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateSliceEvent</em> class is only relevant when we are dealing with event-type
data and the user decides to perform an event-sliced reduction, i.e. one reduction per event slice.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="39%" />
<col width="25%" />
<col width="9%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>start_time</td>
<td>A list of start times for event slices</td>
<td><em>FloatListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>end_time</td>
<td>A list of stop times for event slices</td>
<td><em>FloatListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
</tbody>
</table>
<p>Note that the validation ensures that the number of <em>start_time</em> and <em>end_time</em>
entries is matched and that the end time is larger than the start time.</p>
</div>
<div class="section" id="mask-py">
<h5><a class="toc-backref" href="#id15"><em>mask.py</em></a><a class="headerlink" href="#mask-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateMask</em> class holds information regarding time and pixel masking.
It also contains two sub-states which contain detector-specific masking information.
The <em>StateMask</em> contains the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="45%" />
<col width="19%" />
<col width="7%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>radius_min</td>
<td>The min radius of a circular mask on the detector</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>radius_max</td>
<td>The max radius of a circular mask on the detector</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>bin_mask_general_start</td>
<td>A list of start times for general bin masks</td>
<td><em>FloatListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>bin_mask_general_stop</td>
<td>A list of stop times for general bin masks</td>
<td><em>FloatListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>mask_files</td>
<td>A list of mask files</td>
<td><em>StringListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>phi_min</td>
<td>The min angle of an angle mask</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>phi_max</td>
<td>The max angle of an angle mask</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>use_mask_phi_mirror</td>
<td>If the mirror slice should be used</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>beam_stop_arm_width</td>
<td>The width of the beam stop arm</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>beam_stop_arm_angle</td>
<td>The angle of the beam stop arm</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>beam_stop_arm_pos1</td>
<td>The x position of the beam stop arm</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>beam_stop_arm_pos2</td>
<td>The y position of the beam stop arm</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>clear</td>
<td>currently not used</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>clear_time</td>
<td>currently not used</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>detector</td>
<td>A dict of detector type to <em>StateMaskDetector</em> sub-states</td>
<td><em>DictParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>idf_path</td>
<td>The path to the IDF</td>
<td><em>StringParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
</tbody>
</table>
<p>Validation is applied to some of the entries.</p>
<p>The detector-specific settings are stored in the <em>StateMaskDetector</em> which contains the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="13%" />
<col width="33%" />
<col width="9%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>single_vertical_strip_mask</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>range_vertical_strip_start</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>range_vertical_strip_stop</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>single_horizontal_strip_mask</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>range_horizontal_strip_start</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>range_horizontal_strip_stop</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>block_horizontal_start</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>block_horizontal_stop</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>block_vertical_start</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>block_vertical_stop</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>block_cross_horizontal</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>block_cross_vertical</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>bin_mask_start</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>bin_mask_stop</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>FloatListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>detector_name</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>detector_name_short</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>single_spectra</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>spectrum_range_start</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-even"><td>spectrum_range_stop</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td><em>PositiveIntegerListParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
</tbody>
</table>
<p>Again the detector-specific settings contain multiple validation steps on the state.</p>
</div>
<div class="section" id="wavelength-py">
<h5><a class="toc-backref" href="#id16"><em>wavelength.py</em></a><a class="headerlink" href="#wavelength-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateWavelength</em> class contains the information required to perform the conversion of the scatter data
from time-of-flight to wavelength units. The parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="31%" />
<col width="30%" />
<col width="8%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>rebin_type</td>
<td>The type of rebinning</td>
<td><em>ClassTypeParameter(RebinType)</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>wavelength_low</td>
<td>The lower wavelength boundary</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-even"><td>wavelength_high</td>
<td>The upper wavelength boundary</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>wavelength_step</td>
<td>The wavelength step</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-even"><td>wavelength_step_type</td>
<td>This is either linear or logarithmic</td>
<td><em>ClassTypeParameter(RangeStepType)</em></td>
<td>N</td>
<td>N</td>
</tr>
</tbody>
</table>
<p>The validation ensures that all entries are specified and that the lower wavelength boundary is smaller than the upper wavelength boundary.</p>
</div>
<div class="section" id="save-py">
<h5><a class="toc-backref" href="#id17"><em>save.py</em></a><a class="headerlink" href="#save-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateSave</em> class does not hold information which is directly related to the reduction but contains
the required information about saving the reduced data. The relevant parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="33%" />
<col width="23%" />
<col width="6%" />
<col width="10%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>zero_free_correction</td>
<td>If zero error correction (inflation) should happen</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>True</td>
</tr>
<tr class="row-odd"><td>file_format</td>
<td>A list of file formats to save into</td>
<td><em>ClassTypeListParameter(SaveType)</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>user_specified_output_name</td>
<td>A custom user-specified name for the saved file</td>
<td><em>StringWithNoneParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>user_specified_output_name_suffix</td>
<td>A custom user-specified suffix for the saved file</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>use_reduction_mode_as_suffix</td>
<td>If the reduction mode should be used as a suffix</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scale-py">
<h5><a class="toc-backref" href="#id18"><em>scale.py</em></a><a class="headerlink" href="#scale-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateScale</em> class contains the information which is required for the absolute value scaling
and the volume information. The parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="34%" />
<col width="29%" />
<col width="8%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>shape</td>
<td>The user-specified shape of the sample</td>
<td><em>ClassTypeParameter(SampleShape)</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>thickness</td>
<td>The user-specified sample thickness</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>width</td>
<td>The user-specified sample width</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>height</td>
<td>The user-specified sample height</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>scale</td>
<td>The user-specified absolute scale</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>shape_from_file</td>
<td>The file-extracted shape of the sample</td>
<td><em>ClassTypeParameter(SampleShape)</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>thickness_from_file</td>
<td>The file-extracted sample thickness</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>width_from_file</td>
<td>The file-extracted sample width</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-even"><td>height_from_file</td>
<td>The file-extracted sample height</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adjustment-py">
<h5><a class="toc-backref" href="#id19"><em>adjustment.py</em></a><a class="headerlink" href="#adjustment-py" title="Permalink to this headline">¶</a></h5>
<p>Adjustment workspaces are generated to be consumed in the momentum transfer conversion step.
There are three types of adjustments</p>
<ul class="simple">
<li>Pure wavelength adjustments, i.e. adjustments which only affect the bins.</li>
<li>Pure pixel adjustments, i.e. adjustments which only affect the spectra</li>
<li>Pixel-and-wavelength adjustments, i.e. adjustments which affect both the bins and spectra</li>
</ul>
<p>The <em>StateAdjustment</em> class is a composite state which is made of information
relating to the different types of adjustments</p>
<p>The parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="31%" />
<col width="30%" />
<col width="6%" />
<col width="9%" />
<col width="4%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>calculate_transmission</td>
<td>Information for the transmission calculation</td>
<td><em>TypedParameter(StateCalculateTransmission)</em></td>
<td>N</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>normalize_to_monitor</td>
<td>Information for the monitor normalization</td>
<td><em>TypedParameter(StateNormalizeToMonitor)</em></td>
<td>N</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>wavelength_and_pixel_adjustment</td>
<td>Information for combining different adjustments</td>
<td><em>TypedParameter(StateWavelengthAndPixelAdjustment)</em></td>
<td>N</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>wide_angle_correction</td>
<td>If wide angle calculation should be performed.
Note that this will produce the pixel-and-wavelength
adjustment</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>False</td>
</tr>
</tbody>
</table>
<p>The transmission calculation state:</p>
<p>The transmission calculation produces one of the wavelength adjustment workspaces.
This reduction step is one of the more complicated bits of the reduction and hence has a
large variety of settings. The <em>StateCalculateTransmission</em> class contains the
following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="51%" />
<col width="16%" />
<col width="5%" />
<col width="8%" />
<col width="4%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>transmission_radius_on_detector</td>
<td>A radius around the beam centre for transmission ROI on the bank</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>transmission_roi_files</td>
<td>A list of ROI files for transmission ROI on the bank</td>
<td><em>StringListParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>transmission_mask_files</td>
<td>A list of mask files for transmission ROI on the bank</td>
<td><em>StringListParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>default_transmission_monitor</td>
<td>The default transmission monitor (if nothing else has been specified)</td>
<td><em>PositiveIntegerParameter</em></td>
<td>N</td>
<td>Y</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>transmission_monitor</td>
<td>The relevant transmission monitor (if no ROI is being used)</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>default_incident_monitor</td>
<td>The default incident monitor (if nothing else has been specified)</td>
<td><em>PositiveIntegerParameter</em></td>
<td>N</td>
<td>Y</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>incident_monitor</td>
<td>The incident monitor</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>prompt_peak_correction_min</td>
<td>The start time of a prompt peak correction</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>prompt_peak_correction_max</td>
<td>The stop time of a prompt peak correction</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>prompt_peak_correction_enabled</td>
<td>If the prompt peak correction should occur</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>True</td>
</tr>
<tr class="row-even"><td>rebin_type</td>
<td>The type of wavelength rebinning, i.e. standard or interpolating</td>
<td><em>ClassTypeParameter(RebinType)</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>wavelength_low</td>
<td>The lower wavelength boundary</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>wavelength_high</td>
<td>The upper wavelength boundary</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>wavelength_step</td>
<td>The wavelength step</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>wavelength_step_type</td>
<td>The wavelength step type, i.e. lin or log</td>
<td><em>ClassTypeParameter(RebinType)</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>use_full_wavelength_range</td>
<td>If the full wavelength range of the instrument should be used</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>wavelength_full_range_low</td>
<td>The lower wavelength boundary of the full wavelength range</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>wavelength_full_range_high</td>
<td>The upper wavelength boundary of the full wavelength range</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>background_TOF_general_start</td>
<td>General lower boundary for background correction</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>background_TOF_general_stop</td>
<td>General upper boundary for background correction</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>background_TOF_monitor_start</td>
<td>Monitor specific lower boundary for background correction (monitor vs. start value)</td>
<td><em>DictParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>background_TOF_monitor_stop</td>
<td>Monitor specific upper boundary for background correction (monitor vs. stop value)</td>
<td><em>DictParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>background_TOF_roi_start</td>
<td>Lower bound of background correction when using ROI on detector</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>background_TOF_roi_stop</td>
<td>Upper bound of background correction when using ROI on detector</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>fit</td>
<td>A dict for each data type (sample and can) to the state of fit settings (<em>StateTransmissionFit</em>)</td>
<td><em>DictParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that the transmission information can be either collected via a monitor or
via a region on the detector. In the former case <em>transmission_monitor</em> is the
relevant parameter whereas in the latter case it is <em>transmission_radius_on_detector</em>,
<em>transmission_roi_files</em> and <em>transmission_mask_files</em>. Also note that we have
instrument specific versions of these state classes, mainly to accommodate for
the different wavelength ranges (and potentially default prompt peak settings.)</p>
<p>The above mentioned <em>StateTransmissionFit</em> class contains fit information for
the transmission calculation. Note that each data type, can contain its separate
fit information. The set of parameters describing this fit are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="40%" />
<col width="20%" />
<col width="6%" />
<col width="9%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>fit_type</td>
<td>The type of fitting, i.e. lin, log or poly</td>
<td><em>ClassTypeParameter(FitType)</em></td>
<td>Y</td>
<td>N</td>
<td><em>FitType.Log</em> enum value</td>
</tr>
<tr class="row-odd"><td>polynomial_order</td>
<td>Polynomial order when poly fit type has been selected</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="row-even"><td>wavelength_low</td>
<td>Lower wavelength bound for fitting (<em>None</em> means no lower bound)</td>
<td><em>PositiveFloatWithNoneParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>wavelength_high</td>
<td>Upper wavelength bound for fitting (<em>None</em> means no upper bound)</td>
<td><em>PositiveFloatWithNoneParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that the polynomial order is set to 0 by default. This forces the user to
actively set a polynomial order if polynomial fitting has been selected.</p>
<p>The monitor normalization state:</p>
<p>The monitor normalization sets up a wavelength adjustment workspace.
This needs to always be specified. In the <em>StateNormalizeToMonitor</em> class most parameters
are very similar to the transmission calculation. The parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="40%" />
<col width="17%" />
<col width="4%" />
<col width="7%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>incident_monitor</td>
<td>The incident monitor</td>
<td><em>PositiveIntegerParameter</em></td>
<td>Y</td>
<td>N</td>
<td>default which is specified in the IPF</td>
</tr>
<tr class="row-odd"><td>prompt_peak_correction_min</td>
<td>The start time of a prompt peak correction</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>prompt_peak_correction_max</td>
<td>The stop time of a prompt peak correction</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>prompt_peak_correction_enabled</td>
<td>If the prompt peak correction should occur</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>False</td>
</tr>
<tr class="row-even"><td>rebin_type</td>
<td>The type of wavelength rebinning, i.e. standard or interpolating</td>
<td><em>ClassTypeParameter(RebinType)</em></td>
<td>Y</td>
<td>N</td>
<td><em>RebinType.Rebin</em> enum value</td>
</tr>
<tr class="row-odd"><td>wavelength_low</td>
<td>The lower wavelength boundary</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>wavelength_high</td>
<td>The upper wavelength boundary</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>wavelength_step</td>
<td>The wavelength step</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>wavelength_step_type</td>
<td>The wavelength step type, i.e. lin or log</td>
<td><em>ClassTypeParameter(RangeStepType)</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>background_TOF_general_start</td>
<td>General lower boundary for background correction</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>background_TOF_general_stop</td>
<td>General upper boundary for background correction</td>
<td><em>FloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>background_TOF_monitor_start</td>
<td>Monitor specific lower boundary for background correction (monitor vs. start value)</td>
<td><em>DictParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>background_TOF_monitor_stop</td>
<td>Monitor specific upper boundary for background correction (monitor vs. stop value)</td>
<td><em>DictParameter</em></td>
<td>Y</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Combining wavelength and pixel state:</p>
<p>This stage combines wavelength workspaces generated from the transmission and the monitor
normalization stages with workspaces loaded from files.
The <em>StateWavelengthAndPixelAdjustment</em> class contains the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="48%" />
<col width="23%" />
<col width="6%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>wavelength_low</td>
<td>The lower bound of the for the wavelength range</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>wavelength_high</td>
<td>The upper bound of the for the wavelength range</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-even"><td>wavelength_step</td>
<td>The wavelength step</td>
<td><em>PositiveFloatParameter</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>wavelength_step_type</td>
<td>The wavelength step type, i.e. lin or log</td>
<td><em>ClassTypeParameter(RangeStepType)</em></td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-even"><td>adjustment_files</td>
<td>Dict to adjustment files; detector type vs <em>StateAdjustmentFiles</em> object</td>
<td><em>DictParamter</em></td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>idf_path</td>
<td>Path to the IDF file</td>
<td><em>StringParameter</em></td>
<td>N</td>
<td>Y</td>
</tr>
</tbody>
</table>
<p>Per detector type (i.e. LAB and HAB) there can be one pixel adjustment file and
one wavelength file. The values are stored in the <em>StateAdjustmentFiles</em> class and its parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="38%" />
<col width="16%" />
<col width="8%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>pixel_adjustment_file</td>
<td>The name of the pixel adjustment file</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>wavelength_adjustment_file</td>
<td>The name of the wavelength adjustment file</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="convert-to-q-py">
<h5><a class="toc-backref" href="#id20"><em>convert_to_q.py</em></a><a class="headerlink" href="#convert-to-q-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateConvertToQ</em> class contains information about the conversion of the
scatter data from wavelength units to momentum transfer units. Essentially this
is information to operate the <em>Q1D</em> or <em>Qxy</em> algorithm.</p>
<p>The parameters are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="21%" />
<col width="21%" />
<col width="15%" />
<col width="7%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>reduction_dimensionality</td>
<td>1D or 2D</td>
<td><em>ClassTypeParameter(ReductionDimensionality)</em></td>
<td>N</td>
<td>N</td>
<td><em>ReductionDimensionality.OneDim</em> enum value</td>
</tr>
<tr class="row-odd"><td>use_gravity</td>
<td>If gravity correction should be applied</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>False</td>
</tr>
<tr class="row-even"><td>gravity_extra_length</td>
<td>Extra length for gravity correction</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>radius_cuto-off</td>
<td>Radius above which pixels are not considered</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="row-even"><td>wavelength_cuto-off</td>
<td>Wavelength above which data is not considered</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>q_min</td>
<td>Min momentum transfer value for 1D reduction</td>
<td><em>PositiveFloatParameter</em></td>
<td>N,</td>
<td>if 1D  N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>q_max</td>
<td>Max momentum transfer value for 1D reduction</td>
<td><em>PositiveFloatParameter</em></td>
<td>N,</td>
<td>if 1D  N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>q_1d_rebin_string</td>
<td>Rebin string for Q1D</td>
<td><em>StringParameter</em></td>
<td>N,</td>
<td>if 1D  N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>q_xy_max</td>
<td>Max momentum transfer value for 2D reduction</td>
<td><em>PositiveFloatParameter</em></td>
<td>N,</td>
<td>if 2D  N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>q_xy_step</td>
<td>Momentum transfer step for 2D reduction</td>
<td><em>PositiveFloatParameter</em></td>
<td>N,</td>
<td>if 2D  N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>q_xy_step_type</td>
<td>The step type, i.e. lin or log</td>
<td><em>ClassTypeParameter(RangeStepType)</em></td>
<td>N,</td>
<td>if 2D  N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>use_q_resolution</td>
<td>If should perform a q resolution calculation</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>False</td>
</tr>
<tr class="row-even"><td>q_resolution_collimation_length</td>
<td>Collimation length</td>
<td><em>PositiveFloatParameter</em></td>
<td>N, if performing q resolution</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>q_resolution_delta_r</td>
<td>Virtual ring width on the detector</td>
<td><em>PositiveFloatParameter</em></td>
<td>N, if performing q resolution</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>moderator_file</td>
<td>A file with moderator spread values</td>
<td><em>StringParameter</em></td>
<td>N, if performing q resolution</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>q_resolution_a1</td>
<td>The diameter of circular source aperture</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y (see below)</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>q_resolution_a2</td>
<td>The diameter of circular sample aperture</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y (see below)</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>q_resolution_h1</td>
<td>The height of rectangular source aperture</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y (see below)</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>q_resolution_h2</td>
<td>The height of rectangular sample aperture</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y (see below)</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>q_resolution_w1</td>
<td>The width of rectangular source aperture</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y (see below)</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td>q_resolution_w2</td>
<td>The width of rectangular sample aperture</td>
<td><em>PositiveFloatParameter</em></td>
<td>Y (see below)</td>
<td>N</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note that if <em>use_q_resolution</em> is enabled, then either the aperture information
for the circular or the rectangular case needs to be specified.</p>
</div>
<div class="section" id="compatibility-py">
<h5><a class="toc-backref" href="#id21"><em>compatibility.py</em></a><a class="headerlink" href="#compatibility-py" title="Permalink to this headline">¶</a></h5>
<p>The <em>StateCompatibility</em> class is not directly part of the reduction, but it will
convert event-mode workspaces early on to histogram-mode workspaces in order to
emulate the old reduction work-flow. This allows for a direct comparison between
results of the new and old reduction framework. The name <em>compatibility</em> has
been chosen in order to indicate that we are testing for compatibility with the
results of the old reduction framework.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="42%" />
<col width="13%" />
<col width="7%" />
<col width="11%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Comment</th>
<th class="head">Type</th>
<th class="head">Optional?</th>
<th class="head">Auto-generated?</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>use_compatibility_mode</td>
<td>If to perform a compatibility conversion</td>
<td><em>BoolParameter</em></td>
<td>Y</td>
<td>N</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>time_rebin_string</td>
<td>How to rebin the data when converting to histogram mode</td>
<td><em>StringParameter</em></td>
<td>Y</td>
<td>N</td>
<td>empty string</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="state-generation">
<h3><a class="toc-backref" href="#id22">State Generation</a><a class="headerlink" href="#state-generation" title="Permalink to this headline">¶</a></h3>
<p>User input can come in the form of user files, the Python interface or the GUI. In
some of these cases the order in which the parameters are set is not always in the
same order and sometimes a parameter can be set multiple times (e.g. via the user file).
These settings are captured in an input dictionary and then processed
by builder classes which are coordinated by a state director. These components are
described below.</p>
<div class="section" id="user-input-dictionary">
<h4><a class="toc-backref" href="#id23">User input dictionary</a><a class="headerlink" href="#user-input-dictionary" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, we cannot make any assumptions about the order or multiplicity of the
user commands. We use a simple Python dictionary to store the specified settings.
In fact, the dictionary maps from enum-like classes, defined in <em>settings_tags.py</em> to
a list of settings. The settings can be simple values, lists, dictionaries or <em>named_tuples</em> defined
in <em>settings_tags.py</em>.</p>
<p>Note that the naming of a large chunk of the the enum-like classes in <em>settings_tags.py</em>
was driven by the corresponding name in the user file definition. We can consider
changing the naming in the future. Also note that some settings only allow one value,
which means that the director which uses these settings will use the last value in the list.</p>
<p>The user input dictionary is normally populated by the settings specified in the user file and
parsed by <em>UserFileParser</em> in <em>user_file_parser.py</em>. In addition the dictionary can
be modified by using the <em>ISISCommandInterface</em> or the SANS GUI. Changes to the original
settings will override settings specified in the user file.</p>
<p>An example dictionary entry for the fit parameters during the transmission
calculation for a <em>Can</em> data set could be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="n">FitId</span><span class="o">.</span><span class="n">general</span><span class="p">:</span> <span class="n">fit_general</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                            <span class="n">stop</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                            <span class="n">fit_type</span><span class="o">=</span><span class="n">FitType</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">,</span>
                            <span class="n">data_type</span><span class="o">=</span><span class="n">DataType</span><span class="o">.</span><span class="n">Can</span><span class="p">,</span>
                            <span class="n">polynomial_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This entry is added to the general user input dictionary. Note that for some of the
input values, enums from <em>enums.py</em> are used, e.g. <em>FitType.Polynomial</em>. This approach is
used throughout the reduction-back-end.</p>
</div>
<div class="section" id="builders">
<h4><a class="toc-backref" href="#id24">Builders</a><a class="headerlink" href="#builders" title="Permalink to this headline">¶</a></h4>
<p>The state object is constructed via the builder pattern. Each state has its own builder
which will construct the correct state or sub-state based on the input parameter. Note that
the selection of the state in these builders is often driven by the information
contained in an object of type <em>StateData</em>. The data determines which algorithm strategy and
hence which sub-state to choose. This data-driven approach was chosen deliberately, since
the data automatically defines the values of a large set of reduction parameters, e.g. the
instrument name or the path to the IDF file. Note that the coordination of the
builders for the different states is performed by a state director.</p>
<p>Let&#8217;s have a look at an example of a typical builder. We examine the builder for scaling.
The relevant builder is chosen via the factory method <em>def get_scale_builder(data_info)</em>
where <em>data_info</em> is an object of type <em>StateData</em>. The resulting <em>StateScaleBuilder</em> allows
for setting the parameters on the state object which is currently being built. Via the
<em>automatic_setters</em> decorator it provides setter methods which forward to the state which is currently built.
The name of the the setters is <em>set_PARAMTERNAME</em> for a given parameter name on the state.
The advantage of the decorator is that we can exclude access to parameters of the state which
are automatically set by the builder.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StateScaleBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@automatic_setters</span><span class="p">(</span><span class="n">StateScale</span><span class="p">,</span> <span class="n">exclusions</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_info</span><span class="p">):</span>
      <span class="o">...</span>
</pre></div>
</div>
<p>In the <em>exclusions</em> input we can specify parameters which should not receive a setter.
Note the the first input of the decorator is the state class which is being constructed by
the builder.</p>
<div class="section" id="selection-of-the-builders">
<h5><a class="toc-backref" href="#id25">Selection of the builders</a><a class="headerlink" href="#selection-of-the-builders" title="Permalink to this headline">¶</a></h5>
<p>As stated above the builders are made available via factory methods. Currently, most
of the factory methods just check if we are dealing with an ISIS instrument and provide
the appropriate builder. Unknown instruments will raise an <em>NotImplementedError</em>. When
extending the framework to other instruments this is something that needs to be explicitly
enabled for all states. This was done deliberately in order to ensure that the reduction state
matches the new instrument.</p>
</div>
</div>
<div class="section" id="directors">
<h4><a class="toc-backref" href="#id26">Directors</a><a class="headerlink" href="#directors" title="Permalink to this headline">¶</a></h4>
<p>As explained above each state has its own builder which in turn is selected via a factory method.
To coordinate the builders and feed them the information that has been made available for example
via the user file, the GUI or the CLI, we need an entity which coordinates the builders and the access
to the relevant information. This task is managed by state directors.</p>
<div class="section" id="state-director-py">
<h5><a class="toc-backref" href="#id27"><em>state_director.py</em></a><a class="headerlink" href="#state-director-py" title="Permalink to this headline">¶</a></h5>
<p>The main director which handles the coordination of the builders and the only one which
is actually aware of them is <em>StateDirectorISIS</em>. The director manages the user input
dictionary which was discussed earlier. It is also possible to provide a user file as input or
a user input dictionary.</p>
<p>This director is used by other directors which are responsible for creating the user input
dictionary for the CLI and GUI case. These directors don&#8217;t know anything about the builders or
the state, but are only responsible for providing the user input. An exception to this
is the <em>StateData</em> object, since it is used indirectly to choose the correct builders
for the other sub-states. Hence the role of the outer level directors is to provide the
<em>StateDirectorISIS</em> object with general user input information and information about the data.</p>
</div>
<div class="section" id="user-file-input">
<h5><a class="toc-backref" href="#id28">User file input</a><a class="headerlink" href="#user-file-input" title="Permalink to this headline">¶</a></h5>
<p>The user file is an import aspect of setting up a reduction for a SANS work-flow. Conventionally,
most of the settings are defined in the user file and only few settings are adjusted/provided
via the CLI or the GUI.</p>
<p>The information in the user file is converted to the user input dictionary.
This is currently achieved with a <em>UserFileParser</em> object. Future user files will
potentially make use of a custom <em>yaml</em>-style format. This will require a new
parser which will easily replace the current parser since only a single
interface method (<em>parse_line</em> which takes a single line to parse)
needs to be provided.</p>
<p>For an overview of the user file commands, please see the
<a class="reference external" href="https://www.mantidproject.org/SANS_User_File_Commands">user file documentation</a> .</p>
</div>
<div class="section" id="director-for-isiscommandinterface-cli">
<h5><a class="toc-backref" href="#id29">Director for <em>ISISCommandInterface</em> (CLI)</a><a class="headerlink" href="#director-for-isiscommandinterface-cli" title="Permalink to this headline">¶</a></h5>
<p>The <em>ISISCommandInterface</em> is used by some of the power users among the instrument scientists. It is
an efficient way to customize reductions which require small tweaks between different reductions.
Please consult the <a class="reference external" href="https://www.mantidproject.org/Scripting_SANS_Reductions">scripting documentation</a>
for the <em>ISISCommandInterface</em> for more information.</p>
<p>The principal component which sets up the state behind the scene is <em>CommandInterfaceStateDirector</em>. It has to deal
with the complication that we are only able to set up the reduction state after all information has been provided, hence
it collects all the inputs and stores this information between CLI calls. Once processing has been requested, it
pre-processes some of this input and passes the information via a user input dictionary to the standard state director.</p>
</div>
<div class="section" id="usage-via-gui">
<h5><a class="toc-backref" href="#id30">Usage via GUI</a><a class="headerlink" href="#usage-via-gui" title="Permalink to this headline">¶</a></h5>
<p>The GUI stores the user input dictionary in the <em>StateGuiModel</em> class
in <em>state_gui_model.py</em> which is then consumed by the <em>GuiStateDirector</em> in
<em>gui_state_directory.py</em>. The state model contains most of the information required
for the state generation. Some further settings, especially regarding the data
which is to be reduced, is stored in the <em>TableModel</em> in <em>table_model.py</em>.</p>
</div>
</div>
<div class="section" id="other-useful-information">
<h4><a class="toc-backref" href="#id31">Other useful information</a><a class="headerlink" href="#other-useful-information" title="Permalink to this headline">¶</a></h4>
<div class="section" id="enum-py">
<h5><a class="toc-backref" href="#id32"><em>enum.py</em></a><a class="headerlink" href="#enum-py" title="Permalink to this headline">¶</a></h5>
<p>This module contains many enum-like classes. Since we cannot make use of the <em>enum</em>
features of Python 3 and don&#8217;t want to work with string comparisons, we roll out
our own enums. Two things are noteworthy here:</p>
<ul class="simple">
<li>Using the <em>string_convertible</em> decorator allows the enum classes to be
string-convertible which is useful when they are being used in state objects
which themselves need to be serializable.</li>
<li>The <em>serializable_enum</em> decorator allows to correctly register the enum values.
Note that this decorator alters the <em>__module__</em> of the nested classes.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="work-flow-algorithms-for-individual-reduction-steps">
<h2><a class="toc-backref" href="#id33">Work-flow algorithms for individual reduction steps</a><a class="headerlink" href="#work-flow-algorithms-for-individual-reduction-steps" title="Permalink to this headline">¶</a></h2>
<p>Here we intend to discuss the functionality of the individual work-flow algorithms
which make up the SANS reduction. The algorithms can be found in <em>Framework/PythonInterface/plugins/WorkflowAlgorithms/SANS</em>.
Some of the implementation is placed into <em>scripts/SANS/sans/algorithm_detail</em> in order
avoid large scripts sizes.</p>
<p>The dedicated work-flow algorithms for the SANS reduction are:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCalculateTransmission-v1.html#algm-sanscalculatetransmission" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCalculateTransmission</em></a></li>
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToQ-v1.html#algm-sansconverttoq" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToQ</em></a></li>
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelength-v1.html#algm-sansconverttowavelength" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelength</em></a></li>
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a></li>
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCreateWavelengthAndPixelAdjustment-v1.html#algm-sanscreatewavelengthandpixeladjustment" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCreateWavelengthAndPixelAdjustment</em></a></li>
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCrop-v1.html#algm-sanscrop" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCrop</em></a></li>
<li><a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSLoad-v1.html#algm-sansload" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSLoad</em></a></li>
<li><em>SANSMaskWorkspace</em></li>
<li><em>SANSMove</em></li>
<li><em>SANSNormalizeToMonitor</em></li>
<li><em>SANSSave</em></li>
<li><em>SANSScale</em></li>
<li><em>SANSSliceEvent</em></li>
</ul>
<p>Note that the vast majority of the these algorithms takes a <em>SANSState</em> object as
an input.</p>
<p>The individual algorithms are superficially discussed below.</p>
<p>There are two further algorithms which coordinate these algorithms, they are <em>SANSReductionCore</em> and
<em>SANSSingleReduction</em> which are discussed further down.</p>
<div class="section" id="sanscalculatetransmission">
<h3><a class="toc-backref" href="#id34"><em>SANSCalculateTransmission</em></a><a class="headerlink" href="#sanscalculatetransmission" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCalculateTransmission-v1.html#algm-sanscalculatetransmission" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCalculateTransmission</em></a> algorithm is one of the more complex algorithms
in the reduction chain with many sub-steps and a wide variety of parameters which
can be set by the users.</p>
<p>The algorithm performs the following steps:</p>
<ol class="arabic simple">
<li>Select the incident monitor. If this is not explicitly set then the default value is taken.</li>
<li>Select the transmission detector ids. The detector ids are chosen via the following preference:<ol class="loweralpha">
<li>If available, get detector ids from region-of-interest selection on detector</li>
<li>Else if available get detector ids from transmission monitor setting</li>
<li>Else get default transmission monitor</li>
</ol>
</li>
<li>Get the corrected transmission workspace. The sub-steps are:<ol class="loweralpha">
<li>Load the transmission workspace</li>
<li>Extract the transmission detector ids with <a class="reference external" href="http://docs.mantidproject.org/algorithms/ExtractSpectra-v1.html#algm-extractspectra" title="(in MantidProject v3.12)"><em class="xref std std-ref">ExtractSpectra</em></a></li>
<li>Perform prompt peak correction</li>
<li>Perform flat background correction to monitors (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateFlatBackground-v1.html#algm-calculateflatbackground" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateFlatBackground</em></a></li>
<li>Perform flat background correction to other detectors (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateFlatBackground-v1.html#algm-calculateflatbackground" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateFlatBackground</em></a></li>
<li>Convert to wavelength and rebin using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a></li>
</ol>
</li>
<li>Get the corrected direct workspace. The sub-steps are:<ol class="loweralpha">
<li>Load the direct workspace</li>
<li>Extract the transmission detector ids with <a class="reference external" href="http://docs.mantidproject.org/algorithms/ExtractSpectra-v1.html#algm-extractspectra" title="(in MantidProject v3.12)"><em class="xref std std-ref">ExtractSpectra</em></a></li>
<li>Perform prompt peak correction (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/RemoveBins-v1.html#algm-removebins" title="(in MantidProject v3.12)"><em class="xref std std-ref">RemoveBins</em></a></li>
<li>Perform flat background correction to monitors (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateFlatBackground-v1.html#algm-calculateflatbackground" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateFlatBackground</em></a></li>
<li>Perform flat background correction to other detectors (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateFlatBackground-v1.html#algm-calculateflatbackground" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateFlatBackground</em></a></li>
<li>Convert to wavelength and rebin using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a></li>
</ol>
</li>
<li>Perform fitting for the transmission calculation. The sub-steps are:<ol class="loweralpha">
<li>Use incident monitor, wavelength settings, transmission detector ids, fit
settings as well as the corrected transmission (step 3) and direct (step4)
workspaces to initialize <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateTransmission-v1.html#algm-calculatetransmission" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateTransmission</em></a></li>
<li>Execute <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateTransmission-v1.html#algm-calculatetransmission" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateTransmission</em></a></li>
<li>Get the fitted and unfitted output workspaces</li>
</ol>
</li>
<li>Set the fitted and unfitted workspaces on the output of the algorithm.</li>
</ol>
</div>
<div class="section" id="sansconverttoq">
<h3><a class="toc-backref" href="#id35"><em>SANSConvertToQ</em></a><a class="headerlink" href="#sansconverttoq" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToQ-v1.html#algm-sansconverttoq" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToQ</em></a> algorithm is the most essential algorithm in the reduction chain.
It coordinates the final conversion from wavelength units to momentum transfer units.</p>
<p>If a 1D reduction has been selected then the algorithm will perform the follow sub-steps:</p>
<ol class="arabic simple">
<li>Calculate the momentum transfer resolution workspace using <a class="reference external" href="http://docs.mantidproject.org/algorithms/TOFSANSResolutionByPixel-v1.html#algm-tofsansresolutionbypixel" title="(in MantidProject v3.12)"><em class="xref std std-ref">TOFSANSResolutionByPixel</em></a> (if applicable)</li>
<li>Set data workspace, adjustment workspaces, momentum transfer resolution workspace
(if applicable), radius and wavelength cut-offs, momentum transfer limits
and the gravity correction on <a class="reference external" href="http://docs.mantidproject.org/algorithms/Q1D-v2.html#algm-q1d" title="(in MantidProject v3.12)"><em class="xref std std-ref">Q1D</em></a></li>
<li>Execute <a class="reference external" href="http://docs.mantidproject.org/algorithms/Q1D-v2.html#algm-q1d" title="(in MantidProject v3.12)"><em class="xref std std-ref">Q1D</em></a></li>
<li>Get reduced workspace, the sum-of-counts workspace and the sum-of-norm workspaces
and set on the output of the algorithm</li>
</ol>
<p>If a 2D reduction has been selected then the algorithm will perform the following sub-steps:</p>
<ol class="arabic simple">
<li>Set data workspace, adjustment workspaces, momentum transfer resolution workspace
(if applicable), radius and wavelength cut-offs, momentum transfer limits
and the gravity correction on <a class="reference external" href="http://docs.mantidproject.org/algorithms/Qxy-v1.html#algm-qxy" title="(in MantidProject v3.12)"><em class="xref std std-ref">Qxy</em></a></li>
<li>Execute <a class="reference external" href="http://docs.mantidproject.org/algorithms/Qxy-v1.html#algm-qxy" title="(in MantidProject v3.12)"><em class="xref std std-ref">Qxy</em></a></li>
<li>Get reduced workspace, the sum-of-counts workspace and the sum-of-norm workspaces
and set on the output of the algorithm</li>
</ol>
</div>
<div class="section" id="sansconverttowavelength">
<h3><a class="toc-backref" href="#id36"><em>SANSConvertToWavelength</em></a><a class="headerlink" href="#sansconverttowavelength" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelength-v1.html#algm-sansconverttowavelength" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelength</em></a> algorithm acts as a wrapper around
<a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a>.
Unlike <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a>
it takes a <em>SANSState</em> object as its input. This algorithm is used for the
wavelength conversion of the scatter workspace.</p>
</div>
<div class="section" id="sansconverttowavelengthandrebin">
<h3><a class="toc-backref" href="#id37"><em>SANSConvertToWavelengthAndRebin</em></a><a class="headerlink" href="#sansconverttowavelengthandrebin" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a>
algorithm is one of the few which does not take a <em>SANSState</em> object as an input.</p>
<p>The algorithm performs the following steps:</p>
<ol class="arabic simple">
<li>Unit conversion from time-of-flight units to wavelength units using <a class="reference external" href="http://docs.mantidproject.org/algorithms/ConvertUnits-v1.html#algm-convertunits" title="(in MantidProject v3.12)"><em class="xref std std-ref">ConvertUnits</em></a></li>
<li>Performs a rebin operation using either <a class="reference external" href="http://docs.mantidproject.org/algorithms/Rebin-v1.html#algm-rebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">Rebin</em></a> or <a class="reference external" href="http://docs.mantidproject.org/algorithms/InterpolatingRebin-v1.html#algm-interpolatingrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">InterpolatingRebin</em></a></li>
</ol>
</div>
<div class="section" id="sanscreatewavelengthandpixeladjustment">
<h3><a class="toc-backref" href="#id38"><em>SANSCreateWavelengthAndPixelAdjustment</em></a><a class="headerlink" href="#sanscreatewavelengthandpixeladjustment" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCreateWavelengthAndPixelAdjustment-v1.html#algm-sanscreatewavelengthandpixeladjustment" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCreateWavelengthAndPixelAdjustment</em></a>
algorithm combines the output of the <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCalculateTransmission-v1.html#algm-sanscalculatetransmission" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCalculateTransmission</em></a>
algorithm, the output of the <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSNormalizeToMonitor-v1.html#algm-sansnormalizetomonitor" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSNormalizeToMonitor</em></a> algorithm
and flood and direct files to produce the correction workspaces which are required
for <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToQ-v1.html#algm-sansconverttoq" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToQ</em></a>.</p>
<p>The sub-steps of the algorithm are:</p>
<ol class="arabic simple">
<li>Create the wavelength-adjustment workspace. The sub-steps are:<ol class="loweralpha">
<li>Get the calculate-transmission workspace from the input</li>
<li>Get the normalization-to-monitor workspace from the input</li>
<li>Load the wavelength-adjustment file using <a class="reference external" href="http://docs.mantidproject.org/algorithms/LoadRKH-v1.html#algm-loadrkh" title="(in MantidProject v3.12)"><em class="xref std std-ref">LoadRKH</em></a></li>
<li>Provide all of the above workspaces with the same binning using <a class="reference external" href="http://docs.mantidproject.org/algorithms/Rebin-v1.html#algm-rebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">Rebin</em></a>
and multiply them using <a class="reference external" href="http://docs.mantidproject.org/algorithms/Multiply-v1.html#algm-multiply" title="(in MantidProject v3.12)"><em class="xref std std-ref">Multiply</em></a></li>
</ol>
</li>
<li>Create the pixel-adjustment workspace. The sub-states are:<ol class="loweralpha">
<li>Load the pixel-adjustment file using <a class="reference external" href="http://docs.mantidproject.org/algorithms/LoadRKH-v1.html#algm-loadrkh" title="(in MantidProject v3.12)"><em class="xref std std-ref">LoadRKH</em></a></li>
<li>Crop the pixel-adjustment workspace to the desired detector using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCrop-v1.html#algm-sanscrop" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCrop</em></a></li>
</ol>
</li>
<li>Set the pixel-adjustment and wavelength-adjustment workspaces on the output of the algorithm</li>
</ol>
</div>
<div class="section" id="sanscrop">
<h3><a class="toc-backref" href="#id39"><em>SANSCrop</em></a><a class="headerlink" href="#sanscrop" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCrop-v1.html#algm-sanscrop" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCrop</em></a> algorithm crops the input workspace to a specified component using
<a class="reference external" href="http://docs.mantidproject.org/algorithms/CropToComponent-v1.html#algm-croptocomponent" title="(in MantidProject v3.12)"><em class="xref std std-ref">CropToComponent</em></a>.</p>
</div>
<div class="section" id="sansload">
<h3><a class="toc-backref" href="#id40"><em>SANSLoad</em></a><a class="headerlink" href="#sansload" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSLoad-v1.html#algm-sansload" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSLoad</em></a> algorithm is responsible for loading data and applying the calibration
where required. This algorithm loads SANS data sets. The loading can handle nexus
and raw files which can be plain or multi-period data. In addition the algorithm
has to be able to handle added files. The SANS data sets which can be loaded
with this algorithm are:</p>
<ul class="simple">
<li>sample scatter data which is the actual data under investigation. The algorithm
loads the corresponding monitor workspace separately</li>
<li>sample transmission data</li>
<li>sample direct data</li>
<li>can scatter data. The algorithm also loads the corresponding monitor workspace separately</li>
<li>can transmission data</li>
<li>can direct data</li>
</ul>
<p>In addition a calibration file which is applied after the data has been loaded
can be specified. The calibration performs micro-adjustments to the detectors.</p>
<p>The algorithm sub-steps are:</p>
<ol class="arabic simple">
<li>Based on the input data a loading strategy is selected.</li>
<li>For each workspace in the <em>StateData</em> state object we load the data (with the loading strategy from step 1). The sub-states are:<ol class="loweralpha">
<li>If optimizations are enabled check if the desired workspace already exists
on the ADS. If so, fetch it and return it. We are done with loading this data set.</li>
<li>Else get the correct loader strategy (e.g. for event-mode files) and load
the data. This will load either all periods or just the specified period
where applicable. If scatter data is loaded, then the monitor data is loaded
into a separate workspace with the suffix &#8220;_monitors&#8221;.</li>
</ol>
</li>
<li>Apply calibration if required. Note that the algorithm loads the calibration
workspace from the ADS if it exists there when optimizations are enabled. Else
it loads it from file and places it on the ADS.</li>
<li>Set the loaded workspaces on the output of the algorithm.</li>
<li>For LOQ apply transmission corrections if applicable. This will apply a different
instrument definition for transmission runs.</li>
</ol>
</div>
<div class="section" id="sansmaskworkspace">
<h3><a class="toc-backref" href="#id41"><em>SANSMaskWorkspace</em></a><a class="headerlink" href="#sansmaskworkspace" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSMaskWorkspace-v1.html#algm-sansmaskworkspace" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSMaskWorkspace</em></a> algorithm is responsible
for masking detectors and time bins on the scatter workspaces. There are several
types of masking which are currently supported:</p>
<ul class="simple">
<li>Time/Bin masking.</li>
<li>Radius masking.</li>
<li>Mask files.</li>
<li>Spectrum masking which includes individual spectra, spectra ranges, spectra
blocks and spectra cross blocks. These masks are partially specified on a detector level (see below).</li>
<li>Angle masking.</li>
<li>Beam stop masking.</li>
</ul>
<p>Note that only those of the following steps are executed where the user has specified
a particular masking instruction. The algorithm sub-steps are:</p>
<ol class="arabic simple">
<li>Select the correct masking strategy (currently only ISIS)</li>
<li>Apply time bin masking. The sub-steps are:<ol class="loweralpha">
<li>Apply general time bin masks using <a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskBins-v1.html#algm-maskbins" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskBins</em></a></li>
<li>Apply detector specific time bin masks using <a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskBins-v1.html#algm-maskbins" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskBins</em></a></li>
</ol>
</li>
<li>Apply cylinder masking. This generates a hollow cylinder which masks the
beam stop (defined by an inner radius) and anything outside of an area of
interest (defined by an outer radius). The sub-steps are:<ol class="loweralpha">
<li>Set up the inner and the outer radius of the cylinder mask.</li>
<li>Mask everything outside of the hollow cylinder using <a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskDetectorsInShape-v1.html#algm-maskdetectorsinshape" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskDetectorsInShape</em></a></li>
</ol>
</li>
<li>Apply a list of mask files. For each mask file the sub-steps are:<ol class="loweralpha">
<li>Load the mask file into a workspace using <a class="reference external" href="http://docs.mantidproject.org/algorithms/LoadMask-v1.html#algm-loadmask" title="(in MantidProject v3.12)"><em class="xref std std-ref">LoadMask</em></a></li>
<li>Apply the mask workspace to the scatter workspace using <a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskDetectors-v1.html#algm-maskdetectors" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskDetectors</em></a></li>
</ol>
</li>
<li>Apply spectrum masks. The sub-steps are:<ol class="loweralpha">
<li>Get the spectra masks for single spectra, spectrum ranges,
single horizontal spectrum strips, single vertical spectrum strips,
horizontal spectrum range (several strips next to each other),
vertical spectrum range (several strips next to each other),
block masks and block cross masks</li>
<li>Mask the selected spectra using <a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskDetectors-v1.html#algm-maskdetectors" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskDetectors</em></a></li>
</ol>
</li>
<li>Apply angle masking. This is used for pizza-slice masking and uses
<a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskDetectorsInShape-v1.html#algm-maskdetectorsinshape" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskDetectorsInShape</em></a></li>
<li>Apply beam stop masking. The beam stop consists of a disc where the beam is located
and a connection arm (rod) which holds the disc. The disc has at this point
already been masked by a cylinder mask. This step masks the connection arm using
<a class="reference external" href="http://docs.mantidproject.org/algorithms/MaskDetectorsInShape-v1.html#algm-maskdetectorsinshape" title="(in MantidProject v3.12)"><em class="xref std std-ref">MaskDetectorsInShape</em></a></li>
</ol>
</div>
<div class="section" id="sansmove">
<h3><a class="toc-backref" href="#id42"><em>SANSMove</em></a><a class="headerlink" href="#sansmove" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSMove-v1.html#algm-sansmove" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSMove</em></a> algorithm moves the instrument component
of the SANS workspace according to the settings in
the state object. Additionally the user can specify the beam centre.
Note that if the beam centre is also specified in the state object, then the
manual selection takes precedence. The way we perform a move is highly-instrument
and in fact data-dependent. Currently the move mechanism is implemented for
<strong>SANS2D</strong>, <strong>LOQ</strong>, <strong>LARMOR</strong> and <strong>ZOOM</strong>.</p>
<p>The main purpose is to shift a freshly loaded data set into its default position.
Note that each instrument has its own way of displacing the instrument. In general
this is achieved by a combination of translations and rotations using
<a class="reference external" href="http://docs.mantidproject.org/algorithms/MoveInstrumentComponent-v1.html#algm-moveinstrumentcomponent" title="(in MantidProject v3.12)"><em class="xref std std-ref">MoveInstrumentComponent</em></a> and
<a class="reference external" href="http://docs.mantidproject.org/algorithms/RotateInstrumentComponent-v1.html#algm-rotateinstrumentcomponent" title="(in MantidProject v3.12)"><em class="xref std std-ref">RotateInstrumentComponent</em></a>.</p>
</div>
<div class="section" id="sansnormalizetomonitor">
<h3><a class="toc-backref" href="#id43"><em>SANSNormalizeToMonitor</em></a><a class="headerlink" href="#sansnormalizetomonitor" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSNormalizeToMonitor-v1.html#algm-sansnormalizetomonitor" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSNormalizeToMonitor</em></a> algorithm
provides a monitor normalization workspace for subsequent wavelength correction
in <a class="reference external" href="http://docs.mantidproject.org/algorithms/Q1D-v2.html#algm-q1d" title="(in MantidProject v3.12)"><em>Q1D v2</em></a> or <a class="reference external" href="http://docs.mantidproject.org/algorithms/Qxy-v1.html#algm-qxy" title="(in MantidProject v3.12)"><em>Qxy v1</em></a>. The settings of the algorithm are
provided by the state object. The user can provide a <em>ScaleFactor</em> which is
normally obtained during event slicing.</p>
<p>The sub-steps of this algorithm are:</p>
<ol class="arabic simple">
<li>Get the incident monitor spectrum number and the scale factor</li>
<li>Extract the monitor spectrum using <a class="reference external" href="http://docs.mantidproject.org/algorithms/ExtractSingleSpectrum-v1.html#algm-extractsinglespectrum" title="(in MantidProject v3.12)"><em class="xref std std-ref">ExtractSingleSpectrum</em></a> into a monitor workspace</li>
<li>Apply the scale factor to the monitor workspace using <a class="reference external" href="http://docs.mantidproject.org/algorithms/Scale-v1.html#algm-scale" title="(in MantidProject v3.12)"><em class="xref std std-ref">Scale</em></a></li>
<li>Perform a prompt peak correction (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/RemoveBins-v1.html#algm-removebins" title="(in MantidProject v3.12)"><em class="xref std std-ref">RemoveBins</em></a></li>
<li>Perform a flat background correction (if applicable) using <a class="reference external" href="http://docs.mantidproject.org/algorithms/CalculateFlatBackground-v1.html#algm-calculateflatbackground" title="(in MantidProject v3.12)"><em class="xref std std-ref">CalculateFlatBackground</em></a></li>
<li>Convert to wavelength units and rebin using
<a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelengthAndRebin-v1.html#algm-sansconverttowavelengthandrebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelengthAndRebin</em></a></li>
</ol>
</div>
<div class="section" id="sanssave">
<h3><a class="toc-backref" href="#id44"><em>SANSSave</em></a><a class="headerlink" href="#sanssave" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSSave-v1.html#algm-sanssave" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSSave</em></a>  algorithm performs two steps:</p>
<ol class="arabic simple">
<li>Create a cloned workspace where the zero-error values are inflated (if this is requested)</li>
<li>Save the workspace into each specified file format.</li>
</ol>
<p>Zero-error inflation is useful for data points where the error is 0. When performing
any form of regression of this the zero-valued error will fix the model at this point.
If we inflate the error at this point then it does not contribute to the regression.</p>
</div>
<div class="section" id="sansscale">
<h3><a class="toc-backref" href="#id45"><em>SANSScale</em></a><a class="headerlink" href="#sansscale" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSScale-v1.html#algm-sansscale" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSScale</em></a> algorithm scales a SANS workspace according to the settings
in the state object. The scaling includes division by the volume of the sample and
multiplication by an absolute scale.</p>
<p>The sub-steps of this algorithm are:</p>
<ol class="arabic simple">
<li>Multiply by the absolute scale. The sub-steps are:<ol class="loweralpha">
<li>If a scale is specified, multiply the scale by 100, else set the scale to 100</li>
<li>If the instrument is LOQ divide by <img class="math" src="_images/math/2dfc7c4dd47aff2a8de066912cb776bf02f08437.png" alt="\pi" style="vertical-align: 0px"/></li>
<li>Multiply the scatter workspace by the scale using <a class="reference external" href="http://docs.mantidproject.org/algorithms/Multiply-v1.html#algm-multiply" title="(in MantidProject v3.12)"><em class="xref std std-ref">Multiply</em></a> (and <a class="reference external" href="http://docs.mantidproject.org/algorithms/CreateSingleValuedWorkspace-v1.html#algm-createsinglevaluedworkspace" title="(in MantidProject v3.12)"><em class="xref std std-ref">CreateSingleValuedWorkspace</em></a>)</li>
</ol>
</li>
<li>Divide by the sample volume. The sub-steps are:<ol class="loweralpha">
<li>Calculate the sample volume based either on the user settings or the sample information from the file.</li>
<li>Divide by the scatter workspace by the sample volume using <a class="reference external" href="http://docs.mantidproject.org/algorithms/Divide-v1.html#algm-divide" title="(in MantidProject v3.12)"><em class="xref std std-ref">Divide</em></a> (and <a class="reference external" href="http://docs.mantidproject.org/algorithms/CreateSingleValuedWorkspace-v1.html#algm-createsinglevaluedworkspace" title="(in MantidProject v3.12)"><em class="xref std std-ref">CreateSingleValuedWorkspace</em></a>)</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="sanssliceevent">
<h3><a class="toc-backref" href="#id46"><em>SANSSliceEvent</em></a><a class="headerlink" href="#sanssliceevent" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSSliceEvent-v1.html#algm-sanssliceevent" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSSliceEvent</em></a> algorithm creates a sliced workspaces from an event-based
SANS input workspace according to the settings in the state object. The algorithm
will extract a slice based on a start and end time which are set in the state
object. In addition, the data type, i.e. if the slice is to be taken from a sample
or a can workspace, can be specified. Note that the monitor workspace is not
being sliced but scaled by the ratio of the proton charge of the sliced
workspace to the proton charnge of the full workspace.</p>
<p>The sub-states of this algorithm are:</p>
<ol class="arabic simple">
<li>Get the start time and the end time of the time slice</li>
<li>If the data set is from a <em>Can</em> measurement, then don&#8217;t perform a slice</li>
<li>Slice the scatter workspace using the start and end time and <a class="reference external" href="http://docs.mantidproject.org/algorithms/FilterByTime-v1.html#algm-filterbytime" title="(in MantidProject v3.12)"><em class="xref std std-ref">FilterByTime</em></a></li>
<li>Get the partial charge for the sliced data and calculate the slice factor which is <em>(partial charge) / (total charge)</em></li>
<li>Multiply the monitor workspace with the scale factor</li>
<li>Set the sliced scatter data, the scaled monitor data and the slice factor on the output of this algorithm</li>
</ol>
</div>
</div>
<div class="section" id="work-flow-algorithm-orchestration">
<h2><a class="toc-backref" href="#id47">Work-flow algorithm orchestration</a><a class="headerlink" href="#work-flow-algorithm-orchestration" title="Permalink to this headline">¶</a></h2>
<p>The orchestration of the work-flow algorithms is mainly handled by the <em>SANSReductionCore</em>
class in <em>sans_reduction_core.py</em>. It defines the sequence of work-flow algorithms and how data is
passed between them. However, executing the algorithm <em>SANSReductionCore</em> does
not run a full reduction, but rather only reduces either the sample or the can data.</p>
<p>For this the <em>SANSSingleReduction</em> algorithm was developed.
It runs <em>SANSReductionCore</em> with the appropriate
data (sample or can) and performs the required post processing, e.g. stitching.
This algorithm will produce a fully reduced output. However it will not produce it in the desired form,
e.g. correct name of the output workspaces, grouping of multi-period reduced data etc. This is achieved with
an instance of <em>SANSBatchReduction</em> (not a work-flow algorithm!) in module <em>sans_batch.py</em>. This
is the entry point for any reduction.</p>
<div class="section" id="sansbatchreduction">
<h3><a class="toc-backref" href="#id48"><em>SANSBatchReduction</em></a><a class="headerlink" href="#sansbatchreduction" title="Permalink to this headline">¶</a></h3>
<p>This class is the entry point for any reduction and is not an algorithm but rather
a script. It takes three important inputs:</p>
<ul class="simple">
<li>A list of SANS state objects. Each state object defines a reduction. In fact if the state object contains
period data with <img class="math" src="_images/math/8c45b38d633fb6de83fc7087c4db116a5565752a.png" alt="N" style="vertical-align: 0px"/> periods and <img class="math" src="_images/math/b6e6bf2d998d1a33904141106a453324f9c97b35.png" alt="M" style="vertical-align: 0px"/> time slices it will in fact define <img class="math" src="_images/math/c2efb06e8ba126a9065ef846246d5fb41667b88a.png" alt="N \times M" style="vertical-align: 0px"/> reductions.</li>
<li>A <em>use_optimizations</em> boolean flag. If true, the data loading mechanism will check the ADS first if
the required data is available from there and only load the data if it is not present. It will place newly
loaded data into the ADS. The ADS is also checked for can reductions.</li>
<li>An <em>output_mode</em> enum, which can be:<ul>
<li><em>PublishToADS</em> means that the reduced data is added to the ADS</li>
<li><em>SaveToFile</em> means that the reduced data is saved only to file</li>
<li><em>Both</em> means that the reduced data is added to the ADS and saved to file</li>
</ul>
</li>
</ul>
<p><em>SANSBatchReduction</em> reduces the list of states sequentially. The for-loop in
the <em>execute</em> method lends itself to parallelization via <em>MPI</em>, hence this could be
a potential future optimization if this should be required. The sub-steps to
handle each state object are:</p>
<ol class="arabic simple">
<li>Load the data which is relevant for the particular reduction (make use of optimizations if applicable)</li>
<li>If the state object contains multi-period data with <img class="math" src="_images/math/8c45b38d633fb6de83fc7087c4db116a5565752a.png" alt="N" style="vertical-align: 0px"/> periods and/or <img class="math" src="_images/math/b6e6bf2d998d1a33904141106a453324f9c97b35.png" alt="M" style="vertical-align: 0px"/> time slices
then generate <img class="math" src="_images/math/c2efb06e8ba126a9065ef846246d5fb41667b88a.png" alt="N \times M" style="vertical-align: 0px"/> state objects</li>
<li>For each state object run the <em>SANSSingleReduction</em> algorithm</li>
<li>Group the output workspaces if required, e.g. for reduced multi-period data</li>
<li>Provide workspaces to the selected output channel, i.e. ADS, files or both.</li>
</ol>
<p>Note that <em>SANSBatchReduction</em> also sets the name of the reduced data.</p>
<p>The users can interact with the new SANS reduction back-end either via the GUI or
the Python interface. Both of these methods utilize the <em>SANSBatchReduction</em>
to perform the reduction.</p>
</div>
<div class="section" id="sanssinglereduction">
<h3><a class="toc-backref" href="#id49"><em>SANSSingleReduction</em></a><a class="headerlink" href="#sanssinglereduction" title="Permalink to this headline">¶</a></h3>
<p>The <em>SANSSingleReduction</em> algorithm defines a single complete reduction of
a data set, i.e. it will run the reduction for the <em>Sample</em> and <em>Can</em> and perform
the subtraction of these results if the reduction has been set up
to do this. In particular this algorithm stitches the reduced workspaces of the
different detectors using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSStitch-v1.html#algm-sansstitch" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSStitch</em></a>,
again only if the reduction has been set up to do this.</p>
</div>
<div class="section" id="sansreductioncore">
<h3><a class="toc-backref" href="#id50"><em>SANSReductionCore</em></a><a class="headerlink" href="#sansreductioncore" title="Permalink to this headline">¶</a></h3>
<p>This work-flow algorithm actually defines the order of the reduction steps and is the
inner core of the orchestration mechanism. The inputs to this algorithm are</p>
<ul class="simple">
<li>A SANS state object</li>
<li>Several input workspaces</li>
<li>A detector type selection, i.e. <em>LAB</em> or <em>HAB</em></li>
<li>A data type selection, i.e. <em>Sample</em> or <em>Can</em></li>
</ul>
<p>The sub-steps of this algorithm are:</p>
<ol class="arabic simple">
<li>Get the cropped input <em>ScatterWorkspace</em>. The cropping is defined by the selected detector type.
The underlying algorithm is <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCrop-v1.html#algm-sanscrop" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCrop</em></a>.</li>
<li>Create an event slice of the input workspace using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSSliceEvent-v1.html#algm-sanssliceevent" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSSliceEvent</em></a>.
Note that event slicing is only applied to event-mode workspaces and only when it has been
specified by the user. During this step the scatter workspace is sliced and the associated
monitor workspace is scaled. The scaling factor is the ratio of the charge of the sliced data set
and the charge of the entire data set.</li>
<li>If we are dealing with an even-mode workspace and the compatibility mode has been chosen then
either a custom binning or the monitor binning is applied using <a class="reference external" href="http://docs.mantidproject.org/algorithms/Rebin-v1.html#algm-rebin" title="(in MantidProject v3.12)"><em class="xref std std-ref">Rebin</em></a> or
<a class="reference external" href="http://docs.mantidproject.org/algorithms/RebinToWorkspace-v1.html#algm-rebintoworkspace" title="(in MantidProject v3.12)"><em class="xref std std-ref">RebinToWorkspace</em></a>, respectively.</li>
<li>Both the data and the monitor workspace perform an initial move operation
using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSMove-v1.html#algm-sansmove" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSMove</em></a>. The algorithm is applied twice. The first time using
the <em>SetToZero</em> mode in case the algorithm had been loaded and moved already previously. This
resets the instrument position of the workspace to the positions of the base instrument. The second
time the move algorithm is operated in <em>InitialMove</em> mode.</li>
<li>The data workspace is masked using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSMaskWorkspace-v1.html#algm-sansmaskworkspace" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSMaskWorkspace</em></a>. Note that
only the general masks and the masks for the selected component are applied.
Note that all steps up until now were performed in the time-of-flight domain.</li>
<li>Convert the data from the time-of-flight to the wavelength domain using
<a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSConvertToWavelength-v1.html#algm-sansconverttowavelength" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSConvertToWavelength</em></a>.</li>
<li>Scale the data set using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSScale-v1.html#algm-sansscale" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSScale</em></a>. This will multiply the data set
with the absolute scale and divide by the sample volume.</li>
<li>This step creates the adjustment workspaces using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSCreateAdjustmentWorkspaces-v1.html#algm-sanscreateadjustmentworkspaces" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSCreateAdjustmentWorkspaces</em></a>.
This uses the input <em>TransmissionWorkspace</em> and <em>DirectWorkspace</em> workspaces. Note that
the instruments referenced in the workspace are moved using <a class="reference external" href="http://docs.mantidproject.org/algorithms/SANSMove-v1.html#algm-sansmove" title="(in MantidProject v3.12)"><em class="xref std std-ref">SANSMove</em></a> before they are used by the adjustment
algorithm. The outputs are a wavelength-adjustment workspace, a pixel-adjustment workspace and a wavelength-and-pixel adjustment
workspace. Note that their creation is optional.</li>
<li>Convert the data workspace into histogram-mode using <a class="reference external" href="http://docs.mantidproject.org/algorithms/RebinToWorkspace-v1.html#algm-rebintoworkspace" title="(in MantidProject v3.12)"><em class="xref std std-ref">RebinToWorkspace</em></a>.
This is only relevant for event-mode workspaces where the compatibility mode has not been used. Up until
now the event-mode workspace could be used as an event workspace, but the momentum transfer conversion (the next step)
requires a histogram-mode workspace.</li>
<li>The final step, the conversion to momentum transfer units, either uses <a class="reference external" href="http://docs.mantidproject.org/algorithms/Q1D-v2.html#algm-q1d" title="(in MantidProject v3.12)"><em class="xref std std-ref">Q1D</em></a>
or <a class="reference external" href="http://docs.mantidproject.org/algorithms/Qxy-v1.html#algm-qxy" title="(in MantidProject v3.12)"><em class="xref std std-ref">Qxy</em></a> depending on the setting of the reduction dimensionality. This step
uses the data workspace as well as all of the adjustment workspaces which have been provided earlier
on. The resulting <em>OutputWorkspace</em> and the <em>SumOfCounts</em> as well as <em>SumOfNormFactors</em> counts
are provided as outputs.</li>
</ol>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="InstrumentViewer.html" title="Previous Chapter: Instrument Viewer Widget"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Instrument Viewe...</span>
    </a>
  </li>
  <li>
    <a href="LoadAlgorithmHook.html" title="Next Chapter: Load Algorithm Hook"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Load Algorithm H... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>