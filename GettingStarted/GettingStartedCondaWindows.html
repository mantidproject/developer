<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Develop with Conda on Windows</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Develop with Conda on Linux" href="GettingStartedCondaLinux.html" />
    <link rel="prev" title="Getting Started" href="GettingStarted.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../index.html">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
<div class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
    
    <li class="nav-item nav-item-1"><a href="GettingStarted.html" accesskey="U">Getting Started</a> &#187;</li>
    
    
    
    
    <li class="nav-item nav-item-this"><a href="">Develop with Conda on Windows</a></li>
    
    
  </ul>
</div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="develop-with-conda-on-windows">
<span id="gettingstartedcondawindows"></span><h1>Develop with Conda on Windows<a class="headerlink" href="#develop-with-conda-on-windows" title="Permalink to this heading">¶</a></h1>
<section id="install-visual-studio-2022-community-edition">
<h2>Install <a class="reference external" href="https://visualstudio.microsoft.com/downloads/">Visual Studio 2022 Community Edition</a><a class="headerlink" href="#install-visual-studio-2022-community-edition" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>When asked about installation workloads choose <code class="docutils literal notranslate"><span class="pre">Desktop</span> <span class="pre">development</span> <span class="pre">with</span> <span class="pre">C++</span></code></p></li>
<li><p>Under the “Installation details” section verify that the following are checked:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Windows</span> <span class="pre">Universal</span> <span class="pre">CRT</span> <span class="pre">SDK</span></code></p></li>
<li><p>The latest <code class="docutils literal notranslate"><span class="pre">Windows</span> <span class="pre">10</span> <span class="pre">SDK</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MSVC</span> <span class="pre">v142</span> <span class="pre">-</span> <span class="pre">VS</span> <span class="pre">2019</span> <span class="pre">C++</span> <span class="pre">x64/x86</span> <span class="pre">build</span> <span class="pre">tools</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>If your machine has less than 32GB of memory Mantid may not build. If you have problems change the maximum number of parallel project builds to 1 in Visual Studio in Tools -&gt; Options -&gt; Projects and Solutions -&gt; Build And Run.</p></li>
</ul>
</section>
<section id="install-git">
<h2>Install <a class="reference external" href="https://git-scm.com/">Git</a><a class="headerlink" href="#install-git" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Install the latest version of Git, and ensure git bash was installed and the git executable location was added to your PATH, if you didn’t do this as part of your installation you can do this <a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)#to-add-a-path-to-the-path-environment-variable">manually</a>.</p></li>
<li><p>We no longer need Git LFS as conda handles the dependencies that used to be in the third party directory.</p></li>
</ul>
</section>
<section id="turn-off-python-association-in-windows">
<h2>Turn off Python association in Windows<a class="headerlink" href="#turn-off-python-association-in-windows" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Because of the way Windows associates Python files with it’s Windows Store version of python we need to turn off this association. If you don’t turn this off you will have issues when running the pre-commit framework.</p></li>
<li><p>Navigate to your Settings -&gt; Manage App Execution Aliases, and turn off all Python Aliases.</p></li>
</ul>
</section>
<section id="clone-the-mantid-source-code">
<h2>Clone the mantid source code<a class="headerlink" href="#clone-the-mantid-source-code" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p><strong>Important</strong>: If you have any existing non-conda mantid development environments, do not re-use the source and build directories for your conda environment. We recommend that you clone a new instance of the source and keep separate build directories to avoid any cmake configuration problems.</p></li>
<li><p>Clone the mantid source code by either:</p>
<blockquote>
<div><ul class="simple">
<li><p>Using git bash and cloning the codebase by calling <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:mantidproject/mantid.git</span></code> in the directory you want the code to clone to. This sets you up with accessing the remote repository via SSH so make sure to setup git properly using this <a class="reference external" href="https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup">startup guide</a> and ensure your ssh key is setup using this <a class="reference external" href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh">guide to Github with SSH</a>.</p></li>
<li><p>Or using <a class="reference external" href="https://www.gitkraken.com/">GitKraken</a>.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="install-mambaforge">
<h2>Install <a class="reference external" href="https://github.com/conda-forge/miniforge/releases">Mambaforge</a><a class="headerlink" href="#install-mambaforge" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Choose the latest version of <code class="docutils literal notranslate"><span class="pre">Mambaforge-Windows-x86_64.exe</span></code></p></li>
<li><p>Run your downloaded <code class="docutils literal notranslate"><span class="pre">Mambaforge-Windows-x86_64.exe</span></code> and work through the installer until it finishes. In order to make it easier later on, check the box that adds Conda to your path.</p></li>
</ul>
</section>
<section id="setup-the-mantid-conda-environment">
<h2>Setup the mantid conda environment<a class="headerlink" href="#setup-the-mantid-conda-environment" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Open a terminal or powershell with conda enabled there are two ways to do this:</p>
<blockquote>
<div><ul class="simple">
<li><p>Open an Anaconda prompt (Mambaforge).</p></li>
<li><p>Add the path of your Mambaforge installation to your system path, if you didn’t do it during installation (Follow the answers in the <a class="reference external" href="https://docs.anaconda.com/anaconda/user-guide/faq/#installing-anaconda">FAQ</a>). Then you can use conda from the Command Prompt and Powershell.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Create the mantid conda environment by navigating to your mantid source code directory in your terminal and running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">mantid-developer-win.yml</span></code></p></li>
</ul>
</section>
<section id="configure-cmake-and-generate-build-files">
<h2>Configure CMake and generate build files<a class="headerlink" href="#configure-cmake-and-generate-build-files" title="Permalink to this heading">¶</a></h2>
<ul>
<li><dl class="simple">
<dt>You can configure CMake using an MS Visual Studio or Ninja generator. Choose one of the following:</dt><dd><ul class="simple">
<li><p>For MS Visual Studio, use the terminal or powershell prompt from the last step.</p></li>
<li><p>For Ninja, open the <code class="docutils literal notranslate"><span class="pre">x64</span> <span class="pre">Native</span> <span class="pre">Tools</span> <span class="pre">Command</span> <span class="pre">Prompt</span> <span class="pre">for</span> <span class="pre">VS</span> <span class="pre">2019</span></code> or <code class="docutils literal notranslate"><span class="pre">x64</span> <span class="pre">Native</span> <span class="pre">Tools</span> <span class="pre">Command</span> <span class="pre">Prompt</span> <span class="pre">for</span> <span class="pre">VS</span> <span class="pre">2022</span></code> from your search bar.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Navigate to your mantid source directory.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">mantid-developer</span></code> to activate your conda environment.</p></li>
<li><p>If you want your build directory inside your source directory, run either:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--preset=win-vs</span></code> for configuring with Visual Studio 2022, or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--preset=win-vs-2019</span></code> for configuring with Visual Studio 2019, or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--preset=win-ninja</span></code> for configuring with Ninja.</p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Alternatively, if you want to specify a different build directory, run either:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--preset=win-vs</span> <span class="pre">-B</span> <span class="pre">{BUILD_DIR}</span></code>, or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--preset=win-vs-2019</span>&#160; <span class="pre">-B</span> <span class="pre">{BUILD_DIR}</span></code>, or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--preset=win-ninja</span> <span class="pre">-B</span> <span class="pre">{BUILD_DIR}</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="compile-and-build-using-ms-visual-studio">
<h2>Compile and Build using MS Visual Studio<a class="headerlink" href="#compile-and-build-using-ms-visual-studio" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Open visual studio with <code class="docutils literal notranslate"><span class="pre">visual-studio.bat</span></code>, which is found in the build folder, and then click build.</p></li>
<li><p>It’s not possible to compile in Debug on Windows with conda libraries, however Release, RelWithDebInfo, and DebugWithRelRuntime for Debugging will compile fine.</p></li>
<li><p>Once in visual studio, the correct target to use as a startup project in visual studio is <code class="docutils literal notranslate"><span class="pre">workbench</span></code>, not <code class="docutils literal notranslate"><span class="pre">MantidWorkbench</span></code>. You can then press F5 to start workbench.</p></li>
</ul>
</section>
<section id="compile-and-build-using-ninja">
<h2>Compile and Build using Ninja<a class="headerlink" href="#compile-and-build-using-ninja" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>From the command line:</dt><dd><ul>
<li><p>Navigate to the build directory using the <code class="docutils literal notranslate"><span class="pre">x64</span> <span class="pre">Native</span> <span class="pre">Tools</span> <span class="pre">Command</span> <span class="pre">Prompt</span> <span class="pre">for</span> <span class="pre">VS</span> <span class="pre">2019</span></code> or <code class="docutils literal notranslate"><span class="pre">x64</span> <span class="pre">Native</span> <span class="pre">Tools</span> <span class="pre">Command</span> <span class="pre">Prompt</span> <span class="pre">for</span> <span class="pre">VS</span> <span class="pre">2022</span></code> from the previous step.</p></li>
<li><p>To build Mantid Workbench use: <code class="docutils literal notranslate"><span class="pre">ninja</span></code></p></li>
<li><p>To build the unit tests use: <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">AllTests</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>In Visual Studio:</dt><dd><ul>
<li><p>Open Visual Studio with <code class="docutils literal notranslate"><span class="pre">visual-studio_ninja.bat</span></code>, which is found in the build folder</p></li>
<li><p>Select “win-ninja” from the Configuration dropdown at the top of the screen</p></li>
<li><p>Select “Switch between solutions and available views” in the Solution Explorer and click on “CMake Targets View”</p></li>
<li><p>It is recommmended that the “When cache is out of date” option is set to “Never run configure step automatically” in Tools-&gt;Options-&gt;CMake</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="building-and-debugging-with-clion">
<h2>Building and debugging with CLion<a class="headerlink" href="#building-and-debugging-with-clion" title="Permalink to this heading">¶</a></h2>
<p>Please follow the Windows related instructions on <a class="reference internal" href="../CLion.html#clion-ref"><span class="std std-ref">this page</span></a>.</p>
</section>
<section id="cmake-conda-variables">
<h2>CMake Conda variables<a class="headerlink" href="#cmake-conda-variables" title="Permalink to this heading">¶</a></h2>
<p>There are two Conda specific CMake options <cite>CONDA_ENV</cite> and <cite>CONDA_BUILD</cite>. The former should be used whenever you are building within a Conda environment, as it ensures our finders (e.g FindNexus.cmake) look in the correct locations for libraries.
The CONDA_BUILD parameter is used to customise our installation, which is required when we are using the conda-build tool to build and package Mantid. These options can be passed to CMake on the command line using -DCONDA_ENV=True for example.</p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="GettingStarted.html" title="Previous Chapter: Getting Started"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Getting Started</span>
    </a>
  </li>
  <li>
    <a href="GettingStartedCondaLinux.html" title="Next Chapter: Develop with Conda on Linux"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Develop with ... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>