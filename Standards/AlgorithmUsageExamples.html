<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Algorithm Usage Examples</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <script src="../_static/documentation_options.js?v=30d551ce"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interface Documentation" href="InterfaceDocumentation.html" />
    <link rel="prev" title="Algorithm Documentation" href="AlgorithmDocumentation.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="../index.html">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
<div class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
    
    <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Standards</a> &#187;</li>
    
    
    
    
    <li class="nav-item nav-item-this"><a href="">Algorithm Usage Examples</a></li>
    
    
  </ul>
</div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="algorithm-usage-examples">
<span id="algorithmusageexamples"></span><h1>Algorithm Usage Examples<a class="headerlink" href="#algorithm-usage-examples" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#guide" id="id2">Guide</a></p>
<ul>
<li><p><a class="reference internal" href="#using-createsampleworkspace-and-createworkspace" id="id3">Using CreateSampleWorkspace and CreateWorkspace</a></p></li>
<li><p><a class="reference internal" href="#when-needing-to-load-a-data-file" id="id4">When needing to load a data file</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-the-tests" id="id5">Running the Tests</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>A <em>usage example</em> is part of the documentation page of an algorithm.</p>
<p>From a user’s point of view, the main purposes of usage examples are:</p>
<ul class="simple">
<li><p>Getting started using the algorithm as part of a Python script</p></li>
<li><p>Understanding the algorithm</p></li>
<li><p>Showing hints/comments etc. that help understand Mantid Python scripting in general</p></li>
</ul>
<p>The usage examples are written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>, which can be converted to HTML and the code in the usage examples can be tested.</p>
</section>
<section id="guide">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Guide</a><a class="headerlink" href="#guide" title="Link to this heading">¶</a></h2>
<p>The example below show the proposed way to format an usage example in reStructuredText.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="gh">Usage</span>
<span class="gh">-----</span>

<span class="gs">**Example - simple rebin of a histogram workspace:**</span>

<span class="p">..</span> <span class="ow">testcode</span><span class="p">::</span> ExHistSimple

   # create histogram workspace
   dataX = [0,1,2,3,4,5,6,7,8,9] # or use dataX=range(0,10)
   dataY = [1,1,1,1,1,1,1,1,1] # or use dataY=[1]*9
   ws = CreateWorkspace(dataX, dataY)

   # rebin from min to max with size bin = 2
   ws = Rebin(ws, 2)

   print &quot;The rebinned X values are: &quot; + str(ws.readX(0))
   print &quot;The rebinned Y values are: &quot; + str(ws.readY(0))


Output:

<span class="p">..</span> <span class="ow">testoutput</span><span class="p">::</span> ExHistSimple

   The rebinned X values are: [ 0.  2.  4.  6.  8.  9.]
   The rebinned Y values are: [ 2.  2.  2.  2.  1.]
</pre></div>
</div>
<p>What is required is:</p>
<ul class="simple">
<li><p>Short description explaining the example, formatted as shown above, i.e. using <code class="docutils literal notranslate"><span class="pre">**</span></code> to embolden the text.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testcode::</span></code> section, with a unique ‘namespace’ name, here <code class="docutils literal notranslate"><span class="pre">ExHistSimple</span></code>. This ‘namespace’ is not shown when converted to HTML, but is used in testing the code. This section contains the actual Python code demonstrating a usage of the algorithm. This code block contains commented code, finishing with one or more Python <code class="docutils literal notranslate"><span class="pre">print</span></code> lines as shown</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testoutput::</span></code> section. This section must have a matching ‘namespace’ name to the <code class="docutils literal notranslate"><span class="pre">..testcode::</span></code> section. It simply contains a copy of the text that is printed out in the <code class="docutils literal notranslate"><span class="pre">..testcode::</span></code> section.</p></li>
<li><p>Include the “Output:” string above the <code class="docutils literal notranslate"><span class="pre">..testoutput::</span></code> directive.</p></li>
</ul>
<p>What is optional:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">..testcleanup::</span></code> section. This section must have a matching ‘namespace’ name to the <code class="docutils literal notranslate"><span class="pre">..testcode::</span></code> section. Here, add Python code to do any cleanup of files etc. that were created by the tests. See the notes below for things that are cleaned automatically.</p></li>
</ul>
<p>Notes:</p>
<ul class="simple">
<li><p>The configuration has a global “testcleanup” implemented which calls <code class="docutils literal notranslate"><span class="pre">FrameworkManager::clear()</span></code> to clear algorithms, workspaces &amp; instruments so these are dealt with automatically.</p></li>
<li><p>There must be a clear blank line before the <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testcode::</span></code> and <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">testoutput</span></code> directives or the test is ignored. As with unit tests you should write a failing test first to ensure it is running.</p></li>
</ul>
<p>What is worth keeping in mind is:</p>
<ul class="simple">
<li><p><em>Assume the user is new to Python</em>. Consider giving hints to more advanced Python in comments, or introduce a simple example first.</p></li>
<li><p>Use comments.</p></li>
<li><p>Use Python <code class="docutils literal notranslate"><span class="pre">print</span></code> to output results, which, where possible, helps to understand the algorithm.</p></li>
</ul>
<p>A Jenkins job tests that the usage examples are not broken, i.e. that they continue to provide a working demonstration against the current build. It is vital to stress that the purpose of usage testing is <em>not to replace unit testing</em> (or system testing). The purpose of usage testing (better described as demonstration examples), is to provide some happy-path examples, which, where this is possible, can assist the user understanding of the Python code. This is very different from the purposes of testing in general, see <a class="reference internal" href="../UnitTestGoodPractice.html#unittestgoodpractice"><span class="std std-ref">here</span></a>.</p>
<p>Additional benefits of usage examples:</p>
<ul class="simple">
<li><p>Quick look-up for developers on how to use a certain algorithm in Python scripting</p></li>
<li><p>Allow the user to test that scripts return expected output in their installed Mantid versions</p></li>
<li><p>Additional test coverage of Mantid Python API</p></li>
</ul>
<section id="using-createsampleworkspace-and-createworkspace">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Using CreateSampleWorkspace and CreateWorkspace</a><a class="headerlink" href="#using-createsampleworkspace-and-createworkspace" title="Link to this heading">¶</a></h3>
<p>There are many ways to create sample workspaces. For example <a class="reference external" href="https://docs.mantidproject.org/nightly/algorithms/CreateMDHistoWorkspace-v1.html#algm-createmdhistoworkspace" title="(in MantidProject v6.8)"><span class="xref std std-ref">CreateMDHistoWorkspace</span></a>, <a class="reference external" href="https://docs.mantidproject.org/nightly/algorithms/CreateSampleWorkspace-v1.html#algm-createsampleworkspace" title="(in MantidProject v6.8)"><span class="xref std std-ref">CreateSampleWorkspace</span></a> and <a class="reference external" href="https://docs.mantidproject.org/nightly/algorithms/CreateWorkspace-v1.html#algm-createworkspace" title="(in MantidProject v6.8)"><span class="xref std std-ref">CreateWorkspace</span></a>. CreateSampleWorkspace creates a fully defined workspace (either event or histogram) but for creating simple histogram workspace CreateWorkspace may be a better option. Above is shown an example where CreateWorkspace is used. Below is a more complex use of CreateSampleWorkspace:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="gh">Usage</span>
<span class="gh">-----</span>

<span class="gs">**Example - Fit a Gaussian to a peak in a spectrum:**</span>

<span class="p">..</span> <span class="ow">testcode</span><span class="p">::</span> ExFitPeak

   # create a workspace with a gaussian peak sitting on top of a linear (here flat) background
   ws = CreateSampleWorkspace(Function=&quot;User Defined&quot;, UserDefinedFunction=&quot;name=LinearBackground, \
      A0=0.3;name=Gaussian, PeakCentre=5, Height=10, Sigma=0.7&quot;, NumBanks=1, BankPixelWidth=1, XMin=0, XMax=10, BinWidth=0.1)

   # Setup the data to fit:
   workspaceIndex = 0  # the spectrum with which WorkspaceIndex to fit
   startX = 1      # specify fitting region
   endX = 9      #

   # Setup the model, here a Gaussian, to fit to data
   tryCentre = &#39;4&#39;   # A start guess on peak centre
   sigma = &#39;1&#39;          # A start guess on peak width
   height = &#39;8&#39;         # A start guess on peak height
   myFunc = &#39;name=Gaussian, Height=&#39;+height+&#39;, PeakCentre=&#39;+tryCentre+&#39;, Sigma=&#39;+sigma
   # here purposely haven&#39;t included a linear background which mean fit will not be spot on
   # to include a linear background uncomment the line below
   #myFunc = &#39;name=LinearBackground, A0=0.3;name=Gaussian, Height=&#39;+height+&#39;, PeakCentre=&#39;+tryCentre+&#39;, Sigma=&#39;+sigma

   # Do the fitting
   fitStatus, chiSq, covarianceTable, paramTable, fitWorkspace = Fit(InputWorkspace=&#39;ws&#39;, \
      WorkspaceIndex=0, StartX = startX, EndX=endX, Output=&#39;fit&#39;, Function=myFunc)

   print &quot;The fit was: &quot; + fitStatus
   print(&quot;chi-squared of fit is: %.2f&quot; % chiSq)
   print(&quot;Fitted Height value is: %.2f&quot; % paramTable.column(1)[0])
   print(&quot;Fitted centre value is: %.2f&quot; % paramTable.column(1)[1])
   print(&quot;Fitted sigma value is: %.2f&quot; % paramTable.column(1)[2])
   # fitWorkspace contains the data, the calculated and the difference patterns
   print &quot;Number of spectra in fitWorkspace is: &quot; +  str(fitWorkspace.getNumberHistograms())
   print(&quot;The 20th y-value of the calculated pattern: %.4f&quot; % fitWorkspace.readY(1)[19])

<span class="p">..</span> <span class="ow">testcleanup</span><span class="p">::</span> ExFitPeak

   DeleteWorkspace(ws)

Output:

<span class="p">..</span> <span class="ow">testoutput</span><span class="p">::</span> ExFitPeak

   The fit was: success
   chi-squared of fit is: 0.14
   Fitted Height value is: 9.79
   Fitted centre value is: 5.05
   Fitted sigma value is: 0.77
   Number of spectra in fitWorkspace is: 3
   The 20th y-value of the calculated pattern: 0.2361
</pre></div>
</div>
<p>For a more simple use of CreateSampleWorkspace see example below (note if no arguments are given then a histogram workspace is created):</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="gh">Usage</span>
<span class="gh">-----</span>

<span class="gs">**Example - use option PreserveEvents:**</span>

<span class="p">..</span> <span class="ow">testcode</span><span class="p">::</span> ExEventRebin

   # create some event workspace
   ws = CreateSampleWorkspace(WorkspaceType=&quot;Event&quot;)

   print &quot;What type is the workspace before 1st rebin: &quot; + str(type(ws))
   # rebin from min to max with size bin = 2 preserving event workspace (default behaviour)
   ws = Rebin(ws, 2)
   print &quot;What type is the workspace after 1st rebin: &quot; + str(type(ws))
   ws = Rebin(ws, 2, PreserveEvents=False)
   print &quot;What type is the workspace after 2nd rebin: &quot; + str(type(ws))
   # note you can also check the type of a workspace using: print isinstance(ws, IEventWorkspace)

<span class="p">..</span> <span class="ow">testcleanup</span><span class="p">::</span> ExEventRebin

   DeleteWorkspace(ws)

Output:

<span class="p">..</span> <span class="ow">testoutput</span><span class="p">::</span> ExEventRebin

   What type is the workspace before 1st rebin: &lt;class &#39;mantid.api._api.IEventWorkspace&#39;&gt;
   What type is the workspace after 1st rebin: &lt;class &#39;mantid.api._api.IEventWorkspace&#39;&gt;
   What type is the workspace after 2nd rebin: &lt;class &#39;mantid.api._api.MatrixWorkspace&#39;&gt;
</pre></div>
</div>
</section>
<section id="when-needing-to-load-a-data-file">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">When needing to load a data file</a><a class="headerlink" href="#when-needing-to-load-a-data-file" title="Link to this heading">¶</a></h3>
<p>Instructions to add a new data file to the repository are available <a class="reference internal" href="../DataFilesForTesting.html#datafilesfortesting"><span class="std std-ref">here</span></a>. Files from the repository will be bundled up into a .zip file, and this .zip made available for download from the Mantid download page.</p>
<p>If you use files you must add the line</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">include</span><span class="p">::</span> ../usagedata-note.txt
</pre></div>
</div>
<p>as shown in the example below. This will generate a note to the user explaining how to download the UsageData.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="gh">Usage</span>
<span class="gh">-----</span>

<span class="p">..</span> <span class="ow">include</span><span class="p">::</span> ../usagedata-note.txt

<span class="gs">**Example - Load ISIS histogram Nexus file:**</span>
(see <span class="na">:ref:</span><span class="nv">`LoadISISNexus &lt;algm-LoadISISNexus&gt;`</span> for more options)

<span class="p">..</span> <span class="ow">testcode</span><span class="p">::</span> ExLoadISISnexusHist

   # Load ISIS LOQ histogram dataset
   ws = Load(&#39;LOQ49886.nxs&#39;)

   print &quot;The 1st x-value of the first spectrum is: &quot; + str(ws.readX(0)[0])

<span class="p">..</span> <span class="ow">testcleanup</span><span class="p">::</span> ExLoadISISnexusHist

   DeleteWorkspace(ws)

Output:

<span class="p">..</span> <span class="ow">testoutput</span><span class="p">::</span> ExLoadISISnexusHist

   The 1st x-value of the first spectrum is: 5.0
</pre></div>
</div>
</section>
</section>
<section id="running-the-tests">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Running the Tests</a><a class="headerlink" href="#running-the-tests" title="Link to this heading">¶</a></h2>
<p>In order to execute the usage examples tests, you can run the cmake <cite>docs-doctest</cite> target inside of your build folder.</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>cmake --build . --target docs-doctest
</pre></div>
</div>
<p>If you use ninja, in your build folder you can also run:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>ninja docs-doctest
</pre></div>
</div>
<p>On some machines, the usage examples may take a while to run completely.</p>
<p>If you want to only execute tests from a single file, you can run the following from your build folder:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>python -m sphinx --no-color -b doctest -d docs/doctrees &lt;sourcedir&gt;/docs/source docs/doctest &lt;sourcedir&gt;/docs/source/&lt;path-to-rst-file&gt;
</pre></div>
</div>
<p>See <a class="reference internal" href="DocumentationGuideForDevs.html#documentationguidefordevs"><span class="std std-ref">here</span></a> for more info on writing documentation.</p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="AlgorithmDocumentation.html" title="Previous Chapter: Algorithm Documentation"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Algorithm Doc...</span>
    </a>
  </li>
  <li>
    <a href="InterfaceDocumentation.html" title="Next Chapter: Interface Documentation"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Interface Doc... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>