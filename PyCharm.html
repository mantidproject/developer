<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PyCharm</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="VSCode" href="VSCode.html" />
    <link rel="prev" title="Visual Studio Build Impact" href="VisualStudioBuildImpact.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="pycharm">
<span id="pycharm-ref"></span><h1>PyCharm<a class="headerlink" href="#pycharm" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#selecting-pycharm-versions" id="id1">Selecting PyCharm versions</a></li>
<li><a class="reference internal" href="#setup-python-development-environment-with-conda" id="id2">Setup Python development environment with Conda</a></li>
<li><a class="reference internal" href="#debug-python-in-workbench" id="id3">Debug Python in Workbench</a></li>
<li><a class="reference internal" href="#debug-python-in-unit-tests" id="id4">Debug Python in unit tests</a></li>
<li><a class="reference internal" href="#debug-python-in-system-tests-remote-debugging" id="id5">Debug Python in system tests/remote debugging</a></li>
</ul>
</div>
<div class="section" id="selecting-pycharm-versions">
<h2><a class="toc-backref" href="#id1">Selecting PyCharm versions</a><a class="headerlink" href="#selecting-pycharm-versions" title="Permalink to this headline">¶</a></h2>
<p>There are two versions of PyCharm that are in use in the team, Community and Professional. The main difference for our workflow is that professional offers support for remote debugging which can help with debugging Python code that is called from C++, such as algorithms called from Python interfaces.</p>
<p>If you haven’t installed PyCharm yet do that now, PyCharm can be installed from <a class="reference external" href="https://jetbrains.com/pycharm/download/">here</a>.</p>
</div>
<div class="section" id="setup-python-development-environment-with-conda">
<h2><a class="toc-backref" href="#id2">Setup Python development environment with Conda</a><a class="headerlink" href="#setup-python-development-environment-with-conda" title="Permalink to this headline">¶</a></h2>
<p>The assumption has been made that you have setup and built Mantid already, if you have not, please do so before hand by following, <a class="reference external" href="GettingStarted/GettingStarted.html">this guide</a>.</p>
<p>At any point in these instructions where <code class="docutils literal notranslate"><span class="pre">RelWithDebInfo</span></code> is used (including in file paths), you can replace it with any other build type such as <code class="docutils literal notranslate"><span class="pre">Debug</span></code> or <code class="docutils literal notranslate"><span class="pre">Release</span></code>. We use <code class="docutils literal notranslate"><span class="pre">RelWithDebInfo</span></code> for Conda specific builds to allow debugging due to <code class="docutils literal notranslate"><span class="pre">Debug</span></code> not being functional with the <code class="docutils literal notranslate"><span class="pre">Release</span> <span class="pre">ABIs</span></code>.</p>
<ul>
<li><p class="first">Open PyCharm</p>
</li>
<li><p class="first">If no project has been selected already, open the Mantid source code as a project.</p>
</li>
<li><p class="first">Open the <code class="docutils literal notranslate"><span class="pre">File-&gt;Settings</span> <span class="pre">menu</span></code>.</p>
</li>
<li><p class="first">In the left hand side select the option that is <code class="docutils literal notranslate"><span class="pre">Project:</span> <span class="pre">{SOURCE_CODE_FOLDER_NAME}</span></code> for example <code class="docutils literal notranslate"><span class="pre">Project:</span> <span class="pre">mantid</span></code>.</p>
</li>
<li><p class="first">Select the <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Interpreter</span></code> option.</p>
</li>
<li><p class="first">Select the button top right in the of the window, that looks like a settings cog, then select <code class="docutils literal notranslate"><span class="pre">Add...</span></code> from the submenu.</p>
</li>
<li><p class="first">From the left side of the window select <code class="docutils literal notranslate"><span class="pre">Conda</span> <span class="pre">Environment</span></code>.</p>
</li>
<li><p class="first">Select the <code class="docutils literal notranslate"><span class="pre">Existing</span> <span class="pre">environment</span></code>.</p>
</li>
<li><p class="first">Click on the <code class="docutils literal notranslate"><span class="pre">...</span></code> to open a file browser, and navigate to your Conda environment’s Python executable. This can be found in the directory you installed Conda (i.e. Mambaforge, Miniconda3 etc), on Windows navigate to your <code class="docutils literal notranslate"><span class="pre">{CONDA_DIRECTORY}/envs/mantid-developer/Python.exe</span></code>, your <code class="docutils literal notranslate"><span class="pre">{CONDA_DIRECTORY}</span></code> on windows may be in a similar location to this: <code class="docutils literal notranslate"><span class="pre">C:/Users/user/AppData/Local/mambaforge</span></code> on other OSs navigate to <code class="docutils literal notranslate"><span class="pre">{CONDA_DIRECTORY}/envs/mantid-developer/bin/python</span></code>.</p>
</li>
<li><p class="first">(Windows Only) Ensure that the line for <code class="docutils literal notranslate"><span class="pre">Conda</span> <span class="pre">executable</span></code> correctly points at your <code class="docutils literal notranslate"><span class="pre">conda.exe</span></code>, an example of this would be <code class="docutils literal notranslate"><span class="pre">{CONDA_DIRECTORY}/Scripts/conda.exe</span></code>.</p>
</li>
<li><p class="first">When done, click ok to close the window.</p>
</li>
<li><p class="first">Ensure that next to <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Interpreter:</span></code> it says your Python version and <code class="docutils literal notranslate"><span class="pre">(mantid-developer)</span></code> e.g. <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">3.8</span> <span class="pre">(mantid-developer)</span></code>.</p>
</li>
<li><p class="first">Then click Apply.</p>
</li>
<li><p class="first">Back on the left side, under <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Interpreter</span></code> there should be an option for <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Structure</span></code> select that.</p>
</li>
<li><p class="first">If you do not build Mantid in the same directory as your source but somewhere else add this as another Content Root, by selecting <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">Add</span> <span class="pre">Content</span> <span class="pre">Root</span></code> on the right hand side now.</p>
</li>
<li><p class="first">In the file tree, select each of the following and mark them as Sources by clicking the <code class="docutils literal notranslate"><span class="pre">Sources</span></code> button whilst it’s selected:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">{SOURCE}/scripts</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{SOURCE}/Framework/PythonInterface</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{SOURCE}/qt/applications/workbench</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{SOURCE}/qt/widgets</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{SOURCE}/qt/Python</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">In the file tree select your build directory and mark as Excluded by clicking the <code class="docutils literal notranslate"><span class="pre">Excluded</span></code> button whilst it’s selected.</p>
</li>
<li><p class="first">On Windows, select the <code class="docutils literal notranslate"><span class="pre">{BUILD}/bin/RelWithDeb</span></code> file and mark as Source by clicking the <code class="docutils literal notranslate"><span class="pre">Sources</span></code> button whilst it’s selected.</p>
</li>
<li><p class="first">On Linux or MacOS, select your <code class="docutils literal notranslate"><span class="pre">{BUILD}/bin</span></code> directory and mark as Source by clicking the <code class="docutils literal notranslate"><span class="pre">Sources</span></code> button whilst it’s selected.</p>
</li>
<li><p class="first">Click Apply, and then Ok to close the window.</p>
</li>
</ul>
</div>
<div class="section" id="debug-python-in-workbench">
<span id="debug-workbench-in-pycharm-ref"></span><h2><a class="toc-backref" href="#id3">Debug Python in Workbench</a><a class="headerlink" href="#debug-python-in-workbench" title="Permalink to this headline">¶</a></h2>
<p>Now that your Python development environment has been setup we can setup the debugging using Workbench.</p>
<ul class="simple">
<li>With an open project in Pycharm, open the Play configuration menu by Opening <code class="docutils literal notranslate"><span class="pre">Run-&gt;Edit</span> <span class="pre">Configurations...</span></code>.</li>
<li>Click the <code class="docutils literal notranslate"><span class="pre">+</span></code> icon top left</li>
<li>Select Python</li>
<li>Name it something to do with <code class="docutils literal notranslate"><span class="pre">Workbench</span></code></li>
<li>In the <code class="docutils literal notranslate"><span class="pre">Script</span> <span class="pre">Path:</span></code> box, on Linux/MacOS enter the <code class="docutils literal notranslate"><span class="pre">{BUILD}/bin/workbench</span></code> Python script, on Windows enter <code class="docutils literal notranslate"><span class="pre">{BUILD}/bin/RelWithDebInfo/workbench-script.pyw</span></code>, <code class="docutils literal notranslate"><span class="pre">.pyw</span></code> files will not appear in the search window as it only shows <code class="docutils literal notranslate"><span class="pre">.py</span></code> files, so you cannot search for it with the GUI.</li>
<li>In the <code class="docutils literal notranslate"><span class="pre">Working</span> <span class="pre">directory:</span></code> box, on Linux/MacOS enter the <code class="docutils literal notranslate"><span class="pre">{BUILD}/bin</span></code> directory, on Windows enter <code class="docutils literal notranslate"><span class="pre">{BUILD}/bin/RelWithDebInfo</span></code> directory.</li>
<li>Ensure the <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Interpreter:</span></code> box is your Python version following by <code class="docutils literal notranslate"><span class="pre">(mantid-developer)</span></code>, this ensures it runs using your Conda environment.</li>
<li>Click Ok and exit out the window.</li>
<li>You can now click the green play button in the top right of the window to create a Workbench instance from pycharm.</li>
<li>Alternatively you can click the green bug next to the green play button to start a debug session.</li>
</ul>
</div>
<div class="section" id="debug-python-in-unit-tests">
<h2><a class="toc-backref" href="#id4">Debug Python in unit tests</a><a class="headerlink" href="#debug-python-in-unit-tests" title="Permalink to this headline">¶</a></h2>
<p>This section assumes you have followed all previous instructions for debugging Python in workbench</p>
<p>There are 2 main ways to debug Python unit tests using the Unittests Python module.</p>
<ol class="arabic">
<li><p class="first">Navigate to the test you want to run in PyCharm, on the left side of the file in the margin, just to the right of the line numbers there should be a green play button, click that and it will let you start a debug or normal run of the tests.</p>
</li>
<li><dl class="first docutils">
<dt>A little more involved, but is easier to expand and test many things at once.</dt>
<dd><ul class="first last">
<li><p class="first">Same as when creating the Workbench debug session. Open the configuration menu by navigating to <code class="docutils literal notranslate"><span class="pre">Run-&gt;Edit</span> <span class="pre">Configurations...</span></code></p>
</li>
<li><p class="first">Click the <code class="docutils literal notranslate"><span class="pre">+</span></code> icon top left</p>
</li>
<li><p class="first">Select Unittests</p>
</li>
<li><p class="first">Give an appropriate name for the section of code you will be testing</p>
</li>
<li><p class="first">You have 3 options, enter the module name, script path or custom.</p>
<blockquote>
<div><ul class="simple">
<li>Module name for testing workbench project recovery tests looks like this <code class="docutils literal notranslate"><span class="pre">workbench.projectrecovery</span></code>, this runs all of the tests in the project recovery section. This is very useful for testing all of a specific section of the code base, without running it in a terminal.</li>
<li>Script path is very similar instead of passing a module name, you just give a filepath such as <code class="docutils literal notranslate"><span class="pre">{SOURCE}/qt/applications/workbench/workbench/projectrecovery</span></code> this achieves exactly the same as the previous step.</li>
<li>Custom is for passing custom arguments to the Unittests executable such as these: <a class="reference external" href="https://docs.python.org/3/library/unittest.html#command-line-interface">https://docs.python.org/3/library/unittest.html#command-line-interface</a></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="debug-python-in-system-tests-remote-debugging">
<h2><a class="toc-backref" href="#id5">Debug Python in system tests/remote debugging</a><a class="headerlink" href="#debug-python-in-system-tests-remote-debugging" title="Permalink to this headline">¶</a></h2>
<p>This functionality is useful for debugging Python code that is spawned in separate threads, such as Python algorithms called from C++ and system tests.</p>
<p>A PyCharm Professional license is required to use the Remote Debugging feature.</p>
<p>This section assumes you have followed all previous instructions for debugging Python in workbench and unit tests.</p>
<ul>
<li><p class="first">Like the Unit tests and workbench we need to add it as a configuration, open the configuration menu by navigating to <code class="docutils literal notranslate"><span class="pre">Run-&gt;Edit</span> <span class="pre">Configurations...</span></code></p>
</li>
<li><p class="first">Click the <code class="docutils literal notranslate"><span class="pre">+</span></code> icon top left</p>
</li>
<li><p class="first">Select <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Debug</span> <span class="pre">Server</span></code></p>
</li>
<li><p class="first">Give an appropriate name for remote debugging such as <code class="docutils literal notranslate"><span class="pre">Remote</span> <span class="pre">Debugging</span></code></p>
</li>
<li><p class="first">Copy the snippet of code that consists of <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pydevd-pycharm</span></code></p>
</li>
<li><p class="first">Close the configuration window</p>
</li>
<li><p class="first">Open Terminal at the bottom of the PyCharm window</p>
</li>
<li><p class="first">Paste the snippet of code and hit enter, this will install the remote debugger for PyCharm to use.</p>
</li>
<li><p class="first">Once installed, re-open the configuration menu by navigating to <code class="docutils literal notranslate"><span class="pre">Run-&gt;Edit</span> <span class="pre">Configurations...</span></code></p>
</li>
<li><p class="first">Ensure that the previously created <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Debug</span> <span class="pre">Server</span></code> is selected in the left hand side tree selection.</p>
</li>
<li><p class="first">Ensure that you set the port box to something that isn’t 0 and isn’t in use by your system at present such as <code class="docutils literal notranslate"><span class="pre">8080</span></code>.</p>
</li>
<li><p class="first">Copy the snippet of Python code that looks like this:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydevd_pycharm</span>
<span class="n">pydevd_pycharm</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">stdoutToServer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stderrToServer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Paste this code where you want to start debugging from, this will act like a breakpoint during normal debugging.</p>
</li>
<li><p class="first">Click the drop down menu next to the play icon in the top right. Select the <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Debug</span> <span class="pre">Server</span></code> you configured, then click the debug next to the play icon.</p>
</li>
<li><p class="first">Run the python code that you want to debug, for example run the system tests, and it will pause execution on where you pasted your remote debug code earlier.</p>
</li>
<li><p class="first">Any new breakpoints can be added like normal but they must come after the remote code snippet pasted earlier.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="legacy-and-not-maintained-past-this-point-only-use-if-explicitly-not-using-conda">
<h1>Legacy and not maintained past this point (Only use if explicitly not using Conda)<a class="headerlink" href="#legacy-and-not-maintained-past-this-point-only-use-if-explicitly-not-using-conda" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-pycharm-on-windows">
<h2>Setting up PyCharm on Windows<a class="headerlink" href="#setting-up-pycharm-on-windows" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Once PyCharm is open, set up the project. Go to <code class="docutils literal notranslate"><span class="pre">File-&gt;Open</span></code> and select the root directory in which both your source and build directories reside.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">File-&gt;Settings</span></code>, then under <code class="docutils literal notranslate"><span class="pre">Project</span></code> you will set two sub-menus <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Interpreter</span></code> and <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Structure</span></code>. The interpreter defines the Python executable that will be used to run your code, and the structure menu allows you to decide which folders within the project to include and index.</p>
</li>
<li><p class="first">In the <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Interpreter</span></code> sub menu, at the top select the options button and click <code class="docutils literal notranslate"><span class="pre">Add...</span></code>, a new window should appear titled “Add Python Interpreter”. In the menu on the left, if you are using Conda select “Conda Environment”, if you haven’t set up Conda follow the Getting Started guidance for it, select existing environment and if not present already put in the path to your Python interpreter, and your conda executable. Alternatively select “System Interpreter” (a version of Python with all the correct variables set already exists within Mantid, if you are not using Conda). Click on the <code class="docutils literal notranslate"><span class="pre">...</span></code> to open a file browser, and navigate to;</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;Mantid Source Directory&gt;/external/src/ThirdParty/lib/Python3.8/Python.exe
</pre></div>
</div>
<p>This is the interpreter, so select “Ok” and apply the changes. This should bring up a list of all the packages associated to the interpreter. There should be many packages, however you should not see PyQt (but instead QtPy).</p>
</li>
<li><p class="first">In the <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Structure</span></code> sub menu you should see your root directory with the source/build directories both visible (if not, add them). The folder structure should be present in the centre of the window allowing you to mark folders orange (excluded) or blue (source). Source directories will be searched for Python code.</p>
<p>Within the source directory add the following to your sources:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;Mantid Source Directory&gt;/scripts
&lt;Mantid Source Directory&gt;/Framework/PythonInterface
&lt;Mantid Source Directory&gt;/qt/applications/workbench
&lt;Mantid Source Directory&gt;/qt/widgets
&lt;Mantid Source Directory&gt;/qt/Python
&lt;Mantid Source Directory&gt;/external/src/ThirdParty/lib
</pre></div>
</div>
<p>If you are writing scripts in any other directories, you can also mark them as sources. This helps PyCharm give better auto-complete and import suggestions during development.</p>
<p>Additionally, in the Mantid build directory add the following as source folders:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;Mantid Build Directory&gt;/bin/Debug
</pre></div>
</div>
<p>here we are setting up PyCharm for the Debug build, you would use <code class="docutils literal notranslate"><span class="pre">/bin/Release</span></code> instead if you are building mantid in release mode.</p>
</li>
<li><p class="first">The environment needs to be set up before running the configuration. Follow the instructions below to use either the EnvFile plugin (recommended) or manual path setup.</p>
</li>
</ol>
<p>NOTE : In some cases, imports in the code will still be highlighted red when they come from folders within the <code class="docutils literal notranslate"><span class="pre">script/</span></code> folder, or from other folders entirely. To fix this simply add the relevant folder that contains the module you are importing in the same fashion as step 3 above.</p>
</div>
<div class="section" id="running-files-in-the-debugger-with-envfile-extension">
<span id="pycharm-debugging-env-file"></span><h2>Running Files in the Debugger with EnvFile extension<a class="headerlink" href="#running-files-in-the-debugger-with-envfile-extension" title="Permalink to this headline">¶</a></h2>
<p>Do not run files in the debugger with EnvFile extension with Conda, as Conda does this job for you.</p>
<p>Running Python code from within PyCharm which depends on the Python API, or PyQt for example requires one extra step. Because the source root labelling from the previous section only affects PyCharm searching and not the run configuration, before running the file we must set up the run configuration correctly.</p>
<ol class="arabic simple" start="4">
<li>Install the EnvFile plugin by Borys Pierov. The plugin can be installed in multiple ways:<ol class="loweralpha">
<li>Open Settings(CTRL + SHIFT + S), to go Plugins and search for <code class="docutils literal notranslate"><span class="pre">EnvFile</span></code>. Install and restart PyCharm.</li>
<li>Go to the plugin’s <a class="reference external" href="https://plugins.jetbrains.com/plugin/7861-envfile">webpage</a>, download and install it.</li>
</ol>
</li>
<li>To edit the configurations go to Run-&gt;Run… and select Edit Configurations. Notice that there is now a <code class="docutils literal notranslate"><span class="pre">EnvFile</span></code> tab under the configuration’s name.
- Note that you have to do that for each configuration, or you can change the template configuration, and all configuration that use that template will have the EnvFile setup.</li>
<li>Open the <code class="docutils literal notranslate"><span class="pre">EnvFile</span></code> tab, check <code class="docutils literal notranslate"><span class="pre">Enable</span> <span class="pre">EnvFile</span></code> and <code class="docutils literal notranslate"><span class="pre">Substitute</span> <span class="pre">Environmental</span> <span class="pre">Variables</span> <span class="pre">(...)</span></code> - this allows setting up the third-party paths dynamically.</li>
<li>Click the <code class="docutils literal notranslate"><span class="pre">+</span></code> (plus) on the right side, select the <code class="docutils literal notranslate"><span class="pre">pycharm.env</span></code> file in the root of the <strong>build</strong> directory.</li>
</ol>
<p>For running the Workbench continue onto <a class="reference external" href="https://docs.mantidproject.org/nightly/workbench/index.html#workbench" title="(in MantidProject v6.1)"><span>Workbench</span></a>, and follow the instructions to set up the <em>Script Path</em> and <em>Working Directory</em>.</p>
<p>Advantages of this approach:</p>
<ul class="simple">
<li>You can have multiple instances of PyCharm running with environment configuration for separate repositories. This is otherwise not possible, as all PyCharm instances seem to share a parent process and environment. (as is the case of 11/01/2019, it might change in the future)</li>
<li>This makes possible switching projects for multiple repositories via the File &gt; Open Recent … menu, as when the new project is opened its environment won’t be poluted with environment variables from the last one.<ul>
<li>This can cause errors when the external dependencies aren’t quite the same between all the repositories, as some packages might be missing, or be different versions.</li>
</ul>
</li>
</ul>
<p>Disadvantages:</p>
<ul class="simple">
<li>Additional setup for each configuration necessary. Thankfully, if the template is edited to have the correct <code class="docutils literal notranslate"><span class="pre">EnvFile</span></code> setup, all copies of it will have it too. Copying an already existing configuration also copies the <code class="docutils literal notranslate"><span class="pre">EnvFile</span></code> setup.</li>
</ul>
</div>
<div class="section" id="running-files-in-the-debugger-without-envfile-extension">
<h2>Running Files in the Debugger without EnvFile extension<a class="headerlink" href="#running-files-in-the-debugger-without-envfile-extension" title="Permalink to this headline">¶</a></h2>
<p>This can be done in two ways:</p>
<ul>
<li><p class="first">Open PyCharm using <code class="docutils literal notranslate"><span class="pre">pycharm.bat</span></code> which can be found in the build directory (this sets some additional environment variables compared with simply opening PyCharm directly).</p>
<ul class="simple">
<li>This is preferred if you only have 1 repository with which PyCharm is used. If you need to use PyCharm on multiple repositories, it is recommended that you use the EnvFile extension.</li>
</ul>
</li>
<li><p class="first">To edit the configurations go to <code class="docutils literal notranslate"><span class="pre">Run-&gt;Run...</span></code> and select <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">Configurations</span></code>. This should open up a sub window. Hit the green <code class="docutils literal notranslate"><span class="pre">+</span></code> in the top left to create a new configuration and name it. In order to tell PyCharm where to look for Python modules and libraries we need to add some folders to the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable. Click on the <code class="docutils literal notranslate"><span class="pre">...</span></code> next to the <em>Environment Variables</em> box, and hit the <code class="docutils literal notranslate"><span class="pre">+</span></code> icon. In the Name column enter “PATH”, in the value column enter the following;</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;Mantid Build Directory&gt;<span class="se">\b</span>in<span class="se">\D</span>ebug<span class="p">;</span>
&lt;Mantid Source Directory&gt;<span class="se">\e</span>xternal<span class="se">\s</span>rc<span class="se">\T</span>hirdParty<span class="se">\b</span>in<span class="p">;</span>
&lt;Mantid Source Directory&gt;<span class="se">\e</span>xternal<span class="se">\s</span>rc<span class="se">\T</span>hirdParty<span class="se">\b</span>in<span class="se">\m</span>ingw<span class="p">;</span>
&lt;Mantid Source Directory&gt;<span class="se">\e</span>xternal<span class="se">\s</span>rc<span class="se">\T</span>hirdParty<span class="se">\l</span>ib<span class="se">\P</span>ython3.8<span class="p">;</span>
&lt;Mantid Source Directory&gt;<span class="se">\e</span>xternal<span class="se">\s</span>rc<span class="se">\T</span>hirdParty<span class="se">\l</span>ib<span class="se">\q</span>t5<span class="se">\p</span>lugins<span class="p">;</span>
&lt;Mantid Source Directory&gt;<span class="se">\e</span>xternal<span class="se">\s</span>rc<span class="se">\T</span>hirdParty<span class="se">\l</span>ib<span class="se">\q</span>t5<span class="se">\b</span>in<span class="p">;</span>
&lt;Mantid Source Directory&gt;<span class="se">\e</span>xternal<span class="se">\s</span>rc<span class="se">\T</span>hirdParty<span class="se">\l</span>ib<span class="se">\q</span>t5<span class="se">\l</span>ib<span class="p">;</span>
%PATH%
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>The semi-colon delimited list of paths should end in <code class="docutils literal notranslate"><span class="pre">;%PATH%</span></code> so that we prepend to the existing list of paths rather than overwriting them.</p>
<p>You should now be able to run and debug the scripts using the newly created configuration, by adding the full path of the file in the <code class="docutils literal notranslate"><span class="pre">Script</span> <span class="pre">path</span></code> box at the top of the configuration window.</p>
<p>As an example, create a new file in <code class="docutils literal notranslate"><span class="pre">&lt;Mantid</span> <span class="pre">Source</span> <span class="pre">Directory&gt;/scripts/</span></code> called <code class="docutils literal notranslate"><span class="pre">test.py</span></code>. Copy into it the Python code below.</p>
</div>
<div class="section" id="testing-using-pyqt">
<h2>Testing using PyQt<a class="headerlink" href="#testing-using-pyqt" title="Permalink to this headline">¶</a></h2>
<p>To test that the above instructions have worked, you can simply create a new Python file with the following content (for PyQt5)</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check that PyQt imports</span>
<span class="kn">from</span> <span class="nn">qtpy</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="c1"># Check that the Mantid Python API imports</span>
<span class="kn">import</span> <span class="nn">mantid.simpleapi</span>

<span class="k">class</span> <span class="nc">DummyView</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DummyView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">ui</span> <span class="o">=</span> <span class="n">DummyView</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="local-debugging-of-unit-tests-with-pycharm">
<h2>Local Debugging of Unit Tests with PyCharm<a class="headerlink" href="#local-debugging-of-unit-tests-with-pycharm" title="Permalink to this headline">¶</a></h2>
<p>This <strong>does not</strong> require a PyCharm Professional license for debugging, but requires additional setup for running unit tests.</p>
<ol class="arabic simple">
<li>Go to your Run/Debug Configurations.</li>
<li>Open Templates &gt; Python tests &gt; Unittests configuration.</li>
<li>Set the working directory to <code class="docutils literal notranslate"><span class="pre">&lt;Mantid</span> <span class="pre">Build</span> <span class="pre">Dir&gt;/bin/Debug</span></code>, for a Debug build, or <code class="docutils literal notranslate"><span class="pre">&lt;Mantid</span> <span class="pre">Build</span> <span class="pre">Dir&gt;/bin/Release</span></code> for a Release build.</li>
<li>Add the EnvFile to the Unittests configuration, instructions in <a class="reference internal" href="#pycharm-debugging-env-file"><span class="std std-ref">Running Files in the Debugger with EnvFile extension</span></a>.</li>
<li>You should now be able to click the Run/Debug icons next to each unit test method or class to run/debug them.</li>
</ol>
</div>
<div class="section" id="setting-up-pycharm-on-linux">
<h2>Setting up PyCharm on Linux<a class="headerlink" href="#setting-up-pycharm-on-linux" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Use the native Python interpreter (<code class="docutils literal notranslate"><span class="pre">/usr/bin/Python3</span></code>) rather than from <code class="docutils literal notranslate"><span class="pre">&lt;Mantid</span> <span class="pre">Source</span> <span class="pre">Directory&gt;/external/src/ThirdParty/lib/Python3.8/Python.exe</span></code></p>
</li>
<li><p class="first">In the <code class="docutils literal notranslate"><span class="pre">Project</span> <span class="pre">Structure</span></code> sub menu you should see your root directory with the source/build directories both visible (if not, add them). The folder structure should be present in the centre of the window allowing you to mark folders orange (excluded) or blue (source). Source directories will be searched for Python code.</p>
<p>Within the source directory add the following to your sources:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;Mantid Source Directory&gt;/scripts
&lt;Mantid Source Directory&gt;/Framework/PythonInterface
&lt;Mantid Source Directory&gt;/qt/applications/workbench
&lt;Mantid Source Directory&gt;/qt/widgets
&lt;Mantid Source Directory&gt;/qt/Python
</pre></div>
</div>
<p>If you are writing scripts in any other directories, you can also mark them as sources. This helps PyCharm give better auto-complete and import suggestions during development.</p>
<p>Additionally, in the Mantid build directory add the following as source folders:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>&lt;Mantid Build Directory&gt;/bin/
</pre></div>
</div>
<p>It is recommended that you add the whole build folder to <code class="docutils literal notranslate"><span class="pre">excluded</span></code>. This will not interfere with the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory, inside the build, being used as a source folder. It will just limit the scope that PyCharm searches for files, classes, etc.</p>
</li>
<li><p class="first">Go to Run-&gt;Run… and select Edit Configurations. Go to Templates &gt; Python. Make <code class="docutils literal notranslate"><span class="pre">&lt;Mantid</span> <span class="pre">Build</span> <span class="pre">Directory&gt;/bin;</span></code> the <code class="docutils literal notranslate"><span class="pre">Working</span> <span class="pre">Directory</span></code>. This will then be used for all Python configurations you make.</p>
</li>
</ol>
</div>
<div class="section" id="useful-plugins">
<h2>Useful Plugins<a class="headerlink" href="#useful-plugins" title="Permalink to this headline">¶</a></h2>
<p>You can install non-default plugins by pressing <code class="docutils literal notranslate"><span class="pre">Ctrl+Alt+S</span></code> to open the <strong>Settings/Preferences</strong> dialog and then going to <strong>Plugins</strong>.
From here you can manage plugins, or add new ones by clicking <strong>Browse repositories</strong>.</p>
<p>The following non-default plugins are things our team has found useful for Mantid development:</p>
<ul class="simple">
<li><strong>Markdown support</strong> - Side by side rendering of markdown documents such as``.md`` , <code class="docutils literal notranslate"><span class="pre">.rst</span></code> (requires <a class="reference external" href="https://graphviz.gitlab.io/download/">Graphviz</a> to show graphs in preview)</li>
<li><strong>dotplugin</strong> -  Syntax highlighting for <code class="docutils literal notranslate"><span class="pre">DOT</span></code></li>
<li><strong>BashSupport</strong> - Syntax highlighting for <code class="docutils literal notranslate"><span class="pre">BASH</span></code> scripts</li>
<li><strong>CMD Support</strong> - Syntax highlighting for <code class="docutils literal notranslate"><span class="pre">.BAT</span></code> ~scripts</li>
</ul>
<p>Please add to this list if you find a useful plugin of your own</p>
</div>
<div class="section" id="remote-development">
<h2>Remote Development<a class="headerlink" href="#remote-development" title="Permalink to this headline">¶</a></h2>
<p>Note: Requires PyCharm Professional.</p>
<p>PyCharm supports deployment and syncronisation of written code to a remote server via SSH.</p>
<p>Open a local copy of the project and then follow the the guides here for <a class="reference external" href="https://www.jetbrains.com/help/pycharm/configuring-remote-interpreters-via-ssh.html">configuring the remote interpreter</a> and <a class="reference external" href="https://www.jetbrains.com/help/pycharm/creating-a-remote-server-configuration.html">creating a deployment configuration</a>.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="VisualStudioBuildImpact.html" title="Previous Chapter: Visual Studio Build Impact"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Visual Studio...</span>
    </a>
  </li>
  <li>
    <a href="VSCode.html" title="Next Chapter: VSCode"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">VSCode &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>