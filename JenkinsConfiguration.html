<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Jenkins Configuration</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.12.20180501.1345',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Release Checklist" href="ReleaseChecklist.html" />
    <link rel="prev" title="The Automated Build Process" href="AutomatedBuildProcess.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body role="document">





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="jenkins-configuration">
<span id="jenkinsconfiguration"></span><h1>Jenkins Configuration<a class="headerlink" href="#jenkins-configuration" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#general-setup" id="id3">General Setup</a></li>
<li><a class="reference internal" href="#setting-up-a-new-slave" id="id4">Setting up a New Slave</a><ul>
<li><a class="reference internal" href="#machine-setup" id="id5">Machine Setup</a></li>
<li><a class="reference internal" href="#windows" id="id6">Windows</a><ul>
<li><a class="reference internal" href="#slave-connection" id="id7">Slave Connection</a></li>
<li><a class="reference internal" href="#connecting-through-a-proxy-server" id="id8">Connecting Through a Proxy Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linux" id="id9">Linux</a><ul>
<li><a class="reference internal" href="#ubuntu" id="id10">Ubuntu</a></li>
<li><a class="reference internal" href="#red-hat" id="id11">Red Hat</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mac-os" id="id12">Mac OS</a></li>
<li><a class="reference internal" href="#linux-mac-connection-notes" id="id13">Linux/Mac Connection Notes</a></li>
<li><a class="reference internal" href="#post-connection-setup-all-systems" id="id14">Post-Connection Setup - All Systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#misc-groovy-scripts" id="id15">Misc Groovy Scripts</a><ul>
<li><a class="reference internal" href="#print-the-value-of-an-environment-variable-on-all-nodes" id="id16">Print the Value of an Environment Variable on All Nodes</a></li>
<li><a class="reference internal" href="#update-paraview-variables-on-nodes" id="id17">Update ParaView variables on nodes</a></li>
<li><a class="reference internal" href="#check-existence-of-paraview-builds" id="id18">Check existence of ParaView builds</a></li>
<li><a class="reference internal" href="#remove-directories-across-multiple-nodes" id="id19">Remove directories across multiple nodes</a><ul>
<li><a class="reference internal" href="#master-incremental" id="id20">Master Incremental</a></li>
<li><a class="reference internal" href="#pull-requests" id="id21">Pull Requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-branches-for-jobs" id="id22">Update Branches For Jobs</a></li>
<li><a class="reference internal" href="#list-all-scm-urls" id="id23">List All SCM Urls</a></li>
<li><a class="reference internal" href="#print-all-loggers" id="id24">Print All Loggers</a></li>
<li><a class="reference internal" href="#run-a-process" id="id25">Run a Process</a></li>
<li><a class="reference internal" href="#update-default-values-for-job-parameters" id="id26">Update default values for job parameters</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Mantid uses the <a class="reference external" href="https://jenkins.io/">Jenkins</a> automation server to
support the continuous integration requirements of Mantid. This document
aims to describe the general setup of the system.</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Jenkins works on a &#8216;master-&gt;slave&#8217; principle. The master node is
responsible for orchestrating jobs and managing the slave nodes, where the
work is actually performed. The master node is located at
<a class="reference external" href="http://builds.mantidproject.org">http://builds.mantidproject.org</a> and each facility is responsible for providing
hardware to act as slaves for the various required configurations.</p>
</div>
<div class="section" id="general-setup">
<h2><a class="toc-backref" href="#id3">General Setup</a><a class="headerlink" href="#general-setup" title="Permalink to this headline">¶</a></h2>
<p>The master node is set to a fixed TCP port for JNLP slave agents under
<a class="reference external" href="http://builds.mantidproject.org/configureSecurity">http://builds.mantidproject.org/configureSecurity</a>.</p>
<p>The anonymous jenkins user has the following rights: Overall Read,
Slave Connect, Job Read, View Read.</p>
</div>
<div class="section" id="setting-up-a-new-slave">
<h2><a class="toc-backref" href="#id4">Setting up a New Slave</a><a class="headerlink" href="#setting-up-a-new-slave" title="Permalink to this headline">¶</a></h2>
<div class="section" id="machine-setup">
<h3><a class="toc-backref" href="#id5">Machine Setup</a><a class="headerlink" href="#machine-setup" title="Permalink to this headline">¶</a></h3>
<p>Set up a local <code class="docutils literal"><span class="pre">builder</span></code> account that will be used by the slave.</p>
<p>Install the <a class="reference internal" href="GettingStarted.html#gettingstarted"><span class="std std-ref">required prerequisites</span></a> for the relevant OS.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Windows the <a class="reference external" href="http://landinghub.visualstudio.com/visual-cpp-build-tools">Command line Visual C++ build tools</a>
may be used in place of a full Visual Studio install from version 2017 onwards (the 2015 tools contain a broken <cite>vcvarsall.bat</cite>).</p>
</div>
</div>
<div class="section" id="windows">
<h3><a class="toc-backref" href="#id6">Windows</a><a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Ensure that the location of <code class="docutils literal"><span class="pre">msbuild.exe</span></code> (<code class="docutils literal"><span class="pre">C:\Windows\Microsoft.NET\Framework64\v4.0.30319</span></code>) is on the <code class="docutils literal"><span class="pre">PATH</span></code></li>
</ul>
<div class="section" id="slave-connection">
<h4><a class="toc-backref" href="#id7">Slave Connection</a><a class="headerlink" href="#slave-connection" title="Permalink to this headline">¶</a></h4>
<p>There are following additional steps required to be able to connect a
Windows slave using JNLP as a Windows service :</p>
<ol class="arabic simple">
<li>Setup the slave on the master node using &#8220;New Node&#8221; under
<a class="reference external" href="http://builds.mantidproject.org/computer/">http://builds.mantidproject.org/computer/</a>. If &#8220;New Node&#8221; is not visible
then you do not have the required permissions - ask an admin for help. It is
recommended that you copy from an existing node of a similar type.</li>
<li>Once configured on the master, remote desktop to the slave, open a browser and connect to the webpage of the
slave, .e.g. <a class="reference external" href="http://builds.mantidproject.org/computer/ornl-pc73896/">http://builds.mantidproject.org/computer/ornl-pc73896/</a></li>
<li>Click on the <strong>connect</strong> button to launch the JNLP client.</li>
<li>Once the client is launched, you can select &#8220;Install as Windows
Service&#8221; from the clients menu. If you have a proxy then see the
section below for further configuration steps.</li>
<li>Once installed change the recovery behaviour for
the service. Do this by right-clicking on the Jenkins
service-&gt;Properties-&gt;Recovery. Change the first, second, subsequent
failures to restart the service.</li>
<li>Change the account that the service uses to log on by right-clicking
on the Jenkins service-&gt;Properties-&gt;Log On and enter the details in
the builder account</li>
<li>Change the &#8220;Startup type:&#8221; of the service to be &#8220;Automatic (Delayed Start)&#8221;</li>
<li>Ensure the msbuild directory is on the <code class="docutils literal"><span class="pre">PATH</span></code></li>
<li>Finally reboot the slave (this is the easiest way for the Jenkins to
start trying to reconnect to it)</li>
</ol>
<p>Note that changes to <code class="docutils literal"><span class="pre">PATH</span></code> require restarting the Jenkins service in
order to be reflected in the build environment.</p>
</div>
<div class="section" id="connecting-through-a-proxy-server">
<h4><a class="toc-backref" href="#id8">Connecting Through a Proxy Server</a><a class="headerlink" href="#connecting-through-a-proxy-server" title="Permalink to this headline">¶</a></h4>
<p>It is a little more tricky to windows slaves connected through a
proxy.To do this you must modify the java arguments that are used to
start the <code class="docutils literal"><span class="pre">jenkins-slave</span></code> process. Once the &#8220;Install as a Windows
Service&#8221; has completed you should</p>
<ol class="arabic simple">
<li>Find a directory on the machine such as <code class="docutils literal"><span class="pre">C:\Jenkins`</span></code> or whatever
was configured in the slave config.</li>
<li>Open the <code class="docutils literal"><span class="pre">jenkins-slave.xml</span></code> file</li>
<li>Edit the tag and add <code class="docutils literal"><span class="pre">-Dhttp.proxyHost=PROXYHOST</span></code>
<code class="docutils literal"><span class="pre">-Dhttp.proxyPort=PROXYPORT</span></code> to the list</li>
<li>Save the file and restart the service (or machine)</li>
</ol>
</div>
</div>
<div class="section" id="linux">
<h3><a class="toc-backref" href="#id9">Linux</a><a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<p>Install an ssh server.</p>
<p>Install <code class="docutils literal"><span class="pre">ccache</span></code>. After installing run <code class="docutils literal"><span class="pre">ccache</span> <span class="pre">--max-size=20G</span></code> from the <code class="docutils literal"><span class="pre">builder</span></code> account.</p>
<p>Install a vnc server and from the <code class="docutils literal"><span class="pre">builder</span></code> account run <code class="docutils literal"><span class="pre">vncpasswd</span></code> to set a password on the VNC server. It
can be any password.</p>
<p>Ensure <code class="docutils literal"><span class="pre">curl</span></code> is installed</p>
<p>Any machines acting as performance test servers will require <code class="docutils literal"><span class="pre">mysqldb</span></code> to be installed.</p>
<div class="section" id="ubuntu">
<h4><a class="toc-backref" href="#id10">Ubuntu</a><a class="headerlink" href="#ubuntu" title="Permalink to this headline">¶</a></h4>
<p>Configure <a class="reference external" href="https://help.ubuntu.com/community/AutomaticSecurityUpdates">automatic security updates</a>.</p>
<p>Install <code class="docutils literal"><span class="pre">gdebi-core</span></code> package to allow installing <code class="docutils literal"><span class="pre">.deb</span></code> files.</p>
<p>The <code class="docutils literal"><span class="pre">builder</span></code> account must be setup to be able to run <code class="docutils literal"><span class="pre">gdebi</span></code> non-interactively. Use <code class="docutils literal"><span class="pre">visudo</span></code> to add the following
exception got <code class="docutils literal"><span class="pre">builder</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># Allow no password for gdebi
builder       ALL=(ALL)NOPASSWD:/usr/bin/gdebi, /usr/bin/dpkg
## Disable tty requirement for gdebi and dpkg command
Defaults!/usr/bin/gdebi !requiretty
Defaults!/usr/bin/dpkg  !requiretty
</pre></div>
</div>
</div>
<div class="section" id="red-hat">
<h4><a class="toc-backref" href="#id11">Red Hat</a><a class="headerlink" href="#red-hat" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">builder</span></code> account must be setup to be able to run <code class="docutils literal"><span class="pre">yum</span></code> non-interactively. Use <code class="docutils literal"><span class="pre">visudo</span></code> to add the following
exception got <code class="docutils literal"><span class="pre">builder</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>## Allow no password for yum
builder       ALL = NOPASSWD: /usr/bin/yum,/bin/rpm
## Disable tty requirement for yum command
Defaults!/bin/rpm       !requiretty
Defaults!/usr/bin/yum       !requiretty
</pre></div>
</div>
</div>
</div>
<div class="section" id="mac-os">
<h3><a class="toc-backref" href="#id12">Mac OS</a><a class="headerlink" href="#mac-os" title="Permalink to this headline">¶</a></h3>
<p>Enable <a class="reference external" href="https://apple.stackexchange.com/a/73919">SSH (&#8220;Remote Login&#8221;) and VNC (&#8220;Remote Management&#8221;)</a>.  If you have
connection issues from a non-OS X client then try adjusting your color depth settings (True Color 32bpp works on Remmina).</p>
<p>Install <code class="docutils literal"><span class="pre">cppcheck</span></code> from brew.</p>
<p>The <code class="docutils literal"><span class="pre">builder</span></code> account must be setup to be able to run <code class="docutils literal"><span class="pre">gdebi</span></code> non-interactively. Use <code class="docutils literal"><span class="pre">visudo</span></code> to add the following
exception got <code class="docutils literal"><span class="pre">builder</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># Allow builder to install packages without a password
builder  ALL=(ALL)NOPASSWD:/usr/sbin/installer, /bin/rm
# Disable tty requirement
Defaults!/usr/sbin/installer    !requiretty
Defaults!/bin/rm        !requiretty
</pre></div>
</div>
<p>In order to run the MantidPlot tests, which require a connection to the windowing system, the user that is running the jenkins slave must
have logged in. This is most easily done by VNC - connect, log in,
then disconnect. If you see errors such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">_RegisterApplication</span><span class="p">(),</span> <span class="n">FAILED</span> <span class="n">TO</span> <span class="n">establish</span> <span class="n">the</span> <span class="n">default</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">the</span> <span class="n">WindowServer</span><span class="p">,</span>
<span class="n">_CGSDefaultConnection</span><span class="p">()</span> <span class="ow">is</span> <span class="n">NULL</span><span class="o">.</span>
</pre></div>
</div>
<p>then no one is logged in to the system.</p>
</div>
<div class="section" id="linux-mac-connection-notes">
<h3><a class="toc-backref" href="#id13">Linux/Mac Connection Notes</a><a class="headerlink" href="#linux-mac-connection-notes" title="Permalink to this headline">¶</a></h3>
<p>The jenkins JNLP connections are maintained by a crontab entry. The
script is in the <a class="reference external" href="https://github.com/mantidproject/mantid/blob/master/buildconfig/Jenkins/jenkins-slave.sh">mantid repository</a>.</p>
<p>The comments at the top describe a typical crontab entry for the script. This needs to be manually set for each slave. Ensure the script is
marked executable after downloading it. Also ensure the entry in the crontab
has the correct <code class="docutils literal"><span class="pre">PATH</span></code> setting (by default cron uses a reduced <code class="docutils literal"><span class="pre">PATH</span></code> entry). On macOS <code class="docutils literal"><span class="pre">latex</span></code> and <code class="docutils literal"><span class="pre">sysctl</span></code>
should be available.</p>
</div>
<div class="section" id="post-connection-setup-all-systems">
<h3><a class="toc-backref" href="#id14">Post-Connection Setup - All Systems</a><a class="headerlink" href="#post-connection-setup-all-systems" title="Permalink to this headline">¶</a></h3>
<p>Ensure the new machine is added to the relevant <a class="reference external" href="http://builds.mantidproject.org/view/ParaView/">ParaView build job</a> and build
ParaView. Set the <code class="docutils literal"><span class="pre">PARAVIEW_DIR</span></code> &amp; <code class="docutils literal"><span class="pre">PARAVIEW_NEXT_DIR</span></code> variables
(it&#8217;s easiest to just look at the configuration for one of the other
nodes of a similar type.</p>
</div>
</div>
<div class="section" id="misc-groovy-scripts">
<h2><a class="toc-backref" href="#id15">Misc Groovy Scripts</a><a class="headerlink" href="#misc-groovy-scripts" title="Permalink to this headline">¶</a></h2>
<p>The following is a collection of groovy scripts that can be run either
at <a class="reference external" href="http://builds.mantidproject.org/script">http://builds.mantidproject.org/script</a> (for master node) or on a
given node, e.g <a class="reference external" href="http://builds.mantidproject.org/computer/isis-mantidlx3/script">isis-mantidx3</a>.
You must have admin privileges to run them.</p>
<p><a class="reference external" href="https://github.com/jenkinsci/jenkins-scripts/tree/master/scriptler">https://github.com/jenkinsci/jenkins-scripts/tree/master/scriptler</a> was helpful for coming up with some of these.</p>
<div class="section" id="print-the-value-of-an-environment-variable-on-all-nodes">
<h3><a class="toc-backref" href="#id16">Print the Value of an Environment Variable on All Nodes</a><a class="headerlink" href="#print-the-value-of-an-environment-variable-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jenkins.model.*</span>
<span class="kn">import</span> <span class="nn">hudson.model.*</span>
<span class="kn">import</span> <span class="nn">hudson.slaves.*</span>

<span class="n">VARIABLE_NAME</span> <span class="o">=</span> <span class="s2">&quot;PARAVIEW_DIR&quot;</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">getNodes</span><span class="o">()</span>
<span class="n">println</span><span class="o">(</span><span class="s2">&quot;Displaying values of &quot;</span> <span class="o">+</span> <span class="n">VARIABLE_NAME</span> <span class="o">+</span> <span class="s2">&quot; on all nodes&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">()</span>
<span class="k">for</span><span class="o">(</span><span class="n">node</span> <span class="k">in</span> <span class="n">nodes</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">node_props</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">nodeProperties</span><span class="o">.</span><span class="na">getAll</span><span class="o">(</span><span class="n">hudson</span><span class="o">.</span><span class="na">slaves</span><span class="o">.</span><span class="na">EnvironmentVariablesNodeProperty</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="k">if</span><span class="o">(</span><span class="n">node_props</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">env_vars</span> <span class="o">=</span> <span class="n">node_props</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">getEnvVars</span><span class="o">()</span>
  <span class="k">if</span><span class="o">(</span><span class="n">env_vars</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">VARIABLE_NAME</span><span class="o">))</span> <span class="o">{</span>
  <span class="n">pv_dir</span> <span class="o">=</span> <span class="n">env_vars</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">VARIABLE_NAME</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">pv_dir</span> <span class="o">=</span> <span class="n">VARIABLE_NAME</span> <span class="o">+</span> <span class="s2">&quot; not set.&quot;</span>
  <span class="o">}</span>
  <span class="n">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">pv_dir</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">pv_dir</span> <span class="o">=</span> <span class="n">VARIABLE_NAME</span> <span class="o">+</span> <span class="s2">&quot; not set.&quot;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="update-paraview-variables-on-nodes">
<h3><a class="toc-backref" href="#id17">Update ParaView variables on nodes</a><a class="headerlink" href="#update-paraview-variables-on-nodes" title="Permalink to this headline">¶</a></h3>
<p><strong>After running this script the variables look like they are updated but
are in fact cached on the slaves so the new values don&#8217;t take effect
without disconnecting and forcing each slave to reconnect</strong></p>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jenkins.model.*</span>
<span class="kn">import</span> <span class="nn">hudson.model.*</span>
<span class="kn">import</span> <span class="nn">hudson.slaves.*</span>

<span class="n">VARIABLE_NAME</span> <span class="o">=</span> <span class="s2">&quot;PARAVIEW_NEXT_DIR&quot;</span>
<span class="n">VERSION</span> <span class="o">=</span> <span class="s2">&quot;ParaView-5.1.2&quot;</span>

<span class="n">jenkins</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="o">.</span><span class="na">instance</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">jenkins</span><span class="o">.</span><span class="na">getNodes</span><span class="o">()</span>
<span class="n">println</span><span class="o">(</span><span class="s2">&quot;Displaying values of &quot;</span> <span class="o">+</span> <span class="n">VARIABLE_NAME</span> <span class="o">+</span> <span class="s2">&quot; on all nodes&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">()</span>
<span class="k">for</span><span class="o">(</span><span class="n">node</span> <span class="k">in</span> <span class="n">nodes</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">node_props</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">nodeProperties</span><span class="o">.</span><span class="na">getAll</span><span class="o">(</span><span class="n">hudson</span><span class="o">.</span><span class="na">slaves</span><span class="o">.</span><span class="na">EnvironmentVariablesNodeProperty</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="k">if</span><span class="o">(</span><span class="n">node_props</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">env_vars</span> <span class="o">=</span> <span class="n">node_props</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">getEnvVars</span><span class="o">()</span>
  <span class="k">if</span><span class="o">(</span><span class="n">env_vars</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">VARIABLE_NAME</span><span class="o">))</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">pv_dir</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">createPath</span><span class="o">(</span><span class="n">env_vars</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">VARIABLE_NAME</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">));</span>
    <span class="k">if</span><span class="o">(</span><span class="n">pv_dir</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">def</span> <span class="n">pv_build_dir</span> <span class="o">=</span> <span class="n">pv_dir</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>
      <span class="kt">def</span> <span class="n">pv_dir_new</span> <span class="o">=</span> <span class="n">pv_build_dir</span><span class="o">.</span><span class="na">child</span><span class="o">(</span><span class="n">VERSION</span><span class="o">);</span>
      <span class="n">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot;: Updating $VARIABLE_NAME from &#39;&quot;</span> <span class="o">+</span> <span class="n">pv_dir</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot;&#39; to &#39;&quot;</span> <span class="o">+</span> <span class="n">pv_dir_new</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">);</span>
      <span class="n">env_vars</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">VARIABLE_NAME</span><span class="o">,</span> <span class="n">pv_dir_new</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot; has variable set but &quot;</span> <span class="o">+</span> <span class="n">env_vars</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">VARIABLE_NAME</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="o">+</span> <span class="s2">&quot; does not exist&quot;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot;: $VARIABLE_NAME &quot;</span> <span class="o">+</span>  <span class="s2">&quot;not set.&quot;</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot;: $VARIABLE_NAME &quot;</span> <span class="o">+</span>  <span class="s2">&quot;not set.&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="n">jenkins</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</pre></div>
</div>
</div>
<div class="section" id="check-existence-of-paraview-builds">
<h3><a class="toc-backref" href="#id18">Check existence of ParaView builds</a><a class="headerlink" href="#check-existence-of-paraview-builds" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hudson.model.*</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">slaves</span>

<span class="n">PV_VERSION</span> <span class="o">=</span> <span class="s2">&quot;5.1.2&quot;</span>

<span class="k">for</span> <span class="o">(</span><span class="n">node</span> <span class="k">in</span> <span class="n">nodes</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">FilePath</span> <span class="n">root</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getRootPath</span><span class="o">();</span>
  <span class="k">if</span><span class="o">(</span><span class="n">root</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FilePath</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>
    <span class="c1">// assume this is $HOME on osx/linux &amp; drive: on Windows</span>
    <span class="k">if</span><span class="o">(</span><span class="n">fp</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">&quot;C:&quot;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="na">child</span><span class="o">(</span><span class="s2">&quot;Builds&quot;</span><span class="o">)</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="na">child</span><span class="o">(</span><span class="s2">&quot;build&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="na">child</span><span class="o">(</span><span class="s2">&quot;ParaView-$PV_VERSION&quot;</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(!</span><span class="n">fp</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getDisplayName</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot; does not have PV 5.1.2&quot;</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-directories-across-multiple-nodes">
<h3><a class="toc-backref" href="#id19">Remove directories across multiple nodes</a><a class="headerlink" href="#remove-directories-across-multiple-nodes" title="Permalink to this headline">¶</a></h3>
<p>It is advised to ensure nothing is running and pause the build queue.</p>
<div class="section" id="master-incremental">
<h4><a class="toc-backref" href="#id20">Master Incremental</a><a class="headerlink" href="#master-incremental" title="Permalink to this headline">¶</a></h4>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hudson.model.*</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">slaves</span>

<span class="n">JOBNAME</span> <span class="o">=</span> <span class="s2">&quot;master_incremental&quot;</span>


<span class="k">for</span> <span class="o">(</span><span class="n">node</span> <span class="k">in</span> <span class="n">nodes</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;osx-10.10-build&quot;</span><span class="o">,</span> <span class="s2">&quot;rhel6-build&quot;</span><span class="o">,</span> <span class="s2">&quot;rhel7-build&quot;</span><span class="o">,</span> <span class="s2">&quot;ubuntu-14.04-build&quot;</span><span class="o">,</span> <span class="s2">&quot;ubuntu-16.04-build&quot;</span><span class="o">,</span> <span class="s2">&quot;win7&quot;</span><span class="o">];</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">nodeLabel</span> <span class="k">in</span> <span class="n">labels</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FilePath</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">createPath</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getRootPath</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">&quot;workspace&quot;</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">JOBNAME</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">&quot;label&quot;</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">nodeLabel</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">&quot;build&quot;</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">fp</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">fp</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="n">fp</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
      <span class="n">fp</span><span class="o">.</span><span class="na">deleteRecursive</span><span class="o">()</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pull-requests">
<h4><a class="toc-backref" href="#id21">Pull Requests</a><a class="headerlink" href="#pull-requests" title="Permalink to this headline">¶</a></h4>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hudson.model.*</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">slaves</span>

<span class="n">JOB_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;pull_requests-&quot;</span>
<span class="n">suffixes</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;win7&quot;</span><span class="o">,</span> <span class="s2">&quot;osx&quot;</span><span class="o">,</span> <span class="s2">&quot;ubuntu&quot;</span><span class="o">,</span> <span class="s2">&quot;ubuntu-python3&quot;</span><span class="o">,</span> <span class="s2">&quot;rhel7&quot;</span><span class="o">];</span>

<span class="k">for</span> <span class="o">(</span><span class="n">node</span> <span class="k">in</span> <span class="n">nodes</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">suffix</span> <span class="k">in</span> <span class="n">suffixes</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">FilePath</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">createPath</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getRootPath</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s2">&quot;workspace&quot;</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">JOB_PREFIX</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span>  <span class="s2">&quot;build&quot;</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">fp</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">fp</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="n">fp</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
      <span class="n">fp</span><span class="o">.</span><span class="na">deleteRecursive</span><span class="o">()</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-branches-for-jobs">
<h3><a class="toc-backref" href="#id22">Update Branches For Jobs</a><a class="headerlink" href="#update-branches-for-jobs" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hudson.plugins.git.GitSCM</span>
<span class="kn">import</span> <span class="nn">hudson.plugins.git.BranchSpec</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">collect</span><span class="o">.</span><span class="na">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">;</span>

<span class="kt">def</span> <span class="n">NEW_BRANCH</span> <span class="o">=</span> <span class="s2">&quot;*/release-v3.8&quot;</span>

<span class="c1">// Access to the Hudson Singleton</span>
<span class="kt">def</span> <span class="n">jenkins</span> <span class="o">=</span> <span class="n">jenkins</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>

<span class="c1">// Retrieve matching jobs</span>
<span class="kt">def</span> <span class="n">allItems</span> <span class="o">=</span> <span class="n">jenkins</span><span class="o">.</span><span class="na">items</span>
<span class="kt">def</span> <span class="n">chosenJobs</span> <span class="o">=</span> <span class="n">allItems</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span><span class="n">job</span> <span class="o">-&gt;</span> <span class="n">job</span><span class="o">.</span><span class="na">name</span> <span class="o">=-</span> <span class="s">/release_/</span><span class="o">};</span>

<span class="n">println</span> <span class="s2">&quot;Updating branch for chosen jobs to $NEW_BRANCH&quot;</span>
<span class="n">println</span> <span class="s2">&quot;&quot;</span>
<span class="c1">// Do work</span>
<span class="n">chosenJobs</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> <span class="n">job</span> <span class="o">-&gt;</span>
    <span class="kt">def</span> <span class="n">scm</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="na">scm</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">scm</span> <span class="k">instanceof</span> <span class="n">GitSCM</span> <span class="o">&amp;&amp;</span> <span class="n">job</span><span class="o">.</span><span class="na">name</span> <span class="o">!=</span> <span class="s2">&quot;release_nightly_deploy&quot;</span> <span class="o">)</span> <span class="o">{</span>
      <span class="c1">//def newScm = scm.clone()</span>
      <span class="n">println</span> <span class="s2">&quot;Updating branch for &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="na">name</span>
      <span class="n">scm</span><span class="o">.</span><span class="na">branches</span> <span class="o">=</span> <span class="n">newArrayList</span><span class="o">(</span><span class="k">new</span> <span class="n">BranchSpec</span><span class="o">(</span><span class="n">NEW_BRANCH</span><span class="o">))</span>
      <span class="n">println</span> <span class="s2">&quot;Branch for &quot;</span> <span class="o">+</span> <span class="n">job</span><span class="o">.</span><span class="na">name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">scm</span><span class="o">.</span><span class="na">branches</span>
      <span class="n">println</span> <span class="s2">&quot;&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="list-all-scm-urls">
<h3><a class="toc-backref" href="#id23">List All SCM Urls</a><a class="headerlink" href="#list-all-scm-urls" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jenkins.model.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.model.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.tasks.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.plugins.git.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.jgit.transport.RemoteConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.jgit.transport.URIish</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="n">project</span> <span class="k">in</span> <span class="n">Hudson</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">items</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">scm</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">scm</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">scm</span> <span class="k">instanceof</span> <span class="n">hudson</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">git</span><span class="o">.</span><span class="na">GitSCM</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">RemoteConfig</span> <span class="n">cfg</span> <span class="o">:</span> <span class="n">scm</span><span class="o">.</span><span class="na">getRepositories</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">URIish</span> <span class="n">uri</span> <span class="o">:</span> <span class="n">cfg</span><span class="o">.</span><span class="na">getURIs</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">println</span><span class="o">(</span><span class="s2">&quot;SCM &quot;</span> <span class="o">+</span> <span class="n">uri</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s2">&quot; for project &quot;</span> <span class="o">+</span> <span class="n">project</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="print-all-loggers">
<h3><a class="toc-backref" href="#id24">Print All Loggers</a><a class="headerlink" href="#print-all-loggers" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.logging.*</span><span class="o">;</span>

<span class="n">LogManager</span><span class="o">.</span><span class="na">getLogManager</span><span class="o">().</span><span class="na">getLoggerNames</span><span class="o">().</span><span class="na">each</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">println</span> <span class="s2">&quot;${it}&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="run-a-process">
<h3><a class="toc-backref" href="#id25">Run a Process</a><a class="headerlink" href="#run-a-process" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="n">Process</span> <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;cmd /c dir&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;${p.text}&quot;</span>

<span class="c1">// kill process on windows slave</span>
<span class="n">Process</span> <span class="n">p</span> <span class="o">=</span> <span class="s2">&quot;cmd /c Taskkill /F /IM MantidPlot.exe&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;${p.text}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="update-default-values-for-job-parameters">
<h3><a class="toc-backref" href="#id26">Update default values for job parameters</a><a class="headerlink" href="#update-default-values-for-job-parameters" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hudson.model.*</span>

<span class="kt">def</span> <span class="n">SUFFIX_VARIABLE</span> <span class="o">=</span> <span class="s2">&quot;PACKAGE_SUFFIX&quot;</span>
<span class="kt">def</span> <span class="n">NEW_SUFFIX</span> <span class="o">=</span> <span class="s2">&quot;nightly&quot;</span>

<span class="c1">// Access to the Hudson Singleton</span>
<span class="kt">def</span> <span class="n">jenkins</span> <span class="o">=</span> <span class="n">jenkins</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">Jenkins</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>

<span class="c1">// Retrieve matching jobs</span>
<span class="kt">def</span> <span class="n">chosenJobs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;release_clean-rhel7&quot;</span><span class="o">]</span> <span class="c1">//, &quot;release_clean-ubuntu-16.04&quot;, &quot;release_clean-ubuntu&quot;]</span>

<span class="n">println</span> <span class="s2">&quot;Updating default package suffix for chosen jobs to ${NEW_SUFFIX}&quot;</span>
<span class="n">println</span> <span class="s2">&quot;&quot;</span>
<span class="c1">// Do work</span>
<span class="n">chosenJobs</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> <span class="n">jobName</span> <span class="o">-&gt;</span>
  <span class="n">job</span> <span class="o">=</span> <span class="n">jenkins</span><span class="o">.</span><span class="na">getItem</span><span class="o">(</span><span class="n">jobName</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">job</span><span class="o">)</span>
  <span class="n">paramsDef</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="na">getAction</span><span class="o">(</span><span class="n">ParametersDefinitionProperty</span><span class="o">)</span>
  <span class="n">params</span> <span class="o">=</span> <span class="n">paramsDef</span><span class="o">.</span><span class="na">getParameterDefinitions</span><span class="o">()</span>
  <span class="n">params</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> <span class="n">it</span> <span class="o">-&gt;</span>
    <span class="k">if</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">==</span> <span class="n">SUFFIX_VARIABLE</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="s2">&quot;Updating default value of &#39;${SUFFIX_VARIABLE}&#39; variable to &#39;${NEW_SUFFIX}&#39;&quot;</span><span class="o">)</span>
      <span class="n">it</span><span class="o">.</span><span class="na">setDefaultValue</span><span class="o">(</span><span class="n">NEW_SUFFIX</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="AutomatedBuildProcess.html" title="Previous Chapter: The Automated Build Process"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; The Automated...</span>
    </a>
  </li>
  <li>
    <a href="ReleaseChecklist.html" title="Next Chapter: Release Checklist"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Release Checklist &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>