<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Jenkins Configuration</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.12.20180622.2012',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="index.html" />
    <link rel="next" title="Release Checklist" href="ReleaseChecklist.html" />
    <link rel="prev" title="The Automated Build Process" href="AutomatedBuildProcess.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="index.html">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org">Wiki</a></li>
                <li><a href="http://docs.mantidproject.org">User Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="jenkins-configuration">
<span id="jenkinsconfiguration"></span><h1>Jenkins Configuration<a class="headerlink" href="#jenkins-configuration" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#general-setup" id="id3">General Setup</a></li>
<li><a class="reference internal" href="#setting-up-a-new-slave" id="id4">Setting up a New Slave</a><ul>
<li><a class="reference internal" href="#machine-setup" id="id5">Machine Setup</a></li>
<li><a class="reference internal" href="#windows" id="id6">Windows</a><ul>
<li><a class="reference internal" href="#slave-connection" id="id7">Slave Connection</a></li>
<li><a class="reference internal" href="#connecting-through-a-proxy-server" id="id8">Connecting Through a Proxy Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linux" id="id9">Linux</a><ul>
<li><a class="reference internal" href="#ubuntu" id="id10">Ubuntu</a></li>
<li><a class="reference internal" href="#red-hat" id="id11">Red Hat</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mac-os" id="id12">Mac OS</a></li>
<li><a class="reference internal" href="#linux-mac-connection-notes" id="id13">Linux/Mac Connection Notes</a></li>
<li><a class="reference internal" href="#post-connection-setup-all-systems" id="id14">Post-Connection Setup - All Systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#misc-groovy-scripts" id="id15">Misc Groovy Scripts</a><ul>
<li><a class="reference internal" href="#print-the-value-of-an-environment-variable-on-all-nodes" id="id16">Print the Value of an Environment Variable on All Nodes</a></li>
<li><a class="reference internal" href="#update-paraview-variables-on-nodes" id="id17">Update ParaView variables on nodes</a></li>
<li><a class="reference internal" href="#check-existence-of-paraview-builds" id="id18">Check existence of ParaView builds</a></li>
<li><a class="reference internal" href="#remove-directories-across-multiple-nodes" id="id19">Remove directories across multiple nodes</a><ul>
<li><a class="reference internal" href="#master-incremental" id="id20">Master Incremental</a></li>
<li><a class="reference internal" href="#pull-requests" id="id21">Pull Requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-branches-for-jobs" id="id22">Update Branches For Jobs</a></li>
<li><a class="reference internal" href="#list-all-scm-urls" id="id23">List All SCM Urls</a></li>
<li><a class="reference internal" href="#print-all-loggers" id="id24">Print All Loggers</a></li>
<li><a class="reference internal" href="#run-a-process" id="id25">Run a Process</a></li>
<li><a class="reference internal" href="#update-default-values-for-job-parameters" id="id26">Update default values for job parameters</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Mantid uses the <a class="reference external" href="https://jenkins.io/">Jenkins</a> automation server to
support the continuous integration requirements of Mantid. This document
aims to describe the general setup of the system.</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Jenkins works on a &#8216;master-&gt;slave&#8217; principle. The master node is
responsible for orchestrating jobs and managing the slave nodes, where the
work is actually performed. The master node is located at
<a class="reference external" href="http://builds.mantidproject.org">http://builds.mantidproject.org</a> and each facility is responsible for providing
hardware to act as slaves for the various required configurations.</p>
</div>
<div class="section" id="general-setup">
<h2><a class="toc-backref" href="#id3">General Setup</a><a class="headerlink" href="#general-setup" title="Permalink to this headline">¶</a></h2>
<p>The master node is set to a fixed TCP port for JNLP slave agents under
<a class="reference external" href="http://builds.mantidproject.org/configureSecurity">http://builds.mantidproject.org/configureSecurity</a>.</p>
<p>The anonymous jenkins user has the following rights: Overall Read,
Slave Connect, Job Read, View Read.</p>
</div>
<div class="section" id="setting-up-a-new-slave">
<h2><a class="toc-backref" href="#id4">Setting up a New Slave</a><a class="headerlink" href="#setting-up-a-new-slave" title="Permalink to this headline">¶</a></h2>
<div class="section" id="machine-setup">
<h3><a class="toc-backref" href="#id5">Machine Setup</a><a class="headerlink" href="#machine-setup" title="Permalink to this headline">¶</a></h3>
<p>Set up a local <tt class="docutils literal"><span class="pre">builder</span></tt> account that will be used by the slave.</p>
<p>Install the <a class="reference internal" href="GettingStarted.html#gettingstarted"><em>required prerequisites</em></a> for the relevant OS.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Windows the <a class="reference external" href="http://landinghub.visualstudio.com/visual-cpp-build-tools">Command line Visual C++ build tools</a>
may be used in place of a full Visual Studio install from version 2017 onwards (the 2015 tools contain a broken <cite>vcvarsall.bat</cite>).</p>
</div>
</div>
<div class="section" id="windows">
<h3><a class="toc-backref" href="#id6">Windows</a><a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Ensure that the location of <tt class="docutils literal"><span class="pre">msbuild.exe</span></tt> (<tt class="docutils literal"><span class="pre">C:\Windows\Microsoft.NET\Framework64\v4.0.30319</span></tt>) is on the <tt class="docutils literal"><span class="pre">PATH</span></tt></li>
</ul>
<div class="section" id="slave-connection">
<h4><a class="toc-backref" href="#id7">Slave Connection</a><a class="headerlink" href="#slave-connection" title="Permalink to this headline">¶</a></h4>
<p>There are following additional steps required to be able to connect a
Windows slave using JNLP as a Windows service :</p>
<ol class="arabic simple">
<li>Setup the slave on the master node using &#8220;New Node&#8221; under
<a class="reference external" href="http://builds.mantidproject.org/computer/">http://builds.mantidproject.org/computer/</a>. If &#8220;New Node&#8221; is not visible
then you do not have the required permissions - ask an admin for help. It is
recommended that you copy from an existing node of a similar type.</li>
<li>Once configured on the master, remote desktop to the slave, open a browser and connect to the webpage of the
slave, .e.g. <a class="reference external" href="http://builds.mantidproject.org/computer/ornl-pc73896/">http://builds.mantidproject.org/computer/ornl-pc73896/</a></li>
<li>Click on the <strong>connect</strong> button to launch the JNLP client.</li>
<li>Once the client is launched, you can select &#8220;Install as Windows
Service&#8221; from the clients menu. If you have a proxy then see the
section below for further configuration steps.</li>
<li>Once installed change the recovery behaviour for
the service. Do this by right-clicking on the Jenkins
service-&gt;Properties-&gt;Recovery. Change the first, second, subsequent
failures to restart the service.</li>
<li>Change the account that the service uses to log on by right-clicking
on the Jenkins service-&gt;Properties-&gt;Log On and enter the details in
the builder account</li>
<li>Change the &#8220;Startup type:&#8221; of the service to be &#8220;Automatic (Delayed Start)&#8221;</li>
<li>Ensure the msbuild directory is on the <tt class="docutils literal"><span class="pre">PATH</span></tt></li>
<li>Finally reboot the slave (this is the easiest way for the Jenkins to
start trying to reconnect to it)</li>
</ol>
<p>Note that changes to <tt class="docutils literal"><span class="pre">PATH</span></tt> require restarting the Jenkins service in
order to be reflected in the build environment.</p>
</div>
<div class="section" id="connecting-through-a-proxy-server">
<h4><a class="toc-backref" href="#id8">Connecting Through a Proxy Server</a><a class="headerlink" href="#connecting-through-a-proxy-server" title="Permalink to this headline">¶</a></h4>
<p>It is a little more tricky to windows slaves connected through a
proxy.To do this you must modify the java arguments that are used to
start the <tt class="docutils literal"><span class="pre">jenkins-slave</span></tt> process. Once the &#8220;Install as a Windows
Service&#8221; has completed you should</p>
<ol class="arabic simple">
<li>Find a directory on the machine such as <tt class="docutils literal"><span class="pre">C:\Jenkins`</span></tt> or whatever
was configured in the slave config.</li>
<li>Open the <tt class="docutils literal"><span class="pre">jenkins-slave.xml</span></tt> file</li>
<li>Edit the tag and add <tt class="docutils literal"><span class="pre">-Dhttp.proxyHost=PROXYHOST</span></tt>
<tt class="docutils literal"><span class="pre">-Dhttp.proxyPort=PROXYPORT</span></tt> to the list</li>
<li>Save the file and restart the service (or machine)</li>
</ol>
</div>
</div>
<div class="section" id="linux">
<h3><a class="toc-backref" href="#id9">Linux</a><a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<p>Install an ssh server.</p>
<p>Install <tt class="docutils literal"><span class="pre">ccache</span></tt>. After installing run <tt class="docutils literal"><span class="pre">ccache</span> <span class="pre">--max-size=20G</span></tt> from the <tt class="docutils literal"><span class="pre">builder</span></tt> account.</p>
<p>Install a vnc server and from the <tt class="docutils literal"><span class="pre">builder</span></tt> account run <tt class="docutils literal"><span class="pre">vncpasswd</span></tt> to set a password on the VNC server. It
can be any password.</p>
<p>Ensure <tt class="docutils literal"><span class="pre">curl</span></tt> is installed</p>
<p>Any machines acting as performance test servers will require <tt class="docutils literal"><span class="pre">mysqldb</span></tt> to be installed.</p>
<div class="section" id="ubuntu">
<h4><a class="toc-backref" href="#id10">Ubuntu</a><a class="headerlink" href="#ubuntu" title="Permalink to this headline">¶</a></h4>
<p>Configure <a class="reference external" href="https://help.ubuntu.com/community/AutomaticSecurityUpdates">automatic security updates</a>.</p>
<p>Install <tt class="docutils literal"><span class="pre">gdebi-core</span></tt> package to allow installing <tt class="docutils literal"><span class="pre">.deb</span></tt> files.</p>
<p>The <tt class="docutils literal"><span class="pre">builder</span></tt> account must be setup to be able to run <tt class="docutils literal"><span class="pre">gdebi</span></tt> non-interactively. Use <tt class="docutils literal"><span class="pre">visudo</span></tt> to add the following
exception got <tt class="docutils literal"><span class="pre">builder</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre># Allow no password for gdebi
builder       ALL=(ALL)NOPASSWD:/usr/bin/gdebi, /usr/bin/dpkg
## Disable tty requirement for gdebi and dpkg command
Defaults!/usr/bin/gdebi !requiretty
Defaults!/usr/bin/dpkg  !requiretty
</pre></div>
</div>
</div>
<div class="section" id="red-hat">
<h4><a class="toc-backref" href="#id11">Red Hat</a><a class="headerlink" href="#red-hat" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">builder</span></tt> account must be setup to be able to run <tt class="docutils literal"><span class="pre">yum</span></tt> non-interactively. Use <tt class="docutils literal"><span class="pre">visudo</span></tt> to add the following
exception got <tt class="docutils literal"><span class="pre">builder</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>## Allow no password for yum
builder       ALL = NOPASSWD: /usr/bin/yum,/bin/rpm
## Disable tty requirement for yum command
Defaults!/bin/rpm       !requiretty
Defaults!/usr/bin/yum       !requiretty
</pre></div>
</div>
</div>
</div>
<div class="section" id="mac-os">
<h3><a class="toc-backref" href="#id12">Mac OS</a><a class="headerlink" href="#mac-os" title="Permalink to this headline">¶</a></h3>
<p>Enable <a class="reference external" href="https://apple.stackexchange.com/a/73919">SSH (&#8220;Remote Login&#8221;) and VNC (&#8220;Remote Management&#8221;)</a>.  If you have
connection issues from a non-OS X client then try adjusting your color depth settings (True Color 32bpp works on Remmina).</p>
<p>Install <tt class="docutils literal"><span class="pre">cppcheck</span></tt> from brew.</p>
<p>The <tt class="docutils literal"><span class="pre">builder</span></tt> account must be setup to be able to run <tt class="docutils literal"><span class="pre">gdebi</span></tt> non-interactively. Use <tt class="docutils literal"><span class="pre">visudo</span></tt> to add the following
exception got <tt class="docutils literal"><span class="pre">builder</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre># Allow builder to install packages without a password
builder  ALL=(ALL)NOPASSWD:/usr/sbin/installer, /bin/rm
# Disable tty requirement
Defaults!/usr/sbin/installer    !requiretty
Defaults!/bin/rm        !requiretty
</pre></div>
</div>
<p>In order to run the MantidPlot tests, which require a connection to the windowing system, the user that is running the jenkins slave must
have logged in. This is most easily done by VNC - connect, log in,
then disconnect. If you see errors such as:</p>
<div class="highlight-python"><div class="highlight"><pre>_RegisterApplication(), FAILED TO establish the default connection to the WindowServer,
_CGSDefaultConnection() is NULL.
</pre></div>
</div>
<p>then no one is logged in to the system.</p>
</div>
<div class="section" id="linux-mac-connection-notes">
<h3><a class="toc-backref" href="#id13">Linux/Mac Connection Notes</a><a class="headerlink" href="#linux-mac-connection-notes" title="Permalink to this headline">¶</a></h3>
<p>The jenkins JNLP connections are maintained by a crontab entry. The
script is in the <a class="reference external" href="https://github.com/mantidproject/mantid/blob/master/buildconfig/Jenkins/jenkins-slave.sh">mantid repository</a>.</p>
<p>The comments at the top describe a typical crontab entry for the script. This needs to be manually set for each slave. Ensure the script is
marked executable after downloading it. Also ensure the entry in the crontab
has the correct <tt class="docutils literal"><span class="pre">PATH</span></tt> setting (by default cron uses a reduced <tt class="docutils literal"><span class="pre">PATH</span></tt> entry). On macOS <tt class="docutils literal"><span class="pre">latex</span></tt> and <tt class="docutils literal"><span class="pre">sysctl</span></tt>
should be available.</p>
</div>
<div class="section" id="post-connection-setup-all-systems">
<h3><a class="toc-backref" href="#id14">Post-Connection Setup - All Systems</a><a class="headerlink" href="#post-connection-setup-all-systems" title="Permalink to this headline">¶</a></h3>
<p>Ensure the new machine is added to the relevant <a class="reference external" href="http://builds.mantidproject.org/view/ParaView/">ParaView build job</a> and build
ParaView. Set the <tt class="docutils literal"><span class="pre">PARAVIEW_DIR</span></tt> &amp; <tt class="docutils literal"><span class="pre">PARAVIEW_NEXT_DIR</span></tt> variables
(it&#8217;s easiest to just look at the configuration for one of the other
nodes of a similar type.</p>
</div>
</div>
<div class="section" id="misc-groovy-scripts">
<h2><a class="toc-backref" href="#id15">Misc Groovy Scripts</a><a class="headerlink" href="#misc-groovy-scripts" title="Permalink to this headline">¶</a></h2>
<p>The following is a collection of groovy scripts that can be run either
at <a class="reference external" href="http://builds.mantidproject.org/script">http://builds.mantidproject.org/script</a> (for master node) or on a
given node, e.g <a class="reference external" href="http://builds.mantidproject.org/computer/isis-mantidlx3/script">isis-mantidx3</a>.
You must have admin privileges to run them.</p>
<p><a class="reference external" href="https://github.com/jenkinsci/jenkins-scripts/tree/master/scriptler">https://github.com/jenkinsci/jenkins-scripts/tree/master/scriptler</a> was helpful for coming up with some of these.</p>
<div class="section" id="print-the-value-of-an-environment-variable-on-all-nodes">
<h3><a class="toc-backref" href="#id16">Print the Value of an Environment Variable on All Nodes</a><a class="headerlink" href="#print-the-value-of-an-environment-variable-on-all-nodes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>import jenkins.model.*
import hudson.model.*
import hudson.slaves.*

VARIABLE_NAME = &quot;PARAVIEW_DIR&quot;

nodes = Jenkins.instance.getNodes()
println(&quot;Displaying values of &quot; + VARIABLE_NAME + &quot; on all nodes&quot;)
println()
for(node in nodes) {
  node_props = node.nodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class)
  if(node_props.size() == 1) {
  env_vars = node_props[0].getEnvVars()
  if(env_vars.containsKey(VARIABLE_NAME)) {
  pv_dir = env_vars.get(VARIABLE_NAME, &quot;&quot;)
  } else {
  pv_dir = VARIABLE_NAME + &quot; not set.&quot;
  }
  println(node.getDisplayName() + &quot;: &quot; + pv_dir)
  } else {
  pv_dir = VARIABLE_NAME + &quot; not set.&quot;
  }
}
</pre></div>
</div>
</div>
<div class="section" id="update-paraview-variables-on-nodes">
<h3><a class="toc-backref" href="#id17">Update ParaView variables on nodes</a><a class="headerlink" href="#update-paraview-variables-on-nodes" title="Permalink to this headline">¶</a></h3>
<p><strong>After running this script the variables look like they are updated but
are in fact cached on the slaves so the new values don&#8217;t take effect
without disconnecting and forcing each slave to reconnect</strong></p>
<div class="highlight-groovy"><div class="highlight"><pre>import jenkins.model.*
import hudson.model.*
import hudson.slaves.*

VARIABLE_NAME = &quot;PARAVIEW_NEXT_DIR&quot;
VERSION = &quot;ParaView-5.1.2&quot;

jenkins = Jenkins.instance
nodes = jenkins.getNodes()
println(&quot;Displaying values of &quot; + VARIABLE_NAME + &quot; on all nodes&quot;)
println()
for(node in nodes) {
  node_props = node.nodeProperties.getAll(hudson.slaves.EnvironmentVariablesNodeProperty.class)
  if(node_props.size() == 1) {
  env_vars = node_props[0].getEnvVars()
  if(env_vars.containsKey(VARIABLE_NAME)) {
    def pv_dir = node.createPath(env_vars.get(VARIABLE_NAME, &quot;&quot;));
    if(pv_dir) {
      def pv_build_dir = pv_dir.getParent();
      def pv_dir_new = pv_build_dir.child(VERSION);
      println(node.getDisplayName() + &quot;: Updating $VARIABLE_NAME from &#39;&quot; + pv_dir.toString() + &quot;&#39; to &#39;&quot; + pv_dir_new.toString() + &quot;&#39;&quot;);
      env_vars.put(VARIABLE_NAME, pv_dir_new.toString());
    }
    else {
      println(node.getDisplayName() + &quot; has variable set but &quot; + env_vars.get(VARIABLE_NAME, &quot;&quot;) + &quot; does not exist&quot;);
    }
  } else {
    println(node.getDisplayName() + &quot;: $VARIABLE_NAME &quot; +  &quot;not set.&quot;)
  }
  } else {
    println(node.getDisplayName() + &quot;: $VARIABLE_NAME &quot; +  &quot;not set.&quot;)
  }
}
jenkins.save();
</pre></div>
</div>
</div>
<div class="section" id="check-existence-of-paraview-builds">
<h3><a class="toc-backref" href="#id18">Check existence of ParaView builds</a><a class="headerlink" href="#check-existence-of-paraview-builds" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>import hudson.model.*

nodes = Jenkins.instance.slaves

PV_VERSION = &quot;5.1.2&quot;

for (node in nodes) {
  FilePath root = node.getRootPath();
  if(root) {
    FilePath fp = root.getParent();
    // assume this is $HOME on osx/linux &amp; drive: on Windows
    if(fp.toString().startsWith(&quot;C:&quot;)) {
      fp = fp.child(&quot;Builds&quot;)
    } else {
      fp = fp.child(&quot;build&quot;);
    }
    fp = fp.child(&quot;ParaView-$PV_VERSION&quot;);
    if(!fp.exists()) {
      println(node.getDisplayName() + &quot; does not have PV 5.1.2&quot;)
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="remove-directories-across-multiple-nodes">
<h3><a class="toc-backref" href="#id19">Remove directories across multiple nodes</a><a class="headerlink" href="#remove-directories-across-multiple-nodes" title="Permalink to this headline">¶</a></h3>
<p>It is advised to ensure nothing is running and pause the build queue.</p>
<div class="section" id="master-incremental">
<h4><a class="toc-backref" href="#id20">Master Incremental</a><a class="headerlink" href="#master-incremental" title="Permalink to this headline">¶</a></h4>
<div class="highlight-groovy"><div class="highlight"><pre>import hudson.model.*

nodes = Jenkins.instance.slaves

JOBNAME = &quot;master_incremental&quot;


for (node in nodes) {
  labels = [&quot;osx-10.10-build&quot;, &quot;rhel6-build&quot;, &quot;rhel7-build&quot;, &quot;ubuntu-14.04-build&quot;, &quot;ubuntu-16.04-build&quot;, &quot;win7&quot;];
  for (nodeLabel in labels) {
    FilePath fp = node.createPath(node.getRootPath().toString() + File.separator + &quot;workspace&quot; + File.separator + JOBNAME + File.separator + &quot;label&quot; + File.separator + nodeLabel + File.separator + &quot;build&quot;);
    if(fp!=null &amp;&amp; fp.exists()) {
      println(fp.toString())
      fp.deleteRecursive()
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="pull-requests">
<h4><a class="toc-backref" href="#id21">Pull Requests</a><a class="headerlink" href="#pull-requests" title="Permalink to this headline">¶</a></h4>
<div class="highlight-groovy"><div class="highlight"><pre>import hudson.model.*

nodes = Jenkins.instance.slaves

JOB_PREFIX = &quot;pull_requests-&quot;
suffixes = [&quot;win7&quot;, &quot;osx&quot;, &quot;ubuntu&quot;, &quot;ubuntu-python3&quot;, &quot;rhel7&quot;];

for (node in nodes) {
  for (suffix in suffixes) {
    FilePath fp = node.createPath(node.getRootPath().toString() + File.separator + &quot;workspace&quot; + File.separator + JOB_PREFIX + suffix + File.separator +  &quot;build&quot;);
    if(fp!=null &amp;&amp; fp.exists()) {
      println(fp.toString())
      fp.deleteRecursive()
    }
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-branches-for-jobs">
<h3><a class="toc-backref" href="#id22">Update Branches For Jobs</a><a class="headerlink" href="#update-branches-for-jobs" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>import hudson.plugins.git.GitSCM
import hudson.plugins.git.BranchSpec
import static com.google.common.collect.Lists.newArrayList;

def NEW_BRANCH = &quot;*/release-v3.8&quot;

// Access to the Hudson Singleton
def jenkins = jenkins.model.Jenkins.instance;

// Retrieve matching jobs
def allItems = jenkins.items
def chosenJobs = allItems.findAll{job -&gt; job.name =- /release_/};

println &quot;Updating branch for chosen jobs to $NEW_BRANCH&quot;
println &quot;&quot;
// Do work
chosenJobs.each { job -&gt;
    def scm = job.scm;
    if (scm instanceof GitSCM &amp;&amp; job.name != &quot;release_nightly_deploy&quot; ) {
      //def newScm = scm.clone()
      println &quot;Updating branch for &quot; + job.name
      scm.branches = newArrayList(new BranchSpec(NEW_BRANCH))
      println &quot;Branch for &quot; + job.name + &quot;: &quot; + scm.branches
      println &quot;&quot;
    }
}
</pre></div>
</div>
</div>
<div class="section" id="list-all-scm-urls">
<h3><a class="toc-backref" href="#id23">List All SCM Urls</a><a class="headerlink" href="#list-all-scm-urls" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>import jenkins.model.*;
import hudson.model.*;
import hudson.tasks.*;
import hudson.plugins.git.*;
import org.eclipse.jgit.transport.RemoteConfig;
import org.eclipse.jgit.transport.URIish;

for(project in Hudson.instance.items) {
  scm = project.scm;
  if (scm instanceof hudson.plugins.git.GitSCM) {
    for (RemoteConfig cfg : scm.getRepositories()) {
      for (URIish uri : cfg.getURIs()) {
        println(&quot;SCM &quot; + uri.toString() + &quot; for project &quot; + project);
      }
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="print-all-loggers">
<h3><a class="toc-backref" href="#id24">Print All Loggers</a><a class="headerlink" href="#print-all-loggers" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>import java.util.logging.*;

LogManager.getLogManager().getLoggerNames().each() {
  println &quot;${it}&quot;;
}
</pre></div>
</div>
</div>
<div class="section" id="run-a-process">
<h3><a class="toc-backref" href="#id25">Run a Process</a><a class="headerlink" href="#run-a-process" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>Process p = &quot;cmd /c dir&quot;.execute()
println &quot;${p.text}&quot;

// kill process on windows slave
Process p = &quot;cmd /c Taskkill /F /IM MantidPlot.exe&quot;.execute()
println &quot;${p.text}&quot;
</pre></div>
</div>
</div>
<div class="section" id="update-default-values-for-job-parameters">
<h3><a class="toc-backref" href="#id26">Update default values for job parameters</a><a class="headerlink" href="#update-default-values-for-job-parameters" title="Permalink to this headline">¶</a></h3>
<div class="highlight-groovy"><div class="highlight"><pre>import hudson.model.*

def SUFFIX_VARIABLE = &quot;PACKAGE_SUFFIX&quot;
def NEW_SUFFIX = &quot;nightly&quot;

// Access to the Hudson Singleton
def jenkins = jenkins.model.Jenkins.instance;

// Retrieve matching jobs
def chosenJobs = [&quot;release_clean-rhel7&quot;] //, &quot;release_clean-ubuntu-16.04&quot;, &quot;release_clean-ubuntu&quot;]

println &quot;Updating default package suffix for chosen jobs to ${NEW_SUFFIX}&quot;
println &quot;&quot;
// Do work
chosenJobs.each { jobName -&gt;
  job = jenkins.getItem(jobName)
  println(job)
  paramsDef = job.getAction(ParametersDefinitionProperty)
  params = paramsDef.getParameterDefinitions()
  params.each { it -&gt;
    if(it.getName() == SUFFIX_VARIABLE) {
      println(&quot;Updating default value of &#39;${SUFFIX_VARIABLE}&#39; variable to &#39;${NEW_SUFFIX}&#39;&quot;)
      it.setDefaultValue(NEW_SUFFIX)
    }
  }

}
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="AutomatedBuildProcess.html" title="Previous Chapter: The Automated Build Process"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; The Automated Bu...</span>
    </a>
  </li>
  <li>
    <a href="ReleaseChecklist.html" title="Next Chapter: Release Checklist"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Release Checklis... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>